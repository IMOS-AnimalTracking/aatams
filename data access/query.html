<?xml version="1.0"?>
<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
	<style type="text/css">
		body { font-family: tahoma, arial, helvetica; font-size:9pt; margin:0px; background-color:#DBF0F7; }
		div#main {  width:96%; margin-left:2%; margin-top:20px; }
		div#data_source {float:right;  }
		input#wfs_uri { width:300px; }
		th { font-weight:bold; font-size:1.5em; }
		table.search { margin:0px; width:100%; border-spacing:0px; }
		table.search td { font-size:1.2em; padding:10px 10px 10px 0px; vertical-align:top;  }
		th#features_header { width:200px; text-align:left; padding-left:0px;}
		div.features { height:100px; width:100%; overflow:scroll; border:inset 2px #999999; background-color:white; }
		th#params_header { width:70%; text-align:left; padding-left:15px; }		
		div#params {width: 100%; border:groove 3px #CCCCCC; padding:4px;}
		table.params { border-collapse:collapse; border-spacing:0px;}
		table.params td  { font-size:1.0em; padding:3px 10px 3px 10px; vertical-align:top;  border-bottom:solid 1px #CCCCCC; white-space: nowrap;}
		table.params td.last_row  { border-bottom:solid 0px gray; }
		.param_name { font-weight:bold; }
		.download { font-size:0.8em; }
		.date_group { font-weight:bold; margin-bottom:2px; }
		table.lon_lat td { border:solid 0px gray; padding-top:0px; } 
		td ul { padding: 0px; margin: 0px; list-style-type: none; }
		div#request {border:dashed 1px #999999; padding-left:5px;}
		span.feature_type{ cursor:pointer }
		span.format_type{ cursor:pointer }		
		img.calendar{ margin-left:5px; margin-right:5px; vertical-align: top;  }
		input#max_members { width:50px }
                .button {overflow:visible;font-weight:bold;padding:2px}
		
	</style>
	
	<script type="text/javascript" src="js/dates/date.js"></script>
	<script type="text/javascript">
		//<![CDATA[
		//global variables
		var feature_type;
		var params_div;
		var params_header_div;
		var predicate_count;
		var pending_request = null;
		var pending_xslt = null;

		/*
		Initialisation, called on body onload event
		*/
		function Init(){
			//parent.frames[1].location = "results.html";
			params_div = document.getElementById('params');
			if(!params_div)
				throw new Error("initialisation failed to find 'params' div element");
			params_header_div = document.getElementById('params_header');
			if(!params_header_div)
				throw new Error("initialisation failed to find 'params_header' div element");
			SelectType(0);
			SelectFormat(0);
			Reset();
		}

		/*
		Controls the display of filter parameters for search types
		*/
		function SetFeatureType(type){
			if(type)
				feature_type = type;
			else
				throw Error("search 'type' parameter is null");

			switch(feature_type){
			case "installations":
				params_header_div.innerHTML = "Filter Parameters for INSTALLATIONS";		
				SetInstallationsFilterParameters();
				break;
			case "deployments":
				params_header_div.innerHTML = "Filter Parameters for DEPLOYMENTS";	
				SetDeploymentsFilterParameters();
				break;
			case "detections":
				params_header_div.innerHTML = "Filter Parameters for DETECTIONS";
				SetDetectionsFilterParameters();
				break;
			case "detection_deployment_animal_species":
				params_header_div.innerHTML = "Filter Parameters for DETECTIONS";
				SetDetectionDeploymentAnimalSpeciesFilterParameters();
				break;
			case "tags":
				params_header_div.innerHTML = "Filter Parameters for TAGS";
				SetTagsFilterParameters();
				break;
			case "receivers":
				params_header_div.innerHTML = "Filter Parameters for RECEIVERS";
				SetReceiversFilterParameters();
				break;
			case "surgeries":
				params_header_div.innerHTML = "Filter Parameters for SURGERIES";
				SetSurgeriesFilterParameters();
				break;
			case "animals":
				params_header_div.innerHTML = "Filter Parameters for TAGGED ANIMALS";
				SetAnimalsFilterParameters();
				break;
			case "species":
				params_header_div.innerHTML = "Filter Parameters for TAGGED SPECIES";
				SetSpeciesFilterParameters();
				break;
			default: throw new Error("unknown search type: " + feature_type);
			}
		}

		/*
		Get the dataset from the WFS
		 */
		function DisplayData(do_count){
			try{
				var uri = BuildWFSRequest(do_count);
				switch(GetCheckedValue('output_format')){
				case 'xml':
					uri += "&outputformat=text%2fxml;%20subtype%3dgml%2f3.1.1";
					break;
				case 'html':
					uri += "&outputformat=text%2fxml;%20subtype%3dxhtml_cb";
					break;
				case 'csv':
					uri += "&outputformat=text%2fxml;%20subtype%3dcsv_cb";
					break;
				}
				pending_request = uri;
				parent.frames[1].location = "results.html";
			}
			catch(e){
				alert(e);
			}			
		}

		function BuildWFSRequest(do_count){
			predicate_count = 0;
			var filter;
			var uri = document.getElementById('wfs_uri').value + "?service=WFS&version=1.0.0&request=GetFeature&namespace=xmlns(aatams=http://www.imos.org.au/aatams)";
			switch(feature_type){
			case "installations":
				uri += "&typename=aatams:Installation" + GetInstallationsFilter();
				break;
			case "deployments":
				uri += "&typename=aatams:Deployment" + GetDeploymentsFilter();
				break;
			case "detections":
				uri += "&typename=aatams:Detection" + GetDetectionsFilter();
				break;
			case "detection_deployment_animal_species":
				uri += "&typename=aatams:DetectionDeploymentAnimalSpecies" + GetDetectionDeploymentAnimalSpeciesFilter();
				break;
			case "tags":
				uri += "&typename=aatams:Device" + GetTagsFilter();
				break;
			case "receivers":
				uri += "&typename=aatams:Device" + GetReceiversFilter();
				break;
			case "surgeries":
				uri += "&typename=aatams:Surgery" + GetSurgeriesFilter();
				break;	
			case "animals":
				uri += "&typename=aatams:Animal" + GetAnimalsFilter();
				break;
			case "species":
				uri += "&typename=aatams:Species" + GetSpeciesFilter();
				break;
			default: throw new Error("unknown search type: " + feature_type);
			}
			var max = parseInt(document.getElementById('max_members').value);
			if(max && max > 0)
				uri += "&maxfeatures=" + max;
			if(do_count) 
				uri += "&resultType=hits";
			document.getElementById('query').value=uri;
			return uri;
		}

		/*
		Resets Download Link
		*/
		function Reset(){
			try{
				var uri = BuildWFSRequest(false);
				switch(GetCheckedValue('output_format')){
				case 'xml':
					uri += "&outputformat=text%2fxml;%20subtype%3dgml%2f3.1.1";
					break;
				case 'html':
					uri += "&outputformat=text%2fxml;%20subtype%3dxhtml";
					break;
				case 'csv':
					uri += "&outputformat=text%2fxml;%20subtype%3dcsv";
					break;
				}
				document.getElementById('download').href = uri;
			}
			catch(e){
				alert(e);
			}
		}

		/*
		Inserts installations search parameters markup
		*/
		function SetInstallationsFilterParameters(){
			params_div.innerHTML = "<table class='params'><tbody>" +
				//"<tr><td class='param_name last_row'>Installation Id:</td><td class='last_row'>" + OperatorList('=|<=|>=|<|>','installation_id_operator') + 
				//	" <input id='installation_id' type='text' size='10' onblur='Reset()'/></td></tr>" +				
				"<tr><td class='param_name last_row'>Installation name:</td><td class='last_row'>" + OperatorList('=','installation_id_operator') + 
					" " + InstallationsSelectList() + "</td></tr>" +
				//"<tr><td class='param_name'>Detected Species:</td><td>"  + OperatorList('=','species_id_operator') +
				//	" " + SpeciesSelectList() + "</td></tr>" +
				//"<tr><td class='param_name last_row'>Location Bounding Box: </td><td class='last_row'>" + LocationBoundingBox() + "</td></tr>" +
				"</tbody></table>";
		}

		/*
		Inserts deployments search parameters markup
		 */
		function SetDeploymentsFilterParameters(){
			params_div.innerHTML = "<table class='params'><tbody>" +
				"<tr><td class='param_name'>Installation name:</td><td>" + OperatorList('=','installation_id_operator') + 
					" " + InstallationsSelectList() + "</td></tr>" +
				"<tr><td class='param_name'>Deployment Id:</td><td>" + OperatorList('=','deployment_id_operator') + 
					" <input id='deployment_id' type='text' size='10' onblur='Reset()'/></td></tr>" +				
				//"<tr><td class='param_name'>Installation Date:</td><td>" + OperatorList('>=|>','start_date_operator') + " " + DateSelect('start_date') + " and " +
				//	 OperatorList('<=|<','end_date_operator') + " " + DateSelect('end_date') + "</td></tr>" +
				//"<tr><td class='param_name'>Detected Species:</td><td>"  + OperatorList('=','species_id_operator') +
				//	" " + SpeciesSelectList() + "</td></tr>" +
				"<tr><td class='param_name last_row'>Location Bounding Box: </td><td class='last_row'>" + LocationBoundingBox() + "</td></tr>" +
				"</tbody></table>";
		}

		/*
		Inserts detections search parameters markup
		 */
		function SetDetectionsFilterParameters(){
			params_div.innerHTML = "<table class='params'><tbody>" +				
				"<tr><td class='param_name'>Deployment Id:</td><td>" + OperatorList('=|<=|>=|<|>','deployment_id_operator') +
					" <input id='deployment_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Tag Id: </td><td>" + OperatorList('=|<=|>=|<|>','tag_id_operator') +
					" <input id='tag_id' type='text' size='10' onblur='Reset()' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Detection Id:</td><td>" + OperatorList('=|<=|>=|<|>','detection_id_operator') +
					" <input id='detection_id' type='text' size='10' onblur='Reset()'/></td></tr>" +				
				"<tr><td class='param_name'>Detection UTC DateTime:</td><td>" + OperatorList('>=|>','start_date_operator') + " " + DateSelect('start_date') + " and " +
					 OperatorList('<=|<','end_date_operator') + " " + DateSelect('end_date') + "</td></tr>" +
				"<tr><td class='param_name last_row'>Location Bounding Box: </td><td class='last_row'>" + LocationBoundingBox() + "</td></tr>" +
				"</tbody></table>";		
		}

		/*
		Inserts detections search parameters markup
		 */
		function SetDetectionDeploymentAnimalSpeciesFilterParameters(){
			params_div.innerHTML = "<table class='params'><tbody>" +
				//"<tr><td class='param_name'>Genus:</td><td>"  + OperatorList('=','genus_id_operator') +
				//	" " + GenusSelectList() + "</td></tr>" +
				"<tr><td class='param_name'>Species:</td><td>"  + OperatorList('=','species_id_operator') +
				" " + SpeciesSelectList() + "</td></tr>" +
				"<tr><td class='param_name'>Animal Id: </td><td>" + OperatorList('=|<=|>=|<|>','animal_id_operator') +
					" <input id='animal_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Surgery Id: </td><td>" + OperatorList('=|<=|>=|<|>','surgery_id_operator') +
					" <input id='surgery_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Installation Id: </td><td>" + OperatorList('=|<=|>=|<|>','installation_id_operator') +
					" <input id='installation_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Deployment Id: </td><td>" + OperatorList('=|<=|>=|<|>','deployment_id_operator') +
					" <input id='deployment_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Tag Id: </td><td>" + OperatorList('=|<=|>=|<|>','tag_id_operator') +
					" <input id='tag_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Tag Model Id: </td><td>" + OperatorList('=|<=|>=|<|>','tag_model_id_operator') +
					" <input id='tag_model_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Receiver Id: </td><td>" + OperatorList('=|<=|>=|<|>','receiver_id_operator') +
					" <input id='receiver_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Receiver Model Id: </td><td>" + OperatorList('=|<=|>=|<|>','receiver_model_id_operator') +
					" <input id='receiver_model_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
					"<tr><td class='param_name'>Detection UTC DateTime:</td><td>" + OperatorList('>=|>','start_date_operator') + " " + DateSelect('start_date') + "<br/>and<br/>" +
					 OperatorList('<=|<','end_date_operator') + " " + DateSelect('end_date') + "</td></tr>" +
				"<tr><td class='param_name last_row'>Location Bounding Box: </td><td class='last_row'>" + LocationBoundingBox() + "</td></tr>" +
				"</tbody></table>";		
		}

		/*
		Inserts tags search parameters markup
 		*/
		function SetTagsFilterParameters(){

			       params_div.innerHTML = "<table class='params'><tbody>" +
				"<tr><td class='param_name'>Device Id:</td><td>" + OperatorList('=|<=|>=|<|>','device_id_operator') +
					" <input id='device_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Device Name:</td><td>" + OperatorList('=','device_name_operator') +
					" <input id='device_name' type='text' size='20'/></td></tr>" +
				"<tr><td class='param_name last_row'>Model:</td><td class='last_row'>" + OperatorList('=','model_id_operator') +
					" " + TagModelSelectList() + "</td></tr>" +
					"</tbody></table>";
		}

		/*
		Inserts receivers search parameters markup
		*/
		function SetReceiversFilterParameters(){
			params_div.innerHTML = "<table class='params'><tbody>" +
				"<tr><td class='param_name'>Device Id:</td><td>" + OperatorList('=|<=|>=|<|>','device_id_operator') +
					" <input id='device_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Device Name:</td><td>" + OperatorList('=|<=|>=|<|>','device_name_operator') +
					" <input id='device_name' type='text' size='20'/></td></tr>" +	
				"<tr><td class='param_name last_row'>Model:</td><td class='last_row'>" + OperatorList('=','model_id_operator') +
					" " + ReceiverModelSelectList() + "</td></tr>" +
				"</tbody></table>";
		}

		/*
		Inserts surgeries search parameters markup
		*/
		function SetSurgeriesFilterParameters(){
			params_div.innerHTML = "<table class='params'><tbody>" +
				"<tr><td class='param_name'>Surgery Id:</td><td>" + OperatorList('=|<=|>=|<|>','surgery_id_operator') +
					" <input id='surgery_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Animal Id:</td><td>" + OperatorList('=|<=|>=|<|>','animal_id_operator') +
					" <input id='animal_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Tag Device Id: </td><td>" + OperatorList('=|<=|>=|<|>','device_id_operator') +
					" <input id='device_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				"<tr><td class='param_name'>Tag Name:</td><td>" + OperatorList('=|<=|>=|<|>','device_name_operator') +
					" <input id='device_name' type='text' size='20'/></td></tr>" +
				"<tr><td class='param_name last_row'>Location Bounding Box: </td><td class='last_row'>" + LocationBoundingBox() + "</td></tr>" +
				"</tbody></table>";			
		}

		/*
		Inserts animals search parameters markup
		*/
		function SetAnimalsFilterParameters(){
			params_div.innerHTML = "<table class='params'><tbody>" +
				"<tr><td class='param_name'>Animal Id:</td><td>" + OperatorList('=|<=|>=|<|>','animal_id_operator') +
					" <input id='animal_id' type='text' size='10' onblur='Reset()'/></td></tr>" +
				//"<tr><td class='param_name last_row'>Genus:</td><td  class='last_row'>" + OperatorList('=','genus_id_operator') +
				//	" " + GenusSelectList() + "</td></tr>" +
				"<tr><td class='param_name last_row'>Species:</td><td  class='last_row'>" + OperatorList('=','species_id_operator') +
					" " + SpeciesSelectList() + "</td></tr>" +				
				"</tbody></table>";
		}

		/**
		Inserts species search parameters markup
		*/
		function SetSpeciesFilterParameters(){
			params_div.innerHTML = "<table class='params'><tbody>" +
				//"<tr><td class='param_name last_row'>Genus:</td><td  class='last_row'>" + OperatorList('=','genus_id_operator') +
				//	" " + GenusSelectList() + "</td></tr>" +
				"<tr><td class='param_name last_row'>Species:</td><td  class='last_row'>" + OperatorList('=','species_id_operator') +
					" " + SpeciesSelectList() + "</td></tr>" +				
				"</tbody></table>";
		}

		/*** List Generation functions ***/

		/**
		Makes a list of Operators by splitting symbols param
		*/
		function OperatorList(symbols, id){
			var operators = symbols.split("|");
			var tmp = "<select id='" + id + "' onblur='Reset()'>";
			for(var i = 0; i<operators.length; i++){
				if(operators[i] == '=' )
					tmp += "<option value='1' selected='selected'>=</option>";
				else if(operators[i] == '<=')
					tmp += "<option value='2'>&lt;=</option>";
				else if(operators[i] == '>=')
					tmp += "<option value='3'>&gt;=</option>";
				else if(operators[i] == '<')
					tmp += "<option value='4'>&lt;</option>";
				else if(operators[i] == '>')
					tmp += "<option value='5'>&gt;</option>";
				else if(operators[i] == '<>')
					tmp += "<option value='6'>&lt;&gt;</option>";
				else if(operators[i] == 'NULL')
					tmp += "<option value='7'>NULL</option>";
			}
			tmp += "</select>";
			return tmp;
		}

		/**
		Inserts an Installations list
		//TODO Dynamically generate
		*/
		function InstallationsSelectList(){
			return "<select id='installation_id' onblur='Reset()'>" + 
				"<option value=''></option>" +
				"<option value='2'>Coral Bay, WA - 23 parallel</option>" +
				"<option value='3'>Coral Bay, WA - South Line</option>" +
				"<option value='4'>Coral Bay, WA - Stanley Pool</option>" +
				"<option value='5'>Coral Bay, WA - Skully Beach</option>" +
				"<option value='6'>Coral Bay, WA - South Line</option>" +
				"<option value='7'>Coral Bay, WA - North Reef</option>" +
				"<option value='8'>Coral Bay, WA - Asho's Reef</option>" +
				"<option value='9'>Coral Bay, WA - Reef Point</option>" +
				"</select>";
		}

		/**
		Inserts a Species list
		//TODO Dynamically generate
		*/
		function SpeciesSelectList(){
			return "<select id='species_id' onblur='Reset()'>" + 
				"<option value=''></option>" +
				"<option value='1'>Caranx fulvoguttatus</option>" +
				"<option value='2'>Carcharhinus amblyrhynchos</option>" +
				"<option value='3'>Carcharhinus cautus</option>" +
				"<option value='4'>Carcharhinus melanopterus</option>" +
				"<option value='5'>Coris aygula</option>" +
				"<option value='6'>Epinephelus rivulatus</option>" +
				"<option value='7'>Galocerdo cuvier</option>" +
				"<option value='8'>Lethrinus nebulosus</option>" +
				"<option value='9'>Manta birostris</option>" +
				"<option value='10'>Negaprion acutidens</option>" +
				"<option value='11'>Pastinachus sephen</option>" +
				"<option value='12'>Rhinobatos typus</option>" +
				"<option value='13'>Thunnus maccoyii</option>" +
				"<option value='14'>Urogymnus asperrimus</option>" +
				"</select>";
		}

		/**
		Inserts a Genus list
		//TODO Dynamically generate
		*/
		function GenusSelectList(){
			return "<select id='genus_id' onblur='Reset()'>" + 
				"<option value=''></option>" +
				"<option value='1'>Caranx</option>" +
				"<option value='2'>Carcharhinus</option>" +
				"<option value='3'>Coris</option>" +
				"<option value='4'>Epinephelus</option>" +
				"<option value='5'>Galocerdo</option>" +
				"<option value='6'>Lethrinus</option>" +
				"<option value='7'>Manta</option>" +
				"<option value='8'>Negaprion</option>" +
				"<option value='9'>Pastinachus</option>" +
				"<option value='10'>Rhinobatos</option>" +
				"<option value='11'>Thunnus</option>" +
				"<option value='12'>Urogymnus</option>" +
				"</select>";
		}


		/**
		Inserts a Tag Model list
		//TODO Dynamically generate
		*/
		function TagModelSelectList(){
			return "<select id='model_id' onblur='Reset()'>" + 
				"<option value=''></option>" +
				"<option value='4'>V7-1L</option>" +
				"<option value='5'>V7-2L</option>" +
				"<option value='6'>V7-4L</option>" +
				"<option value='7'>V9-1L</option>" +
				"<option value='8'>V9-2L</option>" +
				"<option value='9'>V9-6L</option>" +
				"<option value='10'>V9T-6L</option>" +
				"<option value='11'>V9T-2L</option>" +
				"<option value='12'>V9T-1L</option>" +
				"<option value='13'>V9P-1L</option>" +
				"<option value='14'>V9P-2L</option>" +
				"<option value='15'>V9P-6L</option>" +
				"<option value='16'>V9TP-1L</option>" +
				"<option value='17'>V9TP-2L</option>" +
				"<option value='18'>V9TP-6L</option>" +
				"<option value='19'>V9-1H</option>" +
				"<option value='20'>V9-2H</option>" +
				"<option value='21'>V9-6H</option>" +
				"<option value='22'>V9T-1H</option>" +
				"<option value='23'>V9T-2H</option>" +
				"<option value='24'>V9T-6H</option>" +
				"<option value='25'>V9P-1H</option>" +
				"<option value='26'>V9P-2H</option>" +
				"<option value='27'>V9P-6H</option>" +
				"<option value='28'>V9TP-1H</option>" +
				"<option value='29'>V9TP-2H</option>" +
				"<option value='30'>V9TP-6H</option>" +
				"<option value='31'>V9AP-2L</option>" +
				"<option value='32'>V9AP-2H</option>" +
				"<option value='33'>V13-1L</option>" +
				"<option value='34'>V13-1H</option>" +
				"<option value='35'>V13T-1L</option>" +
				"<option value='36'>V13T-1H</option>" +
				"<option value='37'>V13P-1L</option>" +
				"<option value='38'>V13P-1H</option>" +
				"<option value='39'>V13TP-1L</option>" +
				"<option value='40'>V13TP-1H</option>" +
				"<option value='41'>V16-1L</option>" +
				"<option value='42'>V16-1H</option>" +
				"<option value='43'>V16-3L</option>" +
				"<option value='44'>V16-3H</option>" +
				"<option value='45'>V16-4L</option>" +
				"<option value='46'>V16-4H</option>" +
				"<option value='47'>V16-5L</option>" +
				"<option value='48'>V16-5H</option>" +
				"<option value='49'>V16-6L</option>" +
				"<option value='50'>V16-6H</option>" +
				"<option value='51'>V16T-1L</option>" +
				"<option value='52'>V16T-1H</option>" +
				"<option value='53'>V16T-3L</option>" +
				"<option value='54'>V16T-3H</option>" +
				"<option value='55'>V16T-4L</option>" +
				"<option value='56'>V16T-4H</option>" +
				"<option value='57'>V16T-5L</option>" +
				"<option value='58'>V16T-5H</option>" +
				"<option value='59'>V16T-6L</option>" +
				"<option value='60'>V16T-6H</option>" +
				"<option value='61'>V16P-1L</option>" +
				"<option value='62'>V16P-1H</option>" +
				"<option value='63'>V16P-3L</option>" +
				"<option value='64'>V16P-3H</option>" +
				"<option value='65'>V16P-4L</option>" +
				"<option value='66'>V16P-4H</option>" +
				"<option value='67'>V16P-5L</option>" +
				"<option value='68'>V16P-5H</option>" +
				"<option value='69'>V16P-6L</option>" +
				"<option value='70'>V16P-6H</option>" +
				"<option value='71'>V16TP-1L</option>" +
				"<option value='72'>V16TP-1H</option>" +
				"<option value='73'>V16TP-3L</option>" +
				"<option value='74'>V16TP-3H</option>" +
				"<option value='75'>V16TP-4L</option>" +
				"<option value='76'>V16TP-4H</option>" +
				"<option value='77'>V16TP-5L</option>" +
				"<option value='78'>V16TP-5H</option>" +
				"<option value='79'>V16TP-6L</option>" +
				"<option value='80'>V16TP-6H</option>" +
				"</select>";
		}

		/**
		Inserts an Receiver Model list
		//TODO Dynamically generate
		*/
		function ReceiverModelSelectList(){
			return "<select id='model_id' onblur='Reset()'>" + 
				"<option value=''></option>" +
				"<option value='1'>VR2W</option>" +
				"</select>";
		}


		/*
		Makes a date selection group (input + calendar + validation)
		*/   
		function DateSelect(id){
			return "<span class='date_group'>" + YearSelectList(id) + "-" + MonthSelectList(id) + "-" + DaySelectList(id) + "&#160;&#160;" + Hour24SelectList(id) + ":" +
			       MinutesSelectList(id) + ":" + SecondsSelectList(id) + "</span>";
		     
			//"<input id='"+id+"' width='13' alt='Enter Date/Time'/><div id='"+id+"_div'/><img  id='"+id+"_img' class='calendar' src='js/calendar/calendar.png' width='18' height='18' border='0'>"; 			
		}

		/**
	
		*/   
		function YearSelectList(id){
			return "<select id='" + id + "_year'>" +
				"<option value=''></option>" +
				"<option value='2006'>2006</option>" +
				"<option value='2007'>2007</option>" +
				"<option value='2008'>2008</option>" +
				"</select>";
		}	
		/**
		
		*/   
		function MonthSelectList(id){
			return "<select id='" + id + "_month'>" +
				"<option value=''></option>" +				
				"<option value='01'>Jan</option>" +
				"<option value='02'>Feb</option>" +
				"<option value='03'>Mar</option>" +
				"<option value='04'>Apr</option>" +
				"<option value='05'>May</option>" +
				"<option value='06'>Jun</option>" +
				"<option value='07'>Jul</option>" +
				"<option value='08'>Aug</option>" +
				"<option value='09'>Sep</option>" +
				"<option value='10'>Oct</option>" +
				"<option value='11'>Nov</option>" +
				"<option value='12'>Dec</option>" +
				"</select>";
		}
		/**
		
		*/   
		function DaySelectList(id){
			return "<select id='" + id + "_day'>" +
				"<option value=''></option>" +
				"<option value='01'>01</option>" +
				"<option value='02'>02</option>" +
				"<option value='03'>03</option>" +
				"<option value='04'>04</option>" +
				"<option value='05'>05</option>" +
				"<option value='06'>06</option>" +
				"<option value='07'>07</option>" +
				"<option value='08'>08</option>" +
				"<option value='09'>09</option>" +
				"<option value='10'>10</option>" +
				"<option value='11'>11</option>" +
				"<option value='12'>12</option>" +
				"<option value='13'>13</option>" +
				"<option value='14'>14</option>" +
				"<option value='15'>15</option>" +
				"<option value='16'>16</option>" +
				"<option value='17'>17</option>" +
				"<option value='18'>18</option>" +
				"<option value='19'>19</option>" +
				"<option value='20'>20</option>" +
				"<option value='21'>21</option>" +
				"<option value='22'>22</option>" +
				"<option value='23'>23</option>" +
				"<option value='24'>24</option>" +
				"<option value='25'>25</option>" +
				"<option value='26'>26</option>" +
				"<option value='27'>27</option>" +
				"<option value='28'>28</option>" +
				"<option value='29'>29</option>" +
				"<option value='30'>30</option>" +
				"<option value='31'>31</option>" +
				"</select>";
		}
		/**
		
		*/   
		function Hour24SelectList(id){
			return "<select id='" + id + "_hour'>" +
				"<option value='00'>00</option>" +
				"<option value='01'>01</option>" +
				"<option value='02'>02</option>" +
				"<option value='03'>03</option>" +
				"<option value='04'>04</option>" +
				"<option value='05'>05</option>" +
				"<option value='06'>06</option>" +
				"<option value='07'>07</option>" +
				"<option value='08'>08</option>" +
				"<option value='09'>09</option>" +
				"<option value='10'>10</option>" +
				"<option value='11'>11</option>" +
				"<option value='12'>12</option>" +
				"<option value='13'>13</option>" +
				"<option value='14'>14</option>" +
				"<option value='15'>15</option>" +
				"<option value='16'>16</option>" +
				"<option value='17'>17</option>" +
				"<option value='18'>18</option>" +
				"<option value='19'>19</option>" +
				"<option value='20'>20</option>" +
				"<option value='21'>21</option>" +
				"<option value='22'>22</option>" +
				"<option value='23'>23</option>" +
				"</select>";		
		}
		/**
		
		*/   
		function MinutesSelectList(id){
			return "<select id='" + id + "_minute'>" +
				"<option value='00'>00</option>" +
				"<option value='01'>01</option>" +
				"<option value='02'>02</option>" +
				"<option value='03'>03</option>" +
				"<option value='04'>04</option>" +
				"<option value='05'>05</option>" +
				"<option value='06'>06</option>" +
				"<option value='07'>07</option>" +
				"<option value='08'>08</option>" +
				"<option value='09'>09</option>" +
				"<option value='10'>10</option>" +
				"<option value='11'>11</option>" +
				"<option value='12'>12</option>" +
				"<option value='13'>13</option>" +
				"<option value='14'>14</option>" +
				"<option value='15'>15</option>" +
				"<option value='16'>16</option>" +
				"<option value='17'>17</option>" +
				"<option value='18'>18</option>" +
				"<option value='19'>19</option>" +
				"<option value='20'>20</option>" +
				"<option value='21'>21</option>" +
				"<option value='22'>22</option>" +
				"<option value='23'>23</option>" +
				"<option value='24'>24</option>" +
				"<option value='25'>25</option>" +
				"<option value='26'>26</option>" +
				"<option value='27'>27</option>" +
				"<option value='28'>28</option>" +
				"<option value='29'>29</option>" +
				"<option value='30'>30</option>" +
				"<option value='31'>31</option>" +
				"<option value='32'>32</option>" +
				"<option value='33'>33</option>" +
				"<option value='34'>34</option>" +
				"<option value='35'>35</option>" +
				"<option value='36'>36</option>" +
				"<option value='37'>37</option>" +
				"<option value='38'>38</option>" +
				"<option value='39'>39</option>" +
				"<option value='40'>40</option>" +
				"<option value='41'>41</option>" +
				"<option value='42'>42</option>" +
				"<option value='43'>43</option>" +
				"<option value='44'>44</option>" +
				"<option value='45'>45</option>" +
				"<option value='46'>46</option>" +
				"<option value='47'>47</option>" +
				"<option value='48'>48</option>" +
				"<option value='49'>49</option>" +
				"<option value='50'>50</option>" +
				"<option value='51'>51</option>" +
				"<option value='52'>52</option>" +
				"<option value='53'>53</option>" +
				"<option value='54'>54</option>" +
				"<option value='55'>55</option>" +
				"<option value='56'>56</option>" +
				"<option value='57'>57</option>" +
				"<option value='58'>58</option>" +
				"<option value='59'>59</option>" +
				"</select>";		
		}
		/**
		
		*/   
		function SecondsSelectList(id){
			return "<select id='" + id + "_second'>" +
				"<option value='00'>00</option>" +
				"<option value='01'>01</option>" +
				"<option value='02'>02</option>" +
				"<option value='03'>03</option>" +
				"<option value='04'>04</option>" +
				"<option value='05'>05</option>" +
				"<option value='06'>06</option>" +
				"<option value='07'>07</option>" +
				"<option value='08'>08</option>" +
				"<option value='09'>09</option>" +
				"<option value='10'>10</option>" +
				"<option value='11'>11</option>" +
				"<option value='12'>12</option>" +
				"<option value='13'>13</option>" +
				"<option value='14'>14</option>" +
				"<option value='15'>15</option>" +
				"<option value='16'>16</option>" +
				"<option value='17'>17</option>" +
				"<option value='18'>18</option>" +
				"<option value='19'>19</option>" +
				"<option value='20'>20</option>" +
				"<option value='21'>21</option>" +
				"<option value='22'>22</option>" +
				"<option value='23'>23</option>" +
				"<option value='24'>24</option>" +
				"<option value='25'>25</option>" +
				"<option value='26'>26</option>" +
				"<option value='27'>27</option>" +
				"<option value='28'>28</option>" +
				"<option value='29'>29</option>" +
				"<option value='30'>30</option>" +
				"<option value='31'>31</option>" +
				"<option value='32'>32</option>" +
				"<option value='33'>33</option>" +
				"<option value='34'>34</option>" +
				"<option value='35'>35</option>" +
				"<option value='36'>36</option>" +
				"<option value='37'>37</option>" +
				"<option value='38'>38</option>" +
				"<option value='39'>39</option>" +
				"<option value='40'>40</option>" +
				"<option value='41'>41</option>" +
				"<option value='42'>42</option>" +
				"<option value='43'>43</option>" +
				"<option value='44'>44</option>" +
				"<option value='45'>45</option>" +
				"<option value='46'>46</option>" +
				"<option value='47'>47</option>" +
				"<option value='48'>48</option>" +
				"<option value='49'>49</option>" +
				"<option value='50'>50</option>" +
				"<option value='51'>51</option>" +
				"<option value='52'>52</option>" +
				"<option value='53'>53</option>" +
				"<option value='54'>54</option>" +
				"<option value='55'>55</option>" +
				"<option value='56'>56</option>" +
				"<option value='57'>57</option>" +
				"<option value='58'>58</option>" +
				"<option value='59'>59</option>" +
				"</select>";
		}

		/*
		Makes lat/long bounding box inputs
		*/
		function LocationBoundingBox(){ 
			return "<table class='lon_lat'>" + 
				"<tr><td>Long.</td><td><input id='lon_1' type='text' size='6' onblur='ValidateLongitude(this);Reset();'/></td>" + 
				"<td><input id='lon_2' type='text' size='6' onblur='ValidateLongitude(this);Reset();'/></td></tr>" +
				"<tr><td>Lat.</td><td><input id='lat_1' type='text' size='6' onblur='ValidateLatitude(this);Reset();'/></td>" + 
				"<td><input id='lat_2' type='text' size='6' onblur='ValidateLatitude(this);Reset();'/></td></tr>" +
				"</table>";
		}

		/**
		Is between -180 and 180 degrees
		 */
		function ValidateLongitude(element){
			var value = element.value;
			var valid = true;
			if(value.match(/\S/g) && isNaN(value)){
				alert("value is not numeric");
				valid = false;
			}
			if(valid && (value > 180 || value < -180)){
				alert("invalid longitude value");
				valid = false;
			}
			if(!valid) element.value = "";
			return valid;
		}

		/**
		Is between -90 and 90 degrees
		 */
		function ValidateLatitude(element){
			var value = element.value;
			var valid = true;
			if(value.match(/\S/g) && isNaN(value)){
				alert("latitude value is not numeric");
				valid = false;
			}
			if(valid && (value > 90 || value < -90)){
				alert("invalid longitude value");
				valid = false;
			}
			if(!valid) element.value = "";
			return valid;
		}

		/*** OGC filter clause generation functions ***/


		function GetInstallationsFilter(){
			var element;
			var bbox;
			var filter = "";
			if(element = document.getElementById('installation_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:installationId', document.getElementById('installation_id_operator').value, value);	
			}
			if(element = document.getElementById('name')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:installationId', document.getElementById('name_operator').value, value);
			}
			/*if(element = document.getElementById('start_date')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:detection_timestamp', document.getElementById('start_date_operator').value, value);	
			}
			if(element = document.getElementById('end_date')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:detection_timestamp', document.getElementById('end_date_operator').value, value);	
			}
			if(element = document.getElementById('species_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:species_id', document.getElementById('species_id_operator').value, value);	
			}
			if(element = document.getElementById('tag_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:tag_id', document.getElementById('tag_id_operator').value, value);	
			}
			if(bbox = GetBoundingBoxFilter('aatams:location')){
				filter += bbox;	
			}*/
			return BuildFilterKVP(filter);
		}

		function GetDeploymentsFilter(){
			var element;
			var bbox;
			var filter = "";
			if(element = document.getElementById('installation_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:within/aatams:Installation/aatams:installationId',
						       	document.getElementById('installation_id_operator').value, value);	
			}
			if(element = document.getElementById('deployment_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:deploymentId', document.getElementById('deployment_id_operator').value, value);
			}
			/*if(element = document.getElementById('start_date')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:detection_timestamp', document.getElementById('start_date_operator').value, value);	
			}
			if(element = document.getElementById('end_date')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:detection_timestamp', document.getElementById('end_date_operator').value, value);	
			}
			if(element = document.getElementById('species_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:species_id', document.getElementById('species_id_operator').value, value);	
			}
			if(element = document.getElementById('tag_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:tag_id', document.getElementById('tag_id_operator').value, value);	
			}*/
			if(bbox = GetBoundingBoxFilter('aatams:location')){
				filter += bbox;	
			}
			return BuildFilterKVP(filter);
		}

		function GetDetectionsFilter(){
			var element;
			var bbox;
			var filter = "";
			if(element = document.getElementById('deployment_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:detector/aatams:Deployment/aatams:deploymentId',
						       	document.getElementById('deployment_id_operator').value, value);	
			}
			if(element = document.getElementById('detection_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:detectionId', document.getElementById('detection_id_operator').value, value);
			}
			if(element = document.getElementById('start_date')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:detectionUtcTimeStamp', document.getElementById('start_date_operator').value, DateTimeFormat(value));	
			}
			if(element = document.getElementById('end_date')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:detectionUtcTimeStamp', document.getElementById('end_date_operator').value, DateTimeFormat(value));	
			}
			if(element = document.getElementById('tag_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:detected/aatams:Device/aatams:deviceId', document.getElementById('tag_id_operator').value, value);	
			}
			if(bbox = GetBoundingBoxFilter('aatams:detector/aatams:Deployment/aatams:location')){
				filter += bbox;	
			}
			return BuildFilterKVP(filter);

		}

		function GetDetectionDeploymentAnimalSpeciesFilter(){
			var element;
			var value;
			var bbox;
			var filter = "";
			if(element = document.getElementById('species_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:speciesId', document.getElementById('species_id_operator').value, value);	
			}
			if(element = document.getElementById('genus_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:genusId', document.getElementById('genus_id_operator').value, value);
			}
			if(element = document.getElementById('animal_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:animalId',	document.getElementById('animal_id_operator').value, value);	
			}
			if(element = document.getElementById('surgery_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:surgeryId', document.getElementById('surgery_id_operator').value, value);
			}
			if(element = document.getElementById('installation_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:installationId', document.getElementById('installation_id_operator').value, value);	
			}
			if(element = document.getElementById('deployment_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:deploymentId', document.getElementById('deployment_id_operator').value, value);
			}
			if(element = document.getElementById('tag_name')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:tagName', document.getElementById('tag_name_operator').value, value);	
			}
			if(element = document.getElementById('tag_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:tagId', document.getElementById('tag_id_operator').value, value);	
			}
			if(element = document.getElementById('tag_model_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:tagModelId', document.getElementById('tag_model_id_operator').value, value);	
			}
			if(element = document.getElementById('receiver_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:receiverId', document.getElementById('receiver_id_operator').value, value);	
			}
			if(element = document.getElementById('receiver_model_id')){
				value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:receiverModelId', document.getElementById('receiver_model_id_operator').value, value);	
			}
			if(value = GetDateTimeFilter('start_date')){
				if(value != "")
					filter += Comparison('aatams:detectionUtcTimeStamp', document.getElementById('start_date_operator').value, DateTimeFormat(value));	
			}
			if(value = GetDateTimeFilter('end_date')){
				if(value != "")
					filter += Comparison('aatams:detectionUtcTimeStamp', document.getElementById('end_date_operator').value, DateTimeFormat(value));	
			}

			if(bbox = GetBoundingBoxFilter('aatams:location')){
				filter += bbox;	
			}
			return BuildFilterKVP(filter);

		}

		function GetTagsFilter(){
			var filter = Comparison('aatams:deviceType', 1, 'TRANSMITTER');
			if(element = document.getElementById('device_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:deviceId', document.getElementById('device_id_operator').value, value);	
			}
			if(element = document.getElementById('model_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:specification/aatams:Model/aatams:modelId', document.getElementById('model_id_operator').value, value);
			}
			if(element = document.getElementById('device_name')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:name', document.getElementById('device_name_operator').value, value);
			}
			if(element = document.getElementById('model_name')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:specification/aatams:Model/aatams:name', document.getElementById('model_name_operator').value, value);
			}
			return BuildFilterKVP(filter);
		}

		function GetReceiversFilter(){
			var filter = Comparison('aatams:deviceType', 1, 'RECEIVER');
			if(element = document.getElementById('device_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:deviceId',
						       	document.getElementById('device_id_operator').value, value);	
			}
			if(element = document.getElementById('model_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:specification/aatams:Model/aatams:modelId', document.getElementById('model_id_operator').value, value);
			}
			if(element = document.getElementById('device_name')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:name', document.getElementById('device_name_operator').value, value);
			}
			if(element = document.getElementById('model_name')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:specification/aatams:Model/aatams:name', document.getElementById('model_name_operator').value, value);
			}
			return BuildFilterKVP(filter);
		}

		function GetSurgeriesFilter(){
			var element;
			var bbox;
			var filter = "";
			if(element = document.getElementById('surgery_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:surgeryId', document.getElementById('surgery_id_operator').value, value);	
			}
			if(element = document.getElementById('animal_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:surgeryOn/aatams:Animal/aatams:animalId', document.getElementById('animal_id_operator').value, value);
			}
			/*if(element = document.getElementById('start_date')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:surgery_timestamp', document.getElementById('start_date_operator').value, value);	
			}
			if(element = document.getElementById('end_date')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:surgery_timestamp', document.getElementById('end_date_operator').value, value);	
			}*/
			if(element = document.getElementById('species_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:speciesId', document.getElementById('species_id_operator').value, value);	
			}
			if(element = document.getElementById('device_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:implanted/aatams:Device/aatams:deviceId', document.getElementById('device_id_operator').value, value);	
			}
			if(element = document.getElementById('device_name')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:implanted/aatams:Device/aatams:name', document.getElementById('device_name_operator').value, value);
			}
			if(bbox = GetBoundingBoxFilter('aatams:location')){
				filter += bbox;	
			}
			return BuildFilterKVP(filter);
		}


		function GetAnimalsFilter(){
			var filter = "";
			if(element = document.getElementById('animal_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:animalId', document.getElementById('animal_id_operator').value, value);	
			}
			/*if(element = document.getElementById('genus_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:classification/aatams:Species/aatams:genus', document.getElementById('genus_id_operator').value, value);
			}*/
			if(element = document.getElementById('species_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:classification/aatams:Species/aatams:speciesId', document.getElementById('species_id_operator').value, value);
			}
			return BuildFilterKVP(filter);
		}

		function GetSpeciesFilter(){
			var filter = "";
			if(element = document.getElementById('species_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:speciesId', document.getElementById('species_id_operator').value, value);
			}
			if(element = document.getElementById('genus_id')){
				var value = element.value.replace(/^\s+|\s+$/g, '');
				if(value != "")
					filter += Comparison('aatams:genusId', document.getElementById('genus_id_operator').value, value);
			}
			return BuildFilterKVP(filter);
		}

		function BuildFilterKVP(filter){
			if(filter != null && filter.match(/\S/g)){
				if(predicate_count > 1)
                                	filter = "<ogc:And>" + filter + "</ogc:And>";
				filter = "&filter=<ogc:Filter xmlns:ogc='http://www.opengis.net/ogc' xmlns:aatams='http://www.imos.org.au/aatams' xmlns:gml='http://www.opengis.net/gml'>" + filter + "</ogc:Filter>";
				return filter.replace(/\s/g, '%20');
			}
			else
				return "";
		}
		/**
		Generates an OGC filter Comparison clause
		*/
		function Comparison(name, operator, value){
			predicate_count++;
			switch(parseInt(operator)){
			case 1:
				return "<ogc:PropertyIsEqualTo><ogc:PropertyName>" + name + "</ogc:PropertyName>" +
					"<ogc:Literal>" + Sanitize(value) + "</ogc:Literal></ogc:PropertyIsEqualTo>";
				break;
			case 2:
				return "<ogc:PropertyIsLessThanOrEqualTo><ogc:PropertyName>" + name + "</ogc:PropertyName>" +
					"<ogc:Literal>" + Sanitize(value) + "</ogc:Literal></ogc:PropertyIsLessThanOrEqualTo>";
				break;
			case 3:
				return "<ogc:PropertyIsGreaterThanOrEqualTo><ogc:PropertyName>" + name + "</ogc:PropertyName>" +
					"<ogc:Literal>" + Sanitize(value) + "</ogc:Literal></ogc:PropertyIsGreaterThanOrEqualTo>";
				break;
			case 4:
				return "<ogc:PropertyIsLessThan><ogc:PropertyName>" + name + "</ogc:PropertyName>" +
					"<ogc:Literal>" + Sanitize(value) + "</ogc:Literal></ogc:PropertyIsLessThan>";
				break;
			case 5:
				return "<ogc:PropertyIsGreaterThan><ogc:PropertyName>" + name + "</ogc:PropertyName>" +
					"<ogc:Literal>" + Sanitize(value) + "</ogc:Literal></ogc:PropertyIsGreaterThan>";
				break;
			case 6:
				return "<ogc:PropertyIsNotEqualTo><ogc:PropertyName>" + name + "</ogc:PropertyName>" +
					"<ogc:Literal>" + Sanitize(value) + "</ogc:Literal></ogc:PropertyIsNotEqualTo>";
				break;
			case 7:
				return "<ogc:PropertyIsNull><ogc:PropertyName>" + name + "</ogc:PropertyName></ogc:PropertyIsNull>";
				break;				
			default:
				throw new Error("unknown operator symbol: " + operator);
			}
		}

		/**
		Generates an OGC Bounding Box filter clause
		 */
		function GetBoundingBoxFilter(name){
			var element;
			var lat_1 = '';
			var lat_2 = '';
			var lon_1 = '';
			var lon_2 = '';
			if(element = document.getElementById('lat_1'))
				lat_1 = element.value;
			else
				throw new Error('lat_1 element not found');
			if(element = document.getElementById('lat_2'))
				lat_2 = element.value;
			else
				throw new Error('lat_2 element not found');
			if(element = document.getElementById('lon_1'))
				lon_1 = element.value;
			else
				throw new Error('lon_1 element not found');
			if(element = document.getElementById('lon_2'))
				lon_2 = element.value;
			else
				throw new Error('lon_2 element not found');
			//are any values set?
			if(lat_1.match(/\S/g) || lat_2.match(/\S/g) || lon_1.match(/\S/g) || lon_2.match(/\S/g) ){
				//are all values set?
				if(lat_1.match(/\S/g) && lat_2.match(/\S/g) && lon_1.match(/\S/g) && lon_2.match(/\S/g) ){
					predicate_count++;
					var v1, v2;
					//find smallest lat.
					v1 = parseFloat(lat_1);
					v2 = parseFloat(lat_2);
					if(v1 < v2){
						lat_1 = v1;
						lat_2 = v2;
					}
					else{
						lat_1 = v2,
						lat_2 = v1;
					}
					//find smallest lon.
					v1 = parseFloat(lon_1);
					v2 = parseFloat(lon_2);
					if(v1 < v2){
						lon_1 = v1;
						lon_2 = v2;
					}
					else{
						lon_1 = v2,
						lon_2 = v1;
					}
					//build the filter clause
					return "<ogc:BBOX><ogc:PropertyName>" + name + "</ogc:PropertyName><gml:Envelope>" + 
						"<gml:lowerCorner>" + lon_1 + " " + lat_1 + "</gml:lowerCorner>" + 
						"<gml:upperCorner>" + lon_2 + " " + lat_2 + "</gml:upperCorner></gml:Envelope></ogc:BBOX>";
				}
				else{
					alert("All Latitude and Longitude boxes must contain a valid value for bounding box filter to be used");
					return '';
				}	
			}
			else
				return ''; //no bbox
		}

		/**
		Assembles the entered year, month, day and times values into a single string
		 */
		function GetDateTimeFilter(id){
			var year = document.getElementById( id + '_year').value;
			var month = document.getElementById( id + '_month').value;
			var day = document.getElementById( id + '_day').value;
			var hour = document.getElementById( id + '_hour').value;
			var minute = document.getElementById( id + '_minute').value;
			var second = document.getElementById( id + '_second').value;
			if(year != '' || month != '' || day != ''){
				if(year != '' && month != '' && day != '')
					return year + "-" + month + "-" + day + " " + hour + ":" + minute + ":" + second ;
				else
					throw new Error("The year-month-day values (" + year + "-" + month + "-" + day + ") selected are invalid, please check");
			}
			return null; 
		}

		/**
		Replaces illegal XML characters in strings
		 */
		function Sanitize(value){
			if(value != null){
				value = value.replace(/&/g, '&amp;');
				value = value.replace(/</g, '&lt;');
				value = value.replace(/'/g, '&apos;');
				value = value.replace(/>/g, '&gt;');
			}
			return value;
		}

		/**
		Gets the checked value of a group of radio buttons	
		*/
		function GetCheckedValue(name) {
			var radio = document.getElementsByName(name);
			if(!radio)
				return "";
			if(radio.checked)
				return radio.value;
			else{
				for(var i = 0; i < radio.length; i++){
					if(radio[i].checked){
						return radio[i].value;
					}
				}
			}
			return "";
		}

		/**
		Formats a date string as an xsd:dateTime 
		*/
function DateTimeFormat(val) {
	alert(val);
			if(!val){
				throw new Error("datetime param is null");
			}
			else{
				var tmp = val.replace(/\-/g,"/");
				if(!isNaN(Date.parse(tmp))){
					var date = new Date(tmp);
					return date.format("yyyy-MM-ddTHH:mm:ss");
				}
				else{
					throw new Error("invalid datetime: " + val);
				}
			}
		}

		/**
		Selects a particular feature type radion button
		 */
		function SelectType(index){
			var radio = document.getElementsByName('search_type')[index];
			radio.checked = true;
			SetFeatureType(radio.value);
		}

		/**
		Selects a particular format type radio button
		 */
		function SelectFormat(index){
			document.getElementsByName('output_format')[index].checked = true;
		}

		/**
		  Loads an URL into a DOM Document object.
		  (see http://blogs.msdn.com/xmlteam/archive/2006/10/23/using-the-right-version-of-msxml-in-internet-explorer.aspx)
		 */
		function LoadXMLDoc(url){
			var xmlDoc;
			if(window.ActiveXObject){
				try{
					xmlDoc=new ActiveXObject("Msxml2.DOMDocument.6.0");
				}
				catch(e){
					try{
						xmlDoc=new ActiveXObject("Msxml.DOMDocument");
					}
					catch(e){
						throw new Error("Cannot instantiate Msxml.DOMDocument object");
					}
				} 
			}
			else if(document.implementation && document.implementation.createDocument){
  				xmlDoc=document.implementation.createDocument("","",null);
  			}
			else{
  				throw new Error('Your browser cannot handle this script');
  			}
			xmlDoc.async=false;
			xmlDoc.load(url);
			return(xmlDoc);
		}

		/**
 		Sets up a tranformation to be initiated when clean results page loads,
		(need to find 'results' div in results page to replace it). 
		 */
		function DisplayDataNew(do_count)
		{
			switch( GetCheckedValue('output_format')){
			case 'xml':
				pending_request = null;
				DisplayData(do_count); //no transformation needed
				return;
				break;
			case 'html':
				pending_request = BuildWFSRequest(do_count);
				pending_xslt = document.getElementById('wfs_uri').value.replace('/services','/xslt/xhtml_1.xsl');
				break;
			case 'csv':
				pending_request = BuildWFSRequest(do_count);
				pending_xslt = document.getElementById('wfs_uri').value.replace('/services','/xslt/csv_1.xsl');
				break;
			default:
				alert('unknown format');
			}
			//load blank results page and wait;
			//onload function in results page calls LoadResults() below.	
			parent.frames[1].location = "results.html";
		}

		/**
 		On client transformation routine
		 */
		function LoadResults(){
			if(pending_request != null)
				parent.frames[1].location = pending_request;
			return;
			/*try{
				if(pending_request != null && pending_xslt != null){
					var xml = LoadXMLDoc(pending_request);
					var xsl = LoadXMLDoc(pending_xslt)
					var div = parent.frames[1].document.getElementById('results');
					if(window.ActiveXObject){
						div.innerHTML = xml.transformNode(xsl);
  					}
					else if(document.implementation && document.implementation.createDocument)
					{
						xsltProcessor = new XSLTProcessor();
						xsltProcessor.importStylesheet(xsl);
						resultDocument = xsltProcessor.transformToFragment(xml,document);
						div.parentNode.replaceChild(resultDocument,div);
					}
				}
			}
			catch(e){
				alert(e);
			}*/
		}

		//]]>
	</script>
    </head>
    <body onload="Init();">
        <div id="main">
            <div id="data_source" class="param_name">Data Source (Web Feature Service): <input id="wfs_uri" type="textbox" value="http://localhost:8080/deegree-wfs/services" disabled="true"/>
	    </div>
	    <h2>AATAMS DATA ACCESS</h2>
	    <noscript><h3>IMPORTANT: Using This Page Requires Javascript To Be Enabled!!</h3></noscript>
            <table class="search">
                <thead>
                    <tr>
                        <th id="features_header">Datasets</th>

                        <th id="params_header">Filter Parameters for INSTALLATIONS</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="features">
                                <ul>

                                    <li>
				        <input type="radio" name="search_type" value="installations" title="Installations of groups of receivers as arrays or curtains" onclick="SetFeatureType(this.value);Reset();"/>
				        <span class="feature_type" onclick="SelectType(0);Reset();">Installations (Array/Curtain)</span>
                                    </li>
                                    <li>
                                        <input type="radio" name="search_type" value="deployments" title="Receiver deployments" onclick="SetFeatureType(this.value);Reset();"/>
                                        <span class="feature_type" onclick="SelectType(1);Reset();">Receiver Deployments</span>
                                    </li>

                                    <!--<li>
                                        <input type="radio" name="search_type" value="detections" title="Tag detections" onclick="SetFeatureType(this.value);Reset();"/>
                                        <span class="feature_type" onclick="SelectType(2);Reset();">Detections</span>
					</li>-->
                                    <li>
                                        <input type="radio" name="search_type" value="detection_deployment_animal_species" title="Tag detections" onclick="SetFeatureType(this.value);Reset();"/>
                                        <span class="feature_type" onclick="SelectType(2);Reset();">Detections</span>
                                    </li>

                                    <li>
                                        <input type="radio" name="search_type" value="tags" title="Transmitter(tag) devices" onclick="SetFeatureType(this.value);Reset();"/>
                                        <span class="feature_type" onclick="SelectType(3);Reset();">Tags (Transmitter Devices)</span>
                                    </li>
                                    <li>
                                        <input type="radio" name="search_type" value="receivers" title="Receiver devices" onclick="SetFeatureType(this.value)Reset();"/>
                                        <span class="feature_type" onclick="SelectType(4);Reset();">Receivers (Receiver Devices)</span>
                                    </li>

                                    <li>
                                        <input type="radio" name="search_type" value="surgeries" title="Surgeries" onclick="SetFeatureType(this.value);Reset();"/>
                                        <span class="feature_type" onclick="SelectType(5);Reset();">Surgeries</span>
                                    </li>
                                    <li>
                                        <input type="radio" name="search_type" value="animals" title="Tagged animals" onclick="SetFeatureType(this.value);Reset();"/>
                                        <span class="feature_type" onclick="SelectType(6);Reset();">Animals</span>
                                    </li>

                                    <li>
                                        <input type="radio" name="search_type" value="species" title="Detected species" onclick="SetFeatureType(this.value);Reset();"/>
                                        <span class="feature_type" onclick="SelectType(7);Reset();">Species</span>
                                    </li>
                                </ul>
                            </div>
                            <br/>
                            <div id="request">
                                <p>Maximum records to download: <input id="max_members" type="textbox" value="100"/>
                                </p>
                                <p>Format:
                                    <input type="radio" name="output_format" value="xml" title="Select for XML format" onclick="Reset();"/>
                                    <span class="format_type" onclick="SelectFormat(0);Reset();">XML</span>
                                    <input type="radio" name="output_format" value="html" title="Select for HTML format" onclick="Reset();"/>
                                    <span class="format_type" onclick="SelectFormat(1);Reset();">HTML</span>
                                    <input type="radio" name="output_format" value="csv" checked="checked" title="Select for CSV format" onclick="Reset();"/>
                                    <span class="format_type" onclick="SelectFormat(2);Reset();">CSV</span>
                                </p>
                                <p>
					<input class="button" id="get_data" type="button" value="Display Data" onclick="DisplayData(false);" title="Click to request dataset displayed below"/> 
					<!--<input class="button" id="get_data" type="button" value="Display Data 2" onclick="DisplayDataNew(false);" title="Click to request dataset displayed below"/>-->				
   			    <input class="button" id="get_hit_count" type="button" value="Display Record Count" onclick="DisplayData(true);" 
			    title="Click to request feature member count displayed below"/>
   			    <!--<input class="button" id="get_hit_count" type="button" value="Display Record Count 2" onclick="DisplayDataNew(true);" 
			    title="Click to request feature member count displayed below"/> -->

			    </p>
			    <p class="download">To download data, right click on <a id="download" href="" onclick="alert('hello');">this link</a> and select "Save Link(Target) As ..."
			    </p>
                            </div>
                            <input id="query" type="textarea" value="" style="width:100%;visibility:hidden;"/>
                        </td>
                        <td>
                            <div id="params">&nbsp;
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
   </body>
</html>
