
set role to aatams;
set role to aatams;
SET
-- Low selectivity filtering (large number of rows returned for each filter)
-- Test Case 1 - 2716283 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=8.278..13.000 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=8.275..12.961 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=2.026..5.681 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.786..3.174 rows=98 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.528..2.859 rows=98 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.473..2.738 rows=98 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.297..1.470 rows=98 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.240..0.286 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.213..0.242 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.177..0.197 rows=2 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.139..0.139 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.034..0.034 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.014..0.014 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.018..0.071 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.035..0.053 rows=2 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.020..0.021 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.010..0.016 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.008 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.053..0.558 rows=49 loops=2)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=1.152..1.152 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.692 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.035..0.035 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.014 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.210..0.210 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.142 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.022..0.024 rows=1 loops=98)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.018..0.020 rows=1 loops=98)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.014..0.015 rows=1 loops=98)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=98)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.006..0.006 rows=1 loops=98)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=92)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=92)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.003..0.004 rows=1 loops=92)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=92)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 13.577 ms
(61 rows)

-- Test Case 2 - 3913743 rows limited to first 100
explain analyze select * from detection_extract_test_view
where spcode = '37018030'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4741.75..11153.44 rows=100 width=279) (actual time=15864.192..15968.441 rows=100 loops=1)
   ->  Hash Left Join  (cost=4741.75..5892981.17 rows=91836 width=279) (actual time=15864.190..15968.416 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 3511437
         ->  Hash Left Join  (cost=2253.55..4336436.41 rows=18367253 width=239) (actual time=53.421..14538.431 rows=3697664 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=1000.03..3698334.06 rows=17263859 width=193) (actual time=27.000..12029.218 rows=3691091 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=26.850..10263.206 rows=5389186 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=26.805..7922.286 rows=5389186 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=26.041..5472.751 rows=5389186 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.038..1164.273 rows=5389186 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=25.978..25.978 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=8.720..21.849 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=8.699..19.444 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.829..10.007 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..2.691 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.815..2.815 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.207..1.816 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.001..0.566 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.173..0.173 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.062..0.124 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.013 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.043..0.043 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.016 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=5.844..5.844 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..3.448 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.011..0.011 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.007 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.752..0.752 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.423 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.032..0.032 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.016 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.134..0.134 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.094 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=26.336..26.336 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=15.873..24.059 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=6.260..11.821 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=3.948..7.626 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.017..1.294 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=3.886..3.886 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.018..2.583 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=2.280..2.280 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..1.162 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=9.591..9.591 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.558..7.990 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.021..1.422 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.511..3.511 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.539 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=53.590..53.590 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.021..35.675 rows=36587 loops=1)
 Total runtime: 15988.182 ms
(80 rows)

-- Test Case 3 - 17098775 rows limited to first 100
explain analyze select * from detection_extract_test_view
where timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                         QUERY PLAN                                                                                                         
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3.39..571.82 rows=100 width=279) (actual time=0.889..11.431 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=3.39..31977844.24 rows=5625584 width=279) (actual time=0.887..11.406 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=3.10..21831467.95 rows=5625584 width=239) (actual time=0.834..10.294 rows=100 loops=1)
               ->  Nested Loop  (cost=1.69..12376246.08 rows=5287633 width=193) (actual time=0.756..8.227 rows=100 loops=1)
                     ->  Nested Loop  (cost=1.55..11308727.81 rows=5372518 width=187) (actual time=0.751..7.924 rows=100 loops=1)
                           ->  Nested Loop  (cost=1.41..8537379.53 rows=16144362 width=168) (actual time=0.746..7.645 rows=100 loops=1)
                                 ->  Merge Join  (cost=1.13..3572860.21 rows=16144362 width=168) (actual time=0.705..7.176 rows=100 loops=1)
                                       Merge Cond: (receiver_deployment.id = valid_detection.receiver_deployment_id)
                                       ->  Nested Loop  (cost=0.56..188303.48 rows=5710 width=132) (actual time=0.687..1.783 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..186931.88 rows=5710 width=135) (actual time=0.682..1.757 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..184575.50 rows=5710 width=120) (actual time=0.674..1.729 rows=2 loops=1)
                                                         Join Filter: (installation.project_id = receiver_project.id)
                                                         Rows Removed by Join Filter: 86
                                                         ->  Nested Loop  (cost=0.28..178149.81 rows=5710 width=89) (actual time=0.662..1.673 rows=2 loops=1)
                                                               Join Filter: (installation_station.installation_id = installation.id)
                                                               Rows Removed by Join Filter: 112
                                                               ->  Nested Loop  (cost=0.28..168724.94 rows=5710 width=73) (actual time=0.655..1.595 rows=2 loops=1)
                                                                     Join Filter: (receiver_deployment.station_id = installation_station.id)
                                                                     Rows Removed by Join Filter: 2873
                                                                     ->  Index Scan using receiver_deployment_pkey on receiver_deployment  (cost=0.28..457.79 rows=5710 width=24) (actual time=0.008..0.010 rows=2 loops=1)
                                                                     ->  Materialize  (cost=0.00..55.46 rows=1964 width=57) (actual time=0.005..0.584 rows=1438 loops=2)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.005..0.506 rows=1964 loops=1)
                                                               ->  Materialize  (cost=0.00..3.65 rows=110 width=32) (actual time=0.002..0.030 rows=57 loops=2)
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.019 rows=110 loops=1)
                                                         ->  Materialize  (cost=0.00..2.12 rows=75 width=39) (actual time=0.002..0.019 rows=44 loops=2)
                                                               ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.018 rows=75 loops=1)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.008..0.009 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.009 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.009 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..3183595.42 rows=16144362 width=52) (actual time=0.014..5.325 rows=100 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 2460
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=100)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.016 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.007 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=99)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=99)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 11.848 ms
(59 rows)

-- Test Case 4 -  2716283 ^ 3913743 -> 1420919 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=65.142..67.177 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=65.140..67.161 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 115
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=23.188..24.929 rows=221 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.096..2.627 rows=219 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.949..2.363 rows=219 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.907..2.215 rows=219 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.109..1.282 rows=219 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.095..0.182 rows=5 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 61
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.088..0.141 rows=5 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.082..0.095 rows=5 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.072..0.072 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.006 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.021 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.016 rows=5 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.007 rows=1 loops=5)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.004 rows=13 loops=5)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.029..0.196 rows=44 loops=5)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.788..0.788 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.474 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.097 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=22.073..22.073 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.344..19.951 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.224..9.246 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.507..5.712 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.611 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.486..2.486 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.511 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.704..1.704 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.823 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.102..8.102 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.029..6.886 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.751 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.016..3.016 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.477 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.310..41.310 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.497 rows=36587 loops=1)
 Total runtime: 68.589 ms
(74 rows)

-- Test Case 5 - 2716283 ^ 17098775 -> 902906 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=4.557..7.877 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=4.555..7.850 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=4.473..6.785 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=4.419..4.776 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=4.269..4.561 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=4.227..4.463 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=3.450..3.614 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.092..0.168 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.088..0.147 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.053 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.034 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.006 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.009 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.013 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.020..0.021 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.004 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.817..0.847 rows=25 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.138..0.138 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.759..0.759 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.426 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.088 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 8.176 ms
(62 rows)

-- Test Case 6 - 3913743 ^ 17098775 -> 2233756 rows limited to first 100
explain analyze select * from detection_extract_test_view
where spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..108148.56 rows=100 width=279) (actual time=28.897..33.823 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=930.07..30159347.10 rows=28128 width=279) (actual time=28.896..33.793 rows=100 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 225
         ->  Nested Loop Left Join  (cost=929.78..20152836.88 rows=5625584 width=239) (actual time=21.684..31.856 rows=325 loops=1)
               ->  Nested Loop  (cost=928.38..10697615.02 rows=5287633 width=193) (actual time=21.586..25.654 rows=325 loops=1)
                     ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=21.577..24.735 rows=325 loops=1)
                           ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=21.570..23.841 rows=325 loops=1)
                                 ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=21.545..22.568 rows=325 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.018..0.722 rows=325 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 1154
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.505..21.505 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.216..17.918 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.172..15.513 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.225..8.332 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..0.914 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.213..2.213 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.166..1.373 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.251 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.157..0.157 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.058..0.123 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.014 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.048..0.048 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.001..0.024 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.935..3.935 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.151 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.036..0.036 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.028 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=325)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=325)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=325)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.015..0.018 rows=1 loops=325)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=325)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.009..0.011 rows=1 loops=325)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=325)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=325)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=325)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=325)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=325)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=325)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=325)
               Index Cond: (animal.species_id = id)
 Total runtime: 34.134 ms
(65 rows)

-- Test Case 7 - 2716283 ^ 3913743 ^ 17098775 -> 690003 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=66.160..67.091 rows=100 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=66.158..67.065 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 2
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.873..24.247 rows=102 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.900..2.187 rows=102 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.755..1.991 rows=102 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.713..1.894 rows=102 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.908..1.030 rows=102 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.053..0.085 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.049..0.072 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.048 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.034 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.010 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.013 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.204..0.227 rows=26 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.091..0.091 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.794..0.794 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.486 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.015 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.134..0.134 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.088 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.955..21.955 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.359..19.876 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.232..9.262 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.484..5.663 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.568 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.464..2.464 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.501 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.737..1.737 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.006..0.823 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.117..8.117 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.039..6.767 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.702 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.025..3.025 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.530 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=42.134..42.134 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.536 rows=36587 loops=1)
 Total runtime: 68.490 ms
(75 rows)

 
-- High selectivity filtering (small number of rows returned for each filter)
-- Test Case 8 - 5909 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=1.632..5.175 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=1.631..5.151 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.517..4.014 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.413..1.873 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.263..1.664 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.222..1.569 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.461..0.733 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.359..0.395 rows=3 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 31
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.351..0.370 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.344..0.350 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.291..0.291 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 872
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.103 rows=873 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.051..0.055 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.004 rows=11 loops=3)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.003 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.046..0.092 rows=33 loops=3)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.751..0.751 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.435 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.016 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.091 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.018..0.020 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.014..0.017 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.011..0.013 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.008..0.009 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.005 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.463 ms
(61 rows)

-- Test Case 9 - 2153 rows
set geqo_threshold to 12;
SET
explain analyze select * from detection_extract_test_view
where spcode = '37018003'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4741.75..11153.44 rows=100 width=279) (actual time=91994.758..92036.639 rows=100 loops=1)
   ->  Hash Left Join  (cost=4741.75..5892981.17 rows=91836 width=279) (actual time=91994.757..92036.619 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 20828659
         ->  Hash Left Join  (cost=2253.55..4336436.41 rows=18367253 width=239) (actual time=45.587..73402.227 rows=25389319 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=1000.03..3698334.06 rows=17263859 width=193) (actual time=22.141..56954.209 rows=23441746 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=21.995..46541.672 rows=23441777 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=21.950..35928.745 rows=23441777 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=21.184..25197.978 rows=23441777 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.002..5335.471 rows=23441777 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.162..21.162 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.237..17.860 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.219..15.440 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.258..8.293 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..0.888 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.246..2.246 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.159..1.479 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.287 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.150..0.150 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.050..0.113 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.016 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.037..0.037 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.013 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.949..3.949 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.085 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.009..0.009 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.757..0.757 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.427 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.016 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.133..0.133 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.082 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=23.417..23.417 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=13.730..21.265 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.794..9.737 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.837..6.003 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.602 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.794..2.794 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.004..1.583 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.935..1.935 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.827 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.915..8.915 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.523..7.331 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.004..0.716 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.500..3.500 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.551 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.376..41.376 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..24.323 rows=36587 loops=1)
 Total runtime: 92404.321 ms
(80 rows)

-- Test Case 10 - 1065 rows
explain analyze select * from detection_extract_test_view
  where timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=398.97..1704.98 rows=100 width=279) (actual time=6.501..11.442 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=398.97..6772.29 rows=488 width=279) (actual time=6.499..11.416 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=398.68..5892.13 rows=488 width=239) (actual time=6.424..10.275 rows=100 loops=1)
               ->  Nested Loop  (cost=397.27..4950.72 rows=459 width=193) (actual time=6.307..8.172 rows=100 loops=1)
                     ->  Nested Loop  (cost=397.13..4858.12 rows=466 width=187) (actual time=6.300..7.890 rows=100 loops=1)
                           ->  Nested Loop  (cost=396.99..4617.80 rows=1400 width=168) (actual time=6.293..7.625 rows=100 loops=1)
                                 ->  Nested Loop  (cost=396.85..4384.47 rows=1400 width=171) (actual time=6.286..7.365 rows=100 loops=1)
                                       ->  Hash Join  (cost=396.57..3806.73 rows=1400 width=156) (actual time=6.269..6.870 rows=100 loops=1)
                                             Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                             ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.475..6.002 rows=100 loops=1)
                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                   ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.428..5.891 rows=100 loops=1)
                                                         Hash Cond: (installation_station.installation_id = installation.id)
                                                         ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.363..5.773 rows=100 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.258..4.602 rows=100 loops=1)
                                                                     Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                     ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.099..0.325 rows=100 loops=1)
                                                                           Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                     ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.141..4.141 rows=5710 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                           ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..2.550 rows=5710 loops=1)
                                                               ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.097..1.097 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                     ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.549 rows=1964 loops=1)
                                                         ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.056..0.056 rows=110 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.026 rows=110 loops=1)
                                                   ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.039..0.039 rows=75 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.015 rows=75 loops=1)
                                             ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.779..0.779 rows=1519 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                   ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.008..0.439 rows=1519 loops=1)
                                       ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=100)
                                             Index Cond: (id = receiver_deployment.receiver_id)
                                 ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=100)
                                       Index Cond: (id = receiver.model_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..2.04 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.68 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..1.24 rows=1 width=22) (actual time=0.011..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.90 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 11.780 ms
(60 rows)

-- Test Case 11 - 5909 ^ 2153 -> 609 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=68.045..71.765 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=68.043..71.740 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 1332
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=23.163..28.904 rows=1441 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.348..6.007 rows=1435 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.163..5.185 rows=1435 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.122..4.491 rows=1435 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.348..3.010 rows=1435 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.310..0.543 rows=13 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 181
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.302..0.464 rows=13 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.295..0.355 rows=13 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.283..0.295 rows=4 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.006 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.128 rows=898 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.010 rows=3 loops=4)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.007 rows=1 loops=13)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=15 loops=13)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.021..0.138 rows=110 loops=13)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.765..0.765 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.455 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.023 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.172..0.172 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.122 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.798..21.798 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.246..19.782 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.188..9.202 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.465..5.575 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.595 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.444..2.444 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.507 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.711..1.711 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.808 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.049..8.049 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.012..6.784 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.682 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.997..2.997 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.503 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.339..41.339 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..23.974 rows=36587 loops=1)
 Total runtime: 73.231 ms
(74 rows)

-- Test Case 12 - 5909 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.559..4.207 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.557..4.191 rows=55 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3373.72 rows=6 width=239) (actual time=0.508..3.575 rows=55 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3371.58 rows=6 width=239) (actual time=0.502..3.387 rows=55 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3368.94 rows=6 width=215) (actual time=0.495..3.195 rows=55 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3366.85 rows=6 width=215) (actual time=0.489..3.001 rows=55 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3364.85 rows=6 width=215) (actual time=0.481..2.837 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.78..3361.41 rows=6 width=193) (actual time=0.472..2.543 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.468..2.392 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.465..2.236 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.459..2.047 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.452..1.768 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.444..1.512 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.025..1.002 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.249..0.249 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.211 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.053..0.090 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.043..0.068 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.017 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.023..0.023 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.020 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.014 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=55)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=55)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=55)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=55)
               Index Cond: (animal.species_id = id)
 Total runtime: 4.515 ms
(58 rows)

-- Test Case 13 -  2153 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                               QUERY PLAN                                                                                                                                
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4862.46..5820.38 rows=2 width=279) (actual time=33.246..38.638 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=4862.46..5820.38 rows=2 width=279) (actual time=33.244..38.623 rows=55 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 1010
         ->  Hash Right Join  (cost=4862.17..4952.37 rows=488 width=239) (actual time=33.173..34.728 rows=1065 loops=1)
               Hash Cond: (animal.id = animal_release.animal_id)
               ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.486 rows=4023 loops=1)
               ->  Hash  (cost=4856.07..4856.07 rows=488 width=239) (actual time=32.912..32.912 rows=1065 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 352kB
                     ->  Nested Loop Left Join  (cost=4528.01..4856.07 rows=488 width=239) (actual time=25.989..31.482 rows=1065 loops=1)
                           ->  Hash Right Join  (cost=4527.73..4641.32 rows=488 width=215) (actual time=25.978..27.842 rows=1065 loops=1)
                                 Hash Cond: (surgery.tag_id = tag.id)
                                 ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.498 rows=3923 loops=1)
                                 ->  Hash  (cost=4521.63..4521.63 rows=488 width=215) (actual time=25.822..25.822 rows=1065 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 327kB
                                       ->  Nested Loop Left Join  (cost=867.27..4521.63 rows=488 width=215) (actual time=13.087..24.418 rows=1065 loops=1)
                                             ->  Hash Left Join  (cost=866.99..4359.32 rows=488 width=215) (actual time=13.068..20.999 rows=1065 loops=1)
                                                   Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                                   ->  Hash Join  (cost=686.58..4161.98 rows=459 width=193) (actual time=10.219..17.184 rows=1065 loops=1)
                                                         Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                                         ->  Hash Join  (cost=675.68..4144.75 rows=466 width=187) (actual time=10.072..16.499 rows=1065 loops=1)
                                                               Hash Cond: (receiver.organisation_id = organisation.id)
                                                               ->  Hash Join  (cost=673.54..4132.70 rows=1400 width=168) (actual time=10.030..15.857 rows=1065 loops=1)
                                                                     Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                                     ->  Hash Join  (cost=614.36..4054.27 rows=1400 width=168) (actual time=9.205..14.403 rows=1065 loops=1)
                                                                           Hash Cond: (receiver.model_id = device_model.id)
                                                                           ->  Hash Join  (cost=613.00..4033.66 rows=1400 width=171) (actual time=9.187..13.822 rows=1065 loops=1)
                                                                                 Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                                 ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.217..9.057 rows=1065 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.165..8.442 rows=1065 loops=1)
                                                                                             Hash Cond: (installation_station.installation_id = installation.id)
                                                                                             ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.097..7.792 rows=1065 loops=1)
                                                                                                   Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                                   ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.014..6.015 rows=1065 loops=1)
                                                                                                         Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                                         ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.031..1.027 rows=1065 loops=1)
                                                                                                               Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                                                         ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=3.965..3.965 rows=5710 loops=1)
                                                                                                               Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.546 rows=5710 loops=1)
                                                                                                   ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.073..1.073 rows=1964 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                                         ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.474 rows=1964 loops=1)
                                                                                             ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.058..0.058 rows=110 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.021 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.039..0.039 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.015 rows=75 loops=1)
                                                                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.962..3.962 rows=7227 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                       ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.072 rows=7227 loops=1)
                                                                           ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.009..0.009 rows=16 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=1)
                                                                     ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.817..0.817 rows=1519 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                                           ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.486 rows=1519 loops=1)
                                                               ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                                     ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                                                         ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                               ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.091 rows=173 loops=1)
                                                   ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.832..2.832 rows=5307 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                                         ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.005..1.429 rows=5307 loops=1)
                                             ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=1065)
                                                   Index Cond: (id = sensor.tag_id)
                                                   Heap Fetches: 0
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=1065)
                                 Index Cond: (surgery.release_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.002 rows=1 loops=1065)
               Index Cond: (animal.species_id = id)
 Total runtime: 38.969 ms
(76 rows)

-- Test Case 14 -  5909 ^ 2153 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3384.42 rows=1 width=279) (actual time=0.504..3.842 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3384.42 rows=1 width=279) (actual time=0.503..3.824 rows=55 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         ->  Nested Loop Left Join  (cost=29.18..3373.72 rows=6 width=239) (actual time=0.452..3.198 rows=55 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3371.58 rows=6 width=239) (actual time=0.445..3.009 rows=55 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3368.94 rows=6 width=215) (actual time=0.439..2.791 rows=55 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3366.85 rows=6 width=215) (actual time=0.433..2.608 rows=55 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3364.85 rows=6 width=215) (actual time=0.425..2.434 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.78..3361.41 rows=6 width=193) (actual time=0.416..2.178 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.412..2.022 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.408..1.870 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.402..1.675 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.395..1.388 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.388..1.143 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.024..0.652 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.248..0.248 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.058..0.207 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.050..0.087 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.066 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.021 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.006..0.014 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=55)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=55)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=55)
               Index Cond: (animal.species_id = id)
 Total runtime: 4.154 ms
(59 rows)

-- Mixed selectivity filtering
-- Test Case 15 - 5909 ^ 833188 -> 184 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=64.626..73.616 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=64.624..73.586 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         Rows Removed by Filter: 2155
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=23.140..30.465 rows=2267 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.294..6.904 rows=2248 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.149..5.782 rows=2248 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.108..4.760 rows=2248 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.344..2.871 rows=2248 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.306..0.581 rows=19 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 271
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.298..0.484 rows=19 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.292..0.366 rows=19 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.281..0.293 rows=5 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.020 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.123 rows=899 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.010 rows=4 loops=5)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=19)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=15 loops=19)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.008 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.009..0.068 rows=118 loops=19)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.755..0.755 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.397 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.086 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.828..21.828 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.234..19.811 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.190..9.183 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.500..5.628 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.616 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.479..2.479 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.519 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.678..1.678 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.820 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.035..8.035 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.002..6.714 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.676 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.988..2.988 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.439 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.288..41.288 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..24.285 rows=36587 loops=1)
 Total runtime: 75.073 ms
(74 rows)

-- Test Case 16 - 5909 ^ 17098775 -> 3889 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=1.563..4.914 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=1.563..4.891 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=1.518..3.826 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.461..1.793 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.314..1.579 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.272..1.481 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.485..0.618 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.052..0.077 rows=3 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..0.067 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.047 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.034 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.023..0.023 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.006 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.009 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.010 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=3)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.134..0.163 rows=33 loops=3)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 148
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.057..0.057 rows=210 loops=3)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.777..0.777 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.442 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.035..0.035 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.014 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.089 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.017..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.215 ms
(62 rows)

-- Test Case 17 - 2716283 ^ 464 -> 448 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=10382.559..10383.465 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=10382.557..10383.447 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 2696635
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=22.905..9056.691 rows=2716283 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.062..7178.348 rows=2710212 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.915..6012.738 rows=2710212 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.875..4846.093 rows=2710212 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.107..3503.522 rows=2710212 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.094..7.015 rows=282 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 4230
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.087..5.296 rows=282 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.082..2.244 rows=282 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.073..0.803 rows=45 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 1919
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.061 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.019 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.017 rows=110 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.333 rows=1964 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.009..0.022 rows=6 loops=45)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.007..0.008 rows=1 loops=282)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=282)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.021..7.442 rows=9611 loops=282)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.759..0.759 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.432 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.032..0.032 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.087 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.825..21.825 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.145..19.686 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.164..9.146 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.490..5.672 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.517 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.469..2.469 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.498 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.662..1.662 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.821 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=7.972..7.972 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.965..6.696 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.706 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.952..2.952 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.514 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.595..41.595 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.609 rows=36587 loops=1)
 Total runtime: 10385.620 ms
(74 rows)

-- Test Case 18 - 2716283 ^ 2005 -> 4 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2013-06-08 00:00:00+00' and '2013-06-08 01:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3896.81 rows=7 width=279) (actual time=2.726..3.475 rows=4 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3896.81 rows=7 width=279) (actual time=2.724..3.472 rows=4 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3884.18 rows=7 width=239) (actual time=2.670..3.383 rows=4 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3881.69 rows=7 width=239) (actual time=2.661..3.362 rows=4 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3878.61 rows=7 width=215) (actual time=2.653..3.346 rows=4 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3876.17 rows=7 width=215) (actual time=2.645..3.326 rows=4 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3873.84 rows=7 width=215) (actual time=2.638..3.308 rows=4 loops=1)
                                       ->  Nested Loop  (cost=27.78..3870.07 rows=7 width=193) (actual time=2.626..3.281 rows=4 loops=1)
                                             ->  Nested Loop  (cost=27.63..3868.68 rows=7 width=187) (actual time=2.620..3.267 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3864.90 rows=22 width=168) (actual time=2.614..3.250 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3856.39 rows=22 width=168) (actual time=2.591..3.216 rows=4 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 60
                                                               ->  Nested Loop  (cost=27.21..3849.91 rows=22 width=171) (actual time=2.581..3.181 rows=4 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3840.83 rows=22 width=156) (actual time=2.570..3.154 rows=4 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3808.21 rows=1613 width=52) (actual time=0.097..2.115 rows=1839 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-06-08 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-06-08 01:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.689..0.689 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.061..0.562 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.112 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.067 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.016 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.034 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=4)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.002..0.005 rows=16 loops=4)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.003 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.38 rows=1 width=16) (actual time=0.007..0.007 rows=1 loops=4)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.003 rows=1 loops=4)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.53 rows=1 width=22) (actual time=0.005..0.005 rows=1 loops=4)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=4)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=4)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.003..0.003 rows=1 loops=4)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=4)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=4)
               Index Cond: (animal.species_id = id)
 Total runtime: 3.782 ms
(58 rows)

-- Test Case 19 - 464 ^ 17098775 -> 6 rows
explain analyze select * from detection_extract_test_view
where spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..108148.56 rows=100 width=279) (actual time=376616.304..454371.447 rows=6 loops=1)
   ->  Nested Loop Left Join  (cost=930.07..30159347.10 rows=28128 width=279) (actual time=376616.302..454371.440 rows=6 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 17098769
         ->  Nested Loop Left Join  (cost=929.78..20152836.88 rows=5625584 width=239) (actual time=21.560..412048.760 rows=17098775 loops=1)
               ->  Nested Loop  (cost=928.38..10697615.02 rows=5287633 width=193) (actual time=21.500..182458.244 rows=16316319 loops=1)
                     ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=21.492..138861.628 rows=16316319 loops=1)
                           ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=21.484..95931.491 rows=16316319 loops=1)
                                 ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=21.459..37157.704 rows=16316319 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.011..21098.583 rows=16316319 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 36799631
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.427..21.427 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.154..17.929 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.135..15.474 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.205..8.342 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..0.903 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.195..2.195 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.155..1.456 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.264 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.144..0.144 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.048..0.112 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.016 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.018 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.918..3.918 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.064 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.012..0.012 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.007 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=16316319)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=16316319)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=16316319)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.011..0.013 rows=1 loops=16316319)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.009..0.011 rows=1 loops=16316319)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.007..0.009 rows=1 loops=16316319)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.005..0.006 rows=1 loops=16316319)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=16316319)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=11828011)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=11828011)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=12084573)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=12084573)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.001..0.002 rows=1 loops=17098775)
               Index Cond: (animal.species_id = id)
 Total runtime: 454371.777 ms
(65 rows)

-- Test Case 20 - 833188 ^ 5489 -> 210 rows
explain analyze select * from detection_extract_test_view
where spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                         QUERY PLAN                                                                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=1609.87..15898.41 rows=8 width=279) (actual time=23.616..71.164 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=1609.87..15898.41 rows=8 width=279) (actual time=23.614..71.135 rows=100 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         Rows Removed by Filter: 3368
         ->  Hash Left Join  (cost=1609.58..13075.53 rows=1587 width=239) (actual time=23.068..57.544 rows=3468 loops=1)
               Hash Cond: (animal_release.animal_id = animal.id)
               ->  Hash Left Join  (cost=1489.06..12927.24 rows=1587 width=239) (actual time=21.118..53.335 rows=3468 loops=1)
                     Hash Cond: (surgery.release_id = animal_release.id)
                     ->  Hash Left Join  (cost=1287.86..12698.27 rows=1587 width=215) (actual time=18.435..48.316 rows=3468 loops=1)
                           Hash Cond: (tag.id = surgery.tag_id)
                           ->  Hash Left Join  (cost=1142.59..12510.67 rows=1587 width=215) (actual time=16.425..44.045 rows=3357 loops=1)
                                 Hash Cond: (sensor.tag_id = tag.id)
                                 ->  Hash Left Join  (cost=866.99..12201.34 rows=1587 width=215) (actual time=13.080..38.129 rows=3357 loops=1)
                                       Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                       ->  Hash Join  (cost=686.58..11965.89 rows=1492 width=193) (actual time=10.318..32.627 rows=3143 loops=1)
                                             Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                             ->  Hash Join  (cost=675.68..11934.41 rows=1515 width=187) (actual time=10.170..30.631 rows=3143 loops=1)
                                                   Hash Cond: (receiver.organisation_id = organisation.id)
                                                   ->  Hash Join  (cost=673.54..11900.04 rows=4554 width=168) (actual time=10.127..28.822 rows=3143 loops=1)
                                                         Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                         ->  Hash Join  (cost=614.36..11778.24 rows=4554 width=168) (actual time=9.365..26.114 rows=3143 loops=1)
                                                               Hash Cond: (receiver.model_id = device_model.id)
                                                               ->  Hash Join  (cost=613.00..11714.26 rows=4554 width=171) (actual time=9.349..24.451 rows=3143 loops=1)
                                                                     Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                     ->  Hash Join  (cost=337.39..11341.88 rows=4554 width=156) (actual time=5.382..18.098 rows=3143 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Hash Join  (cost=334.70..11276.58 rows=4554 width=125) (actual time=5.330..16.249 rows=3143 loops=1)
                                                                                 Hash Cond: (installation_station.installation_id = installation.id)
                                                                                 ->  Hash Join  (cost=330.23..11209.49 rows=4554 width=109) (actual time=5.262..14.441 rows=3143 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Hash Join  (cost=260.04..11070.99 rows=4554 width=60) (actual time=4.119..11.123 rows=3143 loops=1)
                                                                                             Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                             ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.126..4.151 rows=3143 loops=1)
                                                                                                   Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                                                             ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=3.973..3.973 rows=5710 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                   ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.517 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.133..1.133 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                             ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.543 rows=1964 loops=1)
                                                                                 ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.058..0.058 rows=110 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.027 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.039..0.039 rows=75 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.015 rows=75 loops=1)
                                                                     ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.957..3.957 rows=7227 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                           ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.067 rows=7227 loops=1)
                                                               ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.008..0.008 rows=16 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.002 rows=16 loops=1)
                                                         ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.753..0.753 rows=1519 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                               ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.410 rows=1519 loops=1)
                                                   ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                         ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                                             ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                   ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.091 rows=173 loops=1)
                                       ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.750..2.750 rows=5307 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.004..1.364 rows=5307 loops=1)
                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.334..3.334 rows=7227 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                       ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.528 rows=7227 loops=1)
                           ->  Hash  (cost=96.23..96.23 rows=3923 width=16) (actual time=1.995..1.995 rows=3923 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 184kB
                                 ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.004..0.936 rows=3923 loops=1)
                     ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.674..2.674 rows=3920 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 241kB
                           ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.513 rows=3920 loops=1)
               ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.931..1.931 rows=4023 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 189kB
                     ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.843 rows=4023 loops=1)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=3468)
               Index Cond: (animal.species_id = id)
 Total runtime: 71.493 ms
(79 rows)

-- Test Case 21 - 5909 ^ 2153 ^ 17098775 -> 284 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=65.206..75.783 rows=100 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=65.204..75.757 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 2228
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.365..32.248 rows=2340 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.374..8.507 rows=2324 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.227..7.330 rows=2324 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.185..6.301 rows=2324 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.373..4.324 rows=2324 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.049..0.550 rows=47 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.046..0.419 rows=47 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.041..0.175 rows=47 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.033..0.048 rows=11 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.023..0.023 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.009 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.016 rows=11 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.008 rows=4 loops=11)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.004 rows=1 loops=47)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=47)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.036..0.064 rows=49 loops=47)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 31
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.017..0.017 rows=85 loops=47)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.802..0.802 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.445 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.088 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.971..21.971 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.370..19.872 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.217..9.231 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.480..5.675 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.001..0.607 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.459..2.459 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.511 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.725..1.725 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.812 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.143..8.143 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.093..6.859 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.690 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.079..3.079 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.560 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.694..41.694 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.368 rows=36587 loops=1)
 Total runtime: 77.224 ms
(75 rows)

-- Test Case 22 - 5909 ^ 833188 ^ 5489 -> 13 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..10915.17 rows=1 width=279) (actual time=0.809..5.619 rows=13 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..10915.17 rows=1 width=279) (actual time=0.807..5.613 rows=13 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         ->  Nested Loop Left Join  (cost=29.18..10877.79 rows=21 width=239) (actual time=0.756..5.395 rows=13 loops=1)
               ->  Nested Loop  (cost=27.78..10840.41 rows=20 width=193) (actual time=0.720..5.128 rows=13 loops=1)
                     ->  Nested Loop  (cost=27.63..10836.44 rows=20 width=187) (actual time=0.715..5.077 rows=13 loops=1)
                           ->  Nested Loop  (cost=27.49..10825.97 rows=61 width=168) (actual time=0.712..5.041 rows=13 loops=1)
                                 ->  Nested Loop  (cost=27.21..10805.50 rows=61 width=168) (actual time=0.707..4.994 rows=13 loops=1)
                                       Join Filter: (receiver.model_id = device_model.id)
                                       Rows Removed by Join Filter: 195
                                       ->  Nested Loop  (cost=27.21..10789.66 rows=61 width=171) (actual time=0.699..4.914 rows=13 loops=1)
                                             ->  Hash Join  (cost=26.93..10764.48 rows=61 width=156) (actual time=0.692..4.849 rows=13 loops=1)
                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.034..3.715 rows=5041 loops=1)
                                                         Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                   ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.250..0.250 rows=64 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                         ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.058..0.210 rows=64 loops=1)
                                                               ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.050..0.086 rows=15 loops=1)
                                                                     ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.066 rows=1 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.019 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.017 rows=1 loops=1)
                                                                                       Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                       Rows Removed by Filter: 74
                                                                     ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.013 rows=15 loops=1)
                                                                           Index Cond: (installation_id = installation.id)
                                                               ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                     Index Cond: (station_id = installation_station.id)
                                             ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=13)
                                                   Index Cond: (id = receiver_deployment.receiver_id)
                                       ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.003 rows=16 loops=13)
                                             ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.33 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=13)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.003 rows=1 loops=13)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.86 rows=1 width=46) (actual time=0.017..0.019 rows=1 loops=13)
                     ->  Nested Loop Left Join  (cost=1.12..1.50 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=13)
                           ->  Nested Loop Left Join  (cost=0.84..1.06 rows=1 width=22) (actual time=0.011..0.012 rows=1 loops=13)
                                 ->  Nested Loop Left Join  (cost=0.56..0.71 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=13)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.38 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=13)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=13)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=13)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=13)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=13)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.916 ms
(59 rows)

-- Test Case 23 - 5909 ^ 833188 ^ 17098775 -> 54 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=66.839..83.421 rows=54 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=66.837..83.403 rows=54 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         Rows Removed by Filter: 3835
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.294..36.954 rows=3889 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.374..12.198 rows=3854 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.229..10.320 rows=3854 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.186..8.627 rows=3854 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.372..5.990 rows=3854 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.050..0.758 rows=64 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.045..0.570 rows=64 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.040..0.260 rows=64 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.032..0.092 rows=15 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.062 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.019 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.016 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.019 rows=15 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.008 rows=4 loops=15)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=64)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=64)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.030..0.061 rows=60 loops=64)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 32
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.015..0.015 rows=92 loops=64)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.805..0.805 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.457 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.035..0.035 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.134..0.134 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.080 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.900..21.900 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.301..19.812 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.198..9.206 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.463..5.671 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.001..0.581 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.443..2.443 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.506 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.725..1.725 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.806 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.092..8.092 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.064..6.884 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.737 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.049..3.049 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.500 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.368..41.368 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.133 rows=36587 loops=1)
 Total runtime: 83.720 ms
(75 rows)

-- Test Case 24 - 2716283 ^ 464 ^ 3129 -> 2 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5333.88 rows=1 width=279) (actual time=1.927..7.419 rows=2 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..5333.88 rows=1 width=279) (actual time=1.925..7.417 rows=2 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 68
         ->  Nested Loop Left Join  (cost=29.18..5314.29 rows=11 width=239) (actual time=0.907..7.083 rows=70 loops=1)
               ->  Nested Loop  (cost=27.78..5294.74 rows=10 width=193) (actual time=0.870..5.688 rows=69 loops=1)
                     ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.866..5.499 rows=69 loops=1)
                           ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.863..5.319 rows=69 loops=1)
                                 ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.854..5.053 rows=69 loops=1)
                                       Join Filter: (receiver.model_id = device_model.id)
                                       Rows Removed by Join Filter: 1035
                                       ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.847..4.689 rows=69 loops=1)
                                             ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.841..4.406 rows=69 loops=1)
                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.100..3.123 rows=2743 loops=1)
                                                         Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                   ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.693..0.693 rows=282 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                         ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.061..0.551 rows=282 loops=1)
                                                               ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.053..0.118 rows=45 loops=1)
                                                                     ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.067 rows=1 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.019 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.020 rows=1 loops=1)
                                                                                       Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                       Rows Removed by Filter: 74
                                                                     ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.029 rows=45 loops=1)
                                                                           Index Cond: (installation_id = installation.id)
                                                               ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=6 loops=45)
                                                                     Index Cond: (station_id = installation_station.id)
                                             ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=69)
                                                   Index Cond: (id = receiver_deployment.receiver_id)
                                       ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                             ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=69)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=69)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.94 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=69)
                     ->  Nested Loop Left Join  (cost=1.12..1.59 rows=1 width=46) (actual time=0.013..0.016 rows=1 loops=69)
                           ->  Nested Loop Left Join  (cost=0.84..1.15 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=69)
                                 ->  Nested Loop Left Join  (cost=0.56..0.80 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=69)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=70)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=70)
               Index Cond: (animal.species_id = id)
 Total runtime: 7.711 ms
(60 rows)

-- Test Case 25 - 2716283 ^ 464 ^ 17098775 -> 4 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=4887.476..4888.694 rows=4 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=4887.474..4888.690 rows=4 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 902902
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.901..4365.236 rows=902906 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.882..3676.417 rows=902521 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.726..3266.694 rows=902521 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.684..2868.720 rows=902521 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.905..2418.965 rows=902521 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.051..5.910 rows=282 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..4.390 rows=282 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.041..1.643 rows=282 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.230 rows=45 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.065 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.020 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.019 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.094 rows=45 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.021 rows=6 loops=45)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.007 rows=1 loops=282)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.004 rows=1 loops=282)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=4.969..7.475 rows=3200 loops=282)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 6410
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=1.192..1.192 rows=9611 loops=282)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.770..0.770 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.444 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.145..0.145 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.101 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=22.001..22.001 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.417..19.898 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.198..9.185 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.501..5.701 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.579 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.480..2.480 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.542 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.684..1.684 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.819 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.208..8.208 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.059..6.823 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.687 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.044..3.044 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.534 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.308..41.308 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.274 rows=36587 loops=1)
 Total runtime: 4889.009 ms
(75 rows)

-- Test Case 26 - 2716283 ^ 3913743 ^ 3129 -> 52 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5333.88 rows=1 width=279) (actual time=0.862..6.434 rows=52 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..5333.88 rows=1 width=279) (actual time=0.861..6.423 rows=52 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 18
         ->  Nested Loop Left Join  (cost=29.18..5314.29 rows=11 width=239) (actual time=0.809..5.744 rows=70 loops=1)
               ->  Nested Loop  (cost=27.78..5294.74 rows=10 width=193) (actual time=0.772..4.349 rows=69 loops=1)
                     ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.768..4.147 rows=69 loops=1)
                           ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.764..3.962 rows=69 loops=1)
                                 ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.756..3.710 rows=69 loops=1)
                                       Join Filter: (receiver.model_id = device_model.id)
                                       Rows Removed by Join Filter: 1035
                                       ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.749..3.346 rows=69 loops=1)
                                             ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.743..3.039 rows=69 loops=1)
                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.034..1.760 rows=2743 loops=1)
                                                         Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                   ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.689..0.689 rows=282 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                         ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.059..0.552 rows=282 loops=1)
                                                               ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.051..0.120 rows=45 loops=1)
                                                                     ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.040..0.065 rows=1 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.017 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                       Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                       Rows Removed by Filter: 74
                                                                     ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.033 rows=45 loops=1)
                                                                           Index Cond: (installation_id = installation.id)
                                                               ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                     Index Cond: (station_id = installation_station.id)
                                             ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=69)
                                                   Index Cond: (id = receiver_deployment.receiver_id)
                                       ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                             ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=69)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=69)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.94 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=69)
                     ->  Nested Loop Left Join  (cost=1.12..1.59 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=69)
                           ->  Nested Loop Left Join  (cost=0.84..1.15 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=69)
                                 ->  Nested Loop Left Join  (cost=0.56..0.80 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=69)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=70)
               Index Cond: (animal.species_id = id)
 Total runtime: 6.734 ms
(60 rows)

\q
