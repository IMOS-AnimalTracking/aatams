
set role to aatams;
set role to aatams;
SET
-- Low selectivity filtering (large number of rows returned for each filter)
-- Test Case 1 - 2716283 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=7.813..11.474 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=7.811..11.449 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.593..4.241 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.482..2.152 rows=98 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.258..1.867 rows=98 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.203..1.754 rows=98 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.186..0.654 rows=98 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.161..0.192 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.132..0.147 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.120..0.128 rows=2 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.104..0.104 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.033..0.033 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.013..0.013 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.006..0.032 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.014..0.020 rows=2 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.008..0.009 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.011..0.016 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.023..0.193 rows=49 loops=2)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.996..0.996 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.572 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.037..0.037 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.174..0.174 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.113 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=98)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=98)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.011..0.013 rows=1 loops=98)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.008..0.009 rows=1 loops=98)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.005 rows=1 loops=98)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=92)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=92)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=92)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=92)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 12.036 ms
(61 rows)

-- Test Case 2 - 3913743 rows limited to first 100
explain analyze select * from detection_extract_test_view
where spcode = '37018030'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4741.75..11153.44 rows=100 width=279) (actual time=3844.052..3854.593 rows=100 loops=1)
   ->  Hash Left Join  (cost=4741.75..5892981.17 rows=91836 width=279) (actual time=3844.049..3854.561 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 1087257
         ->  Hash Left Join  (cost=2253.55..4336436.41 rows=18367253 width=239) (actual time=49.132..3425.870 rows=1087541 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=1000.03..3698334.06 rows=17263859 width=193) (actual time=24.918..2694.013 rows=1087082 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=24.768..2222.617 rows=1087082 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=24.724..1732.779 rows=1087082 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=23.937..1235.920 rows=1087082 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.037..238.756 rows=1087082 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=23.876..23.876 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=7.440..19.823 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=7.420..17.261 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.590..9.194 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.001..1.063 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.562..2.562 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.193..1.557 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.338 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.173..0.173 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.061..0.120 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.017 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.043..0.043 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.017 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=4.807..4.807 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.678 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.010..0.010 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.775..0.775 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.449 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.088 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=24.133..24.133 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=14.246..21.928 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=5.191..10.389 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=3.173..6.505 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.686 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=3.138..3.138 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.007..1.886 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.994..1.994 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.006..0.894 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=9.037..9.037 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.503..7.463 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.008..0.862 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.470..3.470 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.597 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=45.670..45.670 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.009..28.494 rows=36587 loops=1)
 Total runtime: 3856.534 ms
(80 rows)

-- Test Case 3 - 17098775 rows limited to first 100
explain analyze select * from detection_extract_test_view
where timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                         QUERY PLAN                                                                                                         
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3.39..571.82 rows=100 width=279) (actual time=0.842..8.132 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=3.39..31977844.24 rows=5625584 width=279) (actual time=0.840..8.106 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=3.10..21831467.95 rows=5625584 width=239) (actual time=0.790..6.991 rows=100 loops=1)
               ->  Nested Loop  (cost=1.69..12376246.08 rows=5287633 width=193) (actual time=0.745..5.053 rows=100 loops=1)
                     ->  Nested Loop  (cost=1.55..11308727.81 rows=5372518 width=187) (actual time=0.741..4.776 rows=100 loops=1)
                           ->  Nested Loop  (cost=1.41..8537379.53 rows=16144362 width=168) (actual time=0.737..4.514 rows=100 loops=1)
                                 ->  Merge Join  (cost=1.13..3572860.21 rows=16144362 width=168) (actual time=0.721..4.065 rows=100 loops=1)
                                       Merge Cond: (receiver_deployment.id = valid_detection.receiver_deployment_id)
                                       ->  Nested Loop  (cost=0.56..188303.48 rows=5710 width=132) (actual time=0.703..1.789 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..186931.88 rows=5710 width=135) (actual time=0.697..1.770 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..184575.50 rows=5710 width=120) (actual time=0.690..1.755 rows=2 loops=1)
                                                         Join Filter: (installation.project_id = receiver_project.id)
                                                         Rows Removed by Join Filter: 86
                                                         ->  Nested Loop  (cost=0.28..178149.81 rows=5710 width=89) (actual time=0.679..1.703 rows=2 loops=1)
                                                               Join Filter: (installation_station.installation_id = installation.id)
                                                               Rows Removed by Join Filter: 112
                                                               ->  Nested Loop  (cost=0.28..168724.94 rows=5710 width=73) (actual time=0.671..1.627 rows=2 loops=1)
                                                                     Join Filter: (receiver_deployment.station_id = installation_station.id)
                                                                     Rows Removed by Join Filter: 2873
                                                                     ->  Index Scan using receiver_deployment_pkey on receiver_deployment  (cost=0.28..457.79 rows=5710 width=24) (actual time=0.009..0.010 rows=2 loops=1)
                                                                     ->  Materialize  (cost=0.00..55.46 rows=1964 width=57) (actual time=0.005..0.592 rows=1438 loops=2)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.005..0.479 rows=1964 loops=1)
                                                               ->  Materialize  (cost=0.00..3.65 rows=110 width=32) (actual time=0.002..0.029 rows=57 loops=2)
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.028 rows=110 loops=1)
                                                         ->  Materialize  (cost=0.00..2.12 rows=75 width=39) (actual time=0.002..0.020 rows=44 loops=2)
                                                               ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.001..0.012 rows=75 loops=1)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.006 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..3183595.42 rows=16144362 width=52) (actual time=0.014..2.218 rows=100 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 2460
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=100)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.009..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=99)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=99)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 8.568 ms
(59 rows)

-- Test Case 4 -  2716283 ^ 3913743 -> 1420919 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=65.056..66.476 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=65.054..66.452 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 115
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=23.181..24.344 rows=221 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.092..2.067 rows=219 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.946..1.814 rows=219 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.905..1.657 rows=219 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.110..0.731 rows=219 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.097..0.179 rows=5 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 61
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.089..0.139 rows=5 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.084..0.098 rows=5 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.074..0.074 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.020 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.020 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.016 rows=5 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=5)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.005 rows=13 loops=5)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.015..0.084 rows=44 loops=5)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.785..0.785 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.460 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.015 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.085 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=22.068..22.068 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.312..19.987 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.226..9.351 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.508..5.672 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.631 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.487..2.487 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.004..1.538 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.706..1.706 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.791 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.069..8.069 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.026..6.771 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.710 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.012..3.012 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.488 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.233..41.233 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.099 rows=36587 loops=1)
 Total runtime: 67.876 ms
(74 rows)

-- Test Case 5 - 2716283 ^ 17098775 -> 902906 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=2.446..5.702 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=2.444..5.673 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=2.388..4.637 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=2.348..2.670 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=2.200..2.454 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=2.159..2.355 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=1.387..1.516 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.063..0.098 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.060..0.087 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..0.050 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.035..0.035 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.006 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.011 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.013 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.007..0.008 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.001 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.320..0.342 rows=25 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.114..0.114 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.762..0.762 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.439 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.088 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 6.002 ms
(62 rows)

-- Test Case 6 - 3913743 ^ 17098775 -> 2233756 rows limited to first 100
explain analyze select * from detection_extract_test_view
where spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..108148.56 rows=100 width=279) (actual time=41.843..335.179 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=930.07..30159347.10 rows=28128 width=279) (actual time=41.841..335.145 rows=100 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 9428
         ->  Nested Loop Left Join  (cost=929.78..20152836.88 rows=5625584 width=239) (actual time=21.846..299.361 rows=9528 loops=1)
               ->  Nested Loop  (cost=928.38..10697615.02 rows=5287633 width=193) (actual time=21.746..124.818 rows=9528 loops=1)
                     ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=21.737..99.283 rows=9528 loops=1)
                           ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=21.728..73.912 rows=9528 loops=1)
                                 ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=21.686..38.581 rows=9528 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.010..7.072 rows=9528 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.657..21.657 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.192..18.035 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.171..15.640 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.229..8.477 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..0.973 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.219..2.219 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.157..1.349 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.264 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.146..0.146 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.049..0.109 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.017 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.039..0.039 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.015 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.929..3.929 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.143 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.013..0.013 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.007 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=9528)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=9528)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=9528)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.015..0.017 rows=1 loops=9528)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.012..0.014 rows=1 loops=9528)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.009..0.010 rows=1 loops=9528)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=9528)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=9528)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=9528)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=9528)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=9528)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=9528)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=9528)
               Index Cond: (animal.species_id = id)
 Total runtime: 335.488 ms
(64 rows)

-- Test Case 7 - 2716283 ^ 3913743 ^ 17098775 -> 690003 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=65.173..66.106 rows=100 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=65.171..66.073 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 2
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.676..24.054 rows=102 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.912..2.198 rows=102 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.762..1.998 rows=102 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.722..1.900 rows=102 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.912..1.033 rows=102 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.053..0.086 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.050..0.074 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.049 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.035..0.035 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.023..0.023 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.006 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.010 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.011 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.205..0.225 rows=26 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.091..0.091 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.802..0.802 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.436 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.138..0.138 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.086 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.744..21.744 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.191..19.673 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.195..9.186 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.468..5.652 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.001..0.612 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.447..2.447 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.482 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.714..1.714 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.802 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=7.987..7.987 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.006..6.776 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.727 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.990..2.990 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.484 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.340..41.340 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.226 rows=36587 loops=1)
 Total runtime: 67.528 ms
(75 rows)

 
-- High selectivity filtering (small number of rows returned for each filter)
-- Test Case 8 - 5909 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=1.446..4.836 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=1.445..4.812 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.390..3.754 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.342..1.708 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.196..1.506 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.155..1.403 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.384..0.563 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.332..0.367 rows=3 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 31
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.324..0.342 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.316..0.321 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.288..0.288 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 872
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.120 rows=873 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.025..0.029 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.005 rows=11 loops=3)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.018..0.045 rows=33 loops=3)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.761..0.761 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.397 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.087 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.017..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.011..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.121 ms
(61 rows)

-- Test Case 9 - 2153 rows
set geqo_threshold to 12;
SET
explain analyze select * from detection_extract_test_view
where spcode = '37018003'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4741.75..11153.44 rows=100 width=279) (actual time=4067.931..65487.622 rows=100 loops=1)
   ->  Hash Left Join  (cost=4741.75..5892981.17 rows=91836 width=279) (actual time=4067.929..65487.582 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 13574528
         ->  Hash Left Join  (cost=2253.55..4336436.41 rows=18367253 width=239) (actual time=45.394..53435.225 rows=17891981 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=1000.03..3698334.06 rows=17263859 width=193) (actual time=22.192..41783.507 rows=17075069 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=22.044..34232.042 rows=17075069 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=22.003..26476.648 rows=17075069 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=21.243..18577.972 rows=17075069 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.003..3705.074 rows=17075069 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.221..21.221 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.163..17.757 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.144..15.287 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.229..8.207 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..0.925 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.217..2.217 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.152..1.415 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.239 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.143..0.143 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.049..0.108 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.020 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.037..0.037 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.021 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.903..3.903 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.244 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.010..0.010 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.751..0.751 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.423 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.085 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=23.170..23.170 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=13.557..20.903 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.740..9.712 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.760..5.923 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.564 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.716..2.716 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.004..1.539 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.954..1.954 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.006..0.842 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.794..8.794 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.478..7.271 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.709 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.455..3.455 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.534 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.468..41.468 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..24.377 rows=36587 loops=1)
 Total runtime: 65911.854 ms
(80 rows)

-- Test Case 10 - 1065 rows
explain analyze select * from detection_extract_test_view
  where timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=398.97..1704.98 rows=100 width=279) (actual time=6.325..11.047 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=398.97..6772.29 rows=488 width=279) (actual time=6.323..11.015 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=398.68..5892.13 rows=488 width=239) (actual time=6.259..9.926 rows=100 loops=1)
               ->  Nested Loop  (cost=397.27..4950.72 rows=459 width=193) (actual time=6.202..7.909 rows=100 loops=1)
                     ->  Nested Loop  (cost=397.13..4858.12 rows=466 width=187) (actual time=6.196..7.629 rows=100 loops=1)
                           ->  Nested Loop  (cost=396.99..4617.80 rows=1400 width=168) (actual time=6.189..7.359 rows=100 loops=1)
                                 ->  Nested Loop  (cost=396.85..4384.47 rows=1400 width=171) (actual time=6.183..7.100 rows=100 loops=1)
                                       ->  Hash Join  (cost=396.57..3806.73 rows=1400 width=156) (actual time=6.165..6.639 rows=100 loops=1)
                                             Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                             ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.393..5.797 rows=100 loops=1)
                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                   ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.345..5.687 rows=100 loops=1)
                                                         Hash Cond: (installation_station.installation_id = installation.id)
                                                         ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.279..5.572 rows=100 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.103..4.332 rows=100 loops=1)
                                                                     Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                     ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.041..0.145 rows=100 loops=1)
                                                                           Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                     ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.044..4.044 rows=5710 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                           ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..2.569 rows=5710 loops=1)
                                                               ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.167..1.167 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                     ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.570 rows=1964 loops=1)
                                                         ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.057..0.057 rows=110 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.024 rows=110 loops=1)
                                                   ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.039..0.039 rows=75 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.015 rows=75 loops=1)
                                             ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.760..0.760 rows=1519 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                   ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.006..0.407 rows=1519 loops=1)
                                       ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=100)
                                             Index Cond: (id = receiver_deployment.receiver_id)
                                 ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=100)
                                       Index Cond: (id = receiver.model_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..2.04 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.68 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..1.24 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.90 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 11.369 ms
(60 rows)

-- Test Case 11 - 5909 ^ 2153 -> 609 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=67.568..70.784 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=67.566..70.764 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 1332
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=23.215..28.016 rows=1441 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.326..5.030 rows=1435 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.175..4.231 rows=1435 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.135..3.577 rows=1435 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.361..2.082 rows=1435 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.322..0.533 rows=13 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 181
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.315..0.455 rows=13 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.308..0.364 rows=13 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.296..0.309 rows=4 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.007 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.123 rows=898 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.009 rows=3 loops=4)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=13)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=15 loops=13)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.012..0.071 rows=110 loops=13)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.765..0.765 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.427 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.141..0.141 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.090 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.870..21.870 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.186..19.775 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.207..9.329 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.516..5.642 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.613 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.494..2.494 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.548 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.679..1.679 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.812 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=7.971..7.971 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.998..6.707 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.726 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.983..2.983 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.485 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.324..41.324 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..23.748 rows=36587 loops=1)
 Total runtime: 72.242 ms
(74 rows)

-- Test Case 12 - 5909 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.506..3.865 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.503..3.847 rows=55 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3373.72 rows=6 width=239) (actual time=0.454..3.236 rows=55 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3371.58 rows=6 width=239) (actual time=0.448..3.047 rows=55 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3368.94 rows=6 width=215) (actual time=0.442..2.851 rows=55 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3366.85 rows=6 width=215) (actual time=0.436..2.662 rows=55 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3364.85 rows=6 width=215) (actual time=0.428..2.494 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.78..3361.41 rows=6 width=193) (actual time=0.418..2.232 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.413..2.075 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.410..1.929 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.405..1.740 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.398..1.424 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.391..1.187 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.025..0.679 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.249..0.249 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.057..0.213 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.050..0.088 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.066 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.018 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.006..0.015 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=55)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=55)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=55)
               Index Cond: (animal.species_id = id)
 Total runtime: 4.180 ms
(58 rows)

-- Test Case 13 -  2153 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                               QUERY PLAN                                                                                                                                
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4862.46..5820.38 rows=2 width=279) (actual time=33.123..38.545 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=4862.46..5820.38 rows=2 width=279) (actual time=33.121..38.526 rows=55 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 1010
         ->  Hash Right Join  (cost=4862.17..4952.37 rows=488 width=239) (actual time=33.051..34.611 rows=1065 loops=1)
               Hash Cond: (animal.id = animal_release.animal_id)
               ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.508 rows=4023 loops=1)
               ->  Hash  (cost=4856.07..4856.07 rows=488 width=239) (actual time=32.796..32.796 rows=1065 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 352kB
                     ->  Nested Loop Left Join  (cost=4528.01..4856.07 rows=488 width=239) (actual time=25.949..31.399 rows=1065 loops=1)
                           ->  Hash Right Join  (cost=4527.73..4641.32 rows=488 width=215) (actual time=25.936..27.770 rows=1065 loops=1)
                                 Hash Cond: (surgery.tag_id = tag.id)
                                 ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.507 rows=3923 loops=1)
                                 ->  Hash  (cost=4521.63..4521.63 rows=488 width=215) (actual time=25.783..25.783 rows=1065 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 327kB
                                       ->  Nested Loop Left Join  (cost=867.27..4521.63 rows=488 width=215) (actual time=13.044..24.306 rows=1065 loops=1)
                                             ->  Hash Left Join  (cost=866.99..4359.32 rows=488 width=215) (actual time=13.025..20.901 rows=1065 loops=1)
                                                   Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                                   ->  Hash Join  (cost=686.58..4161.98 rows=459 width=193) (actual time=10.253..17.202 rows=1065 loops=1)
                                                         Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                                         ->  Hash Join  (cost=675.68..4144.75 rows=466 width=187) (actual time=10.107..16.467 rows=1065 loops=1)
                                                               Hash Cond: (receiver.organisation_id = organisation.id)
                                                               ->  Hash Join  (cost=673.54..4132.70 rows=1400 width=168) (actual time=10.065..15.875 rows=1065 loops=1)
                                                                     Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                                     ->  Hash Join  (cost=614.36..4054.27 rows=1400 width=168) (actual time=9.255..14.417 rows=1065 loops=1)
                                                                           Hash Cond: (receiver.model_id = device_model.id)
                                                                           ->  Hash Join  (cost=613.00..4033.66 rows=1400 width=171) (actual time=9.236..13.856 rows=1065 loops=1)
                                                                                 Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                                 ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.271..9.105 rows=1065 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.220..8.490 rows=1065 loops=1)
                                                                                             Hash Cond: (installation_station.installation_id = installation.id)
                                                                                             ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.153..7.860 rows=1065 loops=1)
                                                                                                   Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                                   ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.031..6.054 rows=1065 loops=1)
                                                                                                         Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                                         ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.032..0.978 rows=1065 loops=1)
                                                                                                               Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                                                         ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=3.982..3.982 rows=5710 loops=1)
                                                                                                               Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.005..2.557 rows=5710 loops=1)
                                                                                                   ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.113..1.113 rows=1964 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                                         ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.503 rows=1964 loops=1)
                                                                                             ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.058..0.058 rows=110 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.024 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.039..0.039 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.019 rows=75 loops=1)
                                                                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.958..3.958 rows=7227 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                       ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.066 rows=7227 loops=1)
                                                                           ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.009..0.009 rows=16 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.005 rows=16 loops=1)
                                                                     ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.802..0.802 rows=1519 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                                           ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.456 rows=1519 loops=1)
                                                               ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                                     ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.021 rows=51 loops=1)
                                                         ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                               ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.098 rows=173 loops=1)
                                                   ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.754..2.754 rows=5307 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                                         ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.005..1.348 rows=5307 loops=1)
                                             ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=1065)
                                                   Index Cond: (id = sensor.tag_id)
                                                   Heap Fetches: 0
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=1065)
                                 Index Cond: (surgery.release_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.002 rows=1 loops=1065)
               Index Cond: (animal.species_id = id)
 Total runtime: 38.872 ms
(76 rows)

-- Test Case 14 -  5909 ^ 2153 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3384.42 rows=1 width=279) (actual time=0.499..3.800 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3384.42 rows=1 width=279) (actual time=0.498..3.791 rows=55 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         ->  Nested Loop Left Join  (cost=29.18..3373.72 rows=6 width=239) (actual time=0.449..3.175 rows=55 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3371.58 rows=6 width=239) (actual time=0.443..2.984 rows=55 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3368.94 rows=6 width=215) (actual time=0.437..2.789 rows=55 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3366.85 rows=6 width=215) (actual time=0.431..2.611 rows=55 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3364.85 rows=6 width=215) (actual time=0.425..2.437 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.78..3361.41 rows=6 width=193) (actual time=0.416..2.180 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.412..2.024 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.409..1.880 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.404..1.689 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.396..1.393 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.389..1.146 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.025..0.646 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.249..0.249 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.058..0.215 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.050..0.089 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.067 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.016 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.006..0.014 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=55)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=55)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=55)
               Index Cond: (animal.species_id = id)
 Total runtime: 4.154 ms
(59 rows)

-- Mixed selectivity filtering
-- Test Case 15 - 5909 ^ 833188 -> 184 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=64.726..73.540 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=64.725..73.517 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         Rows Removed by Filter: 2155
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=23.234..30.409 rows=2267 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.340..6.848 rows=2248 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.193..5.677 rows=2248 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.152..4.664 rows=2248 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.358..2.746 rows=2248 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.321..0.600 rows=19 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 271
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.313..0.495 rows=19 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.307..0.375 rows=19 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.295..0.307 rows=5 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.020 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.006 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.125 rows=899 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.005..0.009 rows=4 loops=5)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=19)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=15 loops=19)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.007 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.009..0.061 rows=118 loops=19)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.785..0.785 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.434 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.093 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.876..21.876 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.194..19.829 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.234..9.313 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.505..5.664 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.594 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.483..2.483 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.552 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.717..1.717 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.828 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=7.941..7.941 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.979..6.682 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.699 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.967..2.967 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.531 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.293..41.293 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..24.386 rows=36587 loops=1)
 Total runtime: 75.035 ms
(74 rows)

-- Test Case 16 - 5909 ^ 17098775 -> 3889 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=1.425..4.777 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=1.424..4.751 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=1.381..3.662 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.353..1.675 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.205..1.462 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.164..1.362 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.401..0.526 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.051..0.075 rows=3 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..0.065 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..0.047 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.034 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.006 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.009 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.009 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=3)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.107..0.137 rows=33 loops=3)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 148
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.037..0.037 rows=210 loops=3)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.754..0.754 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.413 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.087 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.074 ms
(62 rows)

-- Test Case 17 - 2716283 ^ 464 -> 448 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=9757.328..9758.223 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=9757.325..9758.201 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 2696635
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=22.972..8461.031 rows=2716283 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.094..6599.223 rows=2710212 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.948..5426.700 rows=2710212 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.909..4270.257 rows=2710212 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.112..2941.572 rows=2710212 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.098..6.488 rows=282 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 4230
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.091..4.776 rows=282 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.086..2.137 rows=282 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.075..0.824 rows=45 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 1919
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.062 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.019 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.018 rows=110 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.320 rows=1964 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.020 rows=6 loops=45)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.007 rows=1 loops=282)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=282)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.014..5.452 rows=9611 loops=282)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.788..0.788 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.434 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.022 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.082 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.860..21.860 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.196..19.711 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.198..9.361 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.480..5.621 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.654 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.460..2.460 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.522 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.706..1.706 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.823 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=7.989..7.989 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.960..6.760 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.768 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.946..2.946 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.448 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.183..41.183 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.280 rows=36587 loops=1)
 Total runtime: 9760.439 ms
(74 rows)

-- Test Case 18 - 2716283 ^ 2005 -> 4 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2013-06-08 00:00:00+00' and '2013-06-08 01:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3896.81 rows=7 width=279) (actual time=1.878..2.484 rows=4 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3896.81 rows=7 width=279) (actual time=1.877..2.481 rows=4 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3884.18 rows=7 width=239) (actual time=1.829..2.399 rows=4 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3881.69 rows=7 width=239) (actual time=1.822..2.381 rows=4 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3878.61 rows=7 width=215) (actual time=1.815..2.362 rows=4 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3876.17 rows=7 width=215) (actual time=1.809..2.346 rows=4 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3873.84 rows=7 width=215) (actual time=1.802..2.330 rows=4 loops=1)
                                       ->  Nested Loop  (cost=27.78..3870.07 rows=7 width=193) (actual time=1.793..2.305 rows=4 loops=1)
                                             ->  Nested Loop  (cost=27.63..3868.68 rows=7 width=187) (actual time=1.788..2.292 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3864.90 rows=22 width=168) (actual time=1.785..2.279 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3856.39 rows=22 width=168) (actual time=1.775..2.232 rows=4 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 60
                                                               ->  Nested Loop  (cost=27.21..3849.91 rows=22 width=171) (actual time=1.767..2.199 rows=4 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3840.83 rows=22 width=156) (actual time=1.761..2.176 rows=4 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3808.21 rows=1613 width=52) (actual time=0.046..1.121 rows=1839 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-06-08 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-06-08 01:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.696..0.696 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.563 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.117 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.066 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.018 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.028 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.002..0.006 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.004 rows=1 loops=4)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=4)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.005 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.38 rows=1 width=16) (actual time=0.010..0.010 rows=1 loops=4)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=4)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.53 rows=1 width=22) (actual time=0.004..0.005 rows=1 loops=4)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=4)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=4)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.003..0.003 rows=1 loops=4)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=4)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=4)
               Index Cond: (animal.species_id = id)
 Total runtime: 2.789 ms
(58 rows)

-- Test Case 19 - 464 ^ 17098775 -> 6 rows
explain analyze select * from detection_extract_test_view
where spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..108148.56 rows=100 width=279) (actual time=83003.626..451976.305 rows=6 loops=1)
   ->  Nested Loop Left Join  (cost=930.07..30159347.10 rows=28128 width=279) (actual time=83003.624..451976.299 rows=6 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 17098769
         ->  Nested Loop Left Join  (cost=929.78..20152836.88 rows=5625584 width=239) (actual time=21.842..409816.468 rows=17098775 loops=1)
               ->  Nested Loop  (cost=928.38..10697615.02 rows=5287633 width=193) (actual time=21.782..181989.099 rows=16316319 loops=1)
                     ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=21.774..138520.508 rows=16316319 loops=1)
                           ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=21.766..95841.168 rows=16316319 loops=1)
                                 ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=21.744..37630.835 rows=16316319 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.009..21418.037 rows=16316319 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 36799631
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.714..21.714 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.199..18.126 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.178..15.714 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.232..8.512 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.001..0.987 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.222..2.222 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.158..1.323 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.248 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.147..0.147 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.048..0.112 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.014 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.016 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.934..3.934 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.085 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.012..0.012 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.004 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=16316319)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=16316319)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=16316319)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.011..0.013 rows=1 loops=16316319)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.009..0.011 rows=1 loops=16316319)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=16316319)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.005..0.006 rows=1 loops=16316319)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=16316319)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=11828011)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=11828011)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=12084573)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=12084573)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.001..0.002 rows=1 loops=17098775)
               Index Cond: (animal.species_id = id)
 Total runtime: 451976.603 ms
(65 rows)

-- Test Case 20 - 833188 ^ 5489 -> 210 rows
explain analyze select * from detection_extract_test_view
where spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                         QUERY PLAN                                                                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=1609.87..15898.41 rows=8 width=279) (actual time=23.453..69.229 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=1609.87..15898.41 rows=8 width=279) (actual time=23.430..69.176 rows=100 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         Rows Removed by Filter: 3368
         ->  Hash Left Join  (cost=1609.58..13075.53 rows=1587 width=239) (actual time=23.026..55.818 rows=3468 loops=1)
               Hash Cond: (animal_release.animal_id = animal.id)
               ->  Hash Left Join  (cost=1489.06..12927.24 rows=1587 width=239) (actual time=21.120..51.703 rows=3468 loops=1)
                     Hash Cond: (surgery.release_id = animal_release.id)
                     ->  Hash Left Join  (cost=1287.86..12698.27 rows=1587 width=215) (actual time=18.380..46.679 rows=3468 loops=1)
                           Hash Cond: (tag.id = surgery.tag_id)
                           ->  Hash Left Join  (cost=1142.59..12510.67 rows=1587 width=215) (actual time=16.410..42.529 rows=3357 loops=1)
                                 Hash Cond: (sensor.tag_id = tag.id)
                                 ->  Hash Left Join  (cost=866.99..12201.34 rows=1587 width=215) (actual time=13.079..36.690 rows=3357 loops=1)
                                       Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                       ->  Hash Join  (cost=686.58..11965.89 rows=1492 width=193) (actual time=10.244..31.089 rows=3143 loops=1)
                                             Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                             ->  Hash Join  (cost=675.68..11934.41 rows=1515 width=187) (actual time=10.084..29.033 rows=3143 loops=1)
                                                   Hash Cond: (receiver.organisation_id = organisation.id)
                                                   ->  Hash Join  (cost=673.54..11900.04 rows=4554 width=168) (actual time=10.040..27.300 rows=3143 loops=1)
                                                         Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                         ->  Hash Join  (cost=614.36..11778.24 rows=4554 width=168) (actual time=9.285..24.548 rows=3143 loops=1)
                                                               Hash Cond: (receiver.model_id = device_model.id)
                                                               ->  Hash Join  (cost=613.00..11714.26 rows=4554 width=171) (actual time=9.267..22.887 rows=3143 loops=1)
                                                                     Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                     ->  Hash Join  (cost=337.39..11341.88 rows=4554 width=156) (actual time=5.273..16.569 rows=3143 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Hash Join  (cost=334.70..11276.58 rows=4554 width=125) (actual time=5.222..14.778 rows=3143 loops=1)
                                                                                 Hash Cond: (installation_station.installation_id = installation.id)
                                                                                 ->  Hash Join  (cost=330.23..11209.49 rows=4554 width=109) (actual time=5.153..12.931 rows=3143 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Hash Join  (cost=260.04..11070.99 rows=4554 width=60) (actual time=4.029..9.668 rows=3143 loops=1)
                                                                                             Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                             ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.054..2.614 rows=3143 loops=1)
                                                                                                   Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                                                             ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=3.956..3.956 rows=5710 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                   ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.521 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.114..1.114 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                             ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.550 rows=1964 loops=1)
                                                                                 ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.059..0.059 rows=110 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.026 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.012 rows=75 loops=1)
                                                                     ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.984..3.984 rows=7227 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                           ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.095 rows=7227 loops=1)
                                                               ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.008..0.008 rows=16 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                                         ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.747..0.747 rows=1519 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                               ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.407 rows=1519 loops=1)
                                                   ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                         ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                                             ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.147..0.147 rows=173 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                   ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.100 rows=173 loops=1)
                                       ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.824..2.824 rows=5307 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.004..1.437 rows=5307 loops=1)
                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.318..3.318 rows=7227 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                       ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.508 rows=7227 loops=1)
                           ->  Hash  (cost=96.23..96.23 rows=3923 width=16) (actual time=1.959..1.959 rows=3923 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 184kB
                                 ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.909 rows=3923 loops=1)
                     ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.731..2.731 rows=3920 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 241kB
                           ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.562 rows=3920 loops=1)
               ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.888..1.888 rows=4023 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 189kB
                     ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.805 rows=4023 loops=1)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=3468)
               Index Cond: (animal.species_id = id)
 Total runtime: 69.554 ms
(79 rows)

-- Test Case 21 - 5909 ^ 2153 ^ 17098775 -> 284 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=64.697..74.878 rows=100 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=64.694..74.851 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 2228
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.068..31.565 rows=2340 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.343..8.117 rows=2324 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.195..6.917 rows=2324 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.154..5.896 rows=2324 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.377..3.982 rows=2324 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.050..0.546 rows=47 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.047..0.411 rows=47 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.172 rows=47 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.049 rows=11 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.023..0.023 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.006 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.020 rows=11 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.004..0.008 rows=4 loops=11)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=47)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=47)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.030..0.056 rows=49 loops=47)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 31
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.015..0.015 rows=85 loops=47)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.769..0.769 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.443 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.086 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.704..21.704 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.233..19.578 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.202..9.199 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.513..5.634 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.559 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.491..2.491 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.554 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.678..1.678 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.810 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.022..8.022 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.988..6.804 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.688 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.974..2.974 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.502 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.478..41.478 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..23.986 rows=36587 loops=1)
 Total runtime: 76.317 ms
(75 rows)

-- Test Case 22 - 5909 ^ 833188 ^ 5489 -> 13 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..10915.17 rows=1 width=279) (actual time=0.808..4.911 rows=13 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..10915.17 rows=1 width=279) (actual time=0.807..4.907 rows=13 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         ->  Nested Loop Left Join  (cost=29.18..10877.79 rows=21 width=239) (actual time=0.757..4.721 rows=13 loops=1)
               ->  Nested Loop  (cost=27.78..10840.41 rows=20 width=193) (actual time=0.719..4.452 rows=13 loops=1)
                     ->  Nested Loop  (cost=27.63..10836.44 rows=20 width=187) (actual time=0.716..4.416 rows=13 loops=1)
                           ->  Nested Loop  (cost=27.49..10825.97 rows=61 width=168) (actual time=0.713..4.379 rows=13 loops=1)
                                 ->  Nested Loop  (cost=27.21..10805.50 rows=61 width=168) (actual time=0.708..4.300 rows=13 loops=1)
                                       Join Filter: (receiver.model_id = device_model.id)
                                       Rows Removed by Join Filter: 195
                                       ->  Nested Loop  (cost=27.21..10789.66 rows=61 width=171) (actual time=0.700..4.218 rows=13 loops=1)
                                             ->  Hash Join  (cost=26.93..10764.48 rows=61 width=156) (actual time=0.693..4.160 rows=13 loops=1)
                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.035..3.041 rows=5041 loops=1)
                                                         Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                   ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.251..0.251 rows=64 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                         ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.059..0.218 rows=64 loops=1)
                                                               ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.050..0.086 rows=15 loops=1)
                                                                     ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.066 rows=1 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.018 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                       Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                       Rows Removed by Filter: 74
                                                                     ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.014 rows=15 loops=1)
                                                                           Index Cond: (installation_id = installation.id)
                                                               ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                     Index Cond: (station_id = installation_station.id)
                                             ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=13)
                                                   Index Cond: (id = receiver_deployment.receiver_id)
                                       ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.003 rows=16 loops=13)
                                             ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.33 rows=1 width=16) (actual time=0.005..0.005 rows=1 loops=13)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=13)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=13)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.86 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=13)
                     ->  Nested Loop Left Join  (cost=1.12..1.50 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=13)
                           ->  Nested Loop Left Join  (cost=0.84..1.06 rows=1 width=22) (actual time=0.011..0.012 rows=1 loops=13)
                                 ->  Nested Loop Left Join  (cost=0.56..0.71 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=13)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.38 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=13)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=13)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=13)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=13)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=13)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.209 ms
(59 rows)

-- Test Case 23 - 5909 ^ 833188 ^ 17098775 -> 54 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=67.206..83.782 rows=54 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=67.205..83.765 rows=54 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         Rows Removed by Filter: 3835
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.271..36.813 rows=3889 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.376..12.069 rows=3854 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.228..10.296 rows=3854 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.188..8.589 rows=3854 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.408..5.924 rows=3854 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.048..0.753 rows=64 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.045..0.572 rows=64 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.041..0.258 rows=64 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.094 rows=15 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.063 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.021 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.016 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.018 rows=15 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.008 rows=4 loops=15)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=64)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=64)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.030..0.062 rows=60 loops=64)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 32
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.015..0.015 rows=92 loops=64)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.769..0.769 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.444 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.022 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.138..0.138 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.088 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.875..21.875 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.340..19.765 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.346..9.376 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.624..5.801 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.569 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.594..2.594 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.665 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.709..1.709 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.831 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=7.985..7.985 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.935..6.713 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.687 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.922..2.922 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.399 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.736..41.736 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.233 rows=36587 loops=1)
 Total runtime: 84.078 ms
(75 rows)

-- Test Case 24 - 2716283 ^ 464 ^ 3129 -> 2 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5333.88 rows=1 width=279) (actual time=1.442..5.952 rows=2 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..5333.88 rows=1 width=279) (actual time=1.441..5.949 rows=2 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 68
         ->  Nested Loop Left Join  (cost=29.18..5314.29 rows=11 width=239) (actual time=0.832..5.626 rows=70 loops=1)
               ->  Nested Loop  (cost=27.78..5294.74 rows=10 width=193) (actual time=0.795..4.271 rows=69 loops=1)
                     ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.790..4.075 rows=69 loops=1)
                           ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.787..3.890 rows=69 loops=1)
                                 ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.779..3.641 rows=69 loops=1)
                                       Join Filter: (receiver.model_id = device_model.id)
                                       Rows Removed by Join Filter: 1035
                                       ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.772..3.295 rows=69 loops=1)
                                             ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.767..3.042 rows=69 loops=1)
                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.049..1.789 rows=2743 loops=1)
                                                         Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                   ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.699..0.699 rows=282 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                         ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.059..0.558 rows=282 loops=1)
                                                               ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.051..0.115 rows=45 loops=1)
                                                                     ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.066 rows=1 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.019 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.017 rows=1 loops=1)
                                                                                       Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                       Rows Removed by Filter: 74
                                                                     ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.028 rows=45 loops=1)
                                                                           Index Cond: (installation_id = installation.id)
                                                               ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                     Index Cond: (station_id = installation_station.id)
                                             ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.002..0.003 rows=1 loops=69)
                                                   Index Cond: (id = receiver_deployment.receiver_id)
                                       ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                             ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.007 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=69)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=69)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.94 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=69)
                     ->  Nested Loop Left Join  (cost=1.12..1.59 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=69)
                           ->  Nested Loop Left Join  (cost=0.84..1.15 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=69)
                                 ->  Nested Loop Left Join  (cost=0.56..0.80 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=69)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=70)
               Index Cond: (animal.species_id = id)
 Total runtime: 6.243 ms
(60 rows)

-- Test Case 25 - 2716283 ^ 464 ^ 17098775 -> 4 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=4882.959..4884.116 rows=4 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=4882.957..4884.113 rows=4 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 902902
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.757..4359.085 rows=902906 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.874..3682.521 rows=902521 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.727..3288.229 rows=902521 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.686..2891.152 rows=902521 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.906..2441.503 rows=902521 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.051..5.847 rows=282 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..4.304 rows=282 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.041..1.621 rows=282 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.224 rows=45 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.066 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.021 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.020 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.093 rows=45 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.021 rows=6 loops=45)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.007 rows=1 loops=282)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.004 rows=1 loops=282)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=4.995..7.541 rows=3200 loops=282)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 6410
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=1.196..1.196 rows=9611 loops=282)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.769..0.769 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.434 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.016 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.138..0.138 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.090 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.864..21.864 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.242..19.678 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.216..9.241 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.515..5.675 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.559 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.494..2.494 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.004..1.559 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.688..1.688 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.796 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.017..8.017 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.987..6.735 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.748 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.971..2.971 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.466 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.416..41.416 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.200 rows=36587 loops=1)
 Total runtime: 4884.408 ms
(75 rows)

-- Test Case 26 - 2716283 ^ 3913743 ^ 3129 -> 52 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5333.88 rows=1 width=279) (actual time=0.910..6.396 rows=52 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..5333.88 rows=1 width=279) (actual time=0.909..6.380 rows=52 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 18
         ->  Nested Loop Left Join  (cost=29.18..5314.29 rows=11 width=239) (actual time=0.859..5.711 rows=70 loops=1)
               ->  Nested Loop  (cost=27.78..5294.74 rows=10 width=193) (actual time=0.823..4.331 rows=69 loops=1)
                     ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.818..4.139 rows=69 loops=1)
                           ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.815..3.952 rows=69 loops=1)
                                 ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.807..3.701 rows=69 loops=1)
                                       Join Filter: (receiver.model_id = device_model.id)
                                       Rows Removed by Join Filter: 1035
                                       ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.799..3.352 rows=69 loops=1)
                                             ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.794..3.040 rows=69 loops=1)
                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.035..1.689 rows=2743 loops=1)
                                                         Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                   ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.739..0.739 rows=282 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                         ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.597 rows=282 loops=1)
                                                               ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.112 rows=45 loops=1)
                                                                     ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.067 rows=1 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.005..0.016 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.019 rows=1 loops=1)
                                                                                       Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                       Rows Removed by Filter: 74
                                                                     ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.030 rows=45 loops=1)
                                                                           Index Cond: (installation_id = installation.id)
                                                               ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                     Index Cond: (station_id = installation_station.id)
                                             ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=69)
                                                   Index Cond: (id = receiver_deployment.receiver_id)
                                       ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                             ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=69)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=69)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.94 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=69)
                     ->  Nested Loop Left Join  (cost=1.12..1.59 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=69)
                           ->  Nested Loop Left Join  (cost=0.84..1.15 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=69)
                                 ->  Nested Loop Left Join  (cost=0.56..0.80 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=69)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=70)
               Index Cond: (animal.species_id = id)
 Total runtime: 6.695 ms
(60 rows)

\q
