
set role to aatams;
set role to aatams;
SET
-- Low selectivity filtering (large number of rows returned for each filter)
-- Test Case 1 - 2716283 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=7.841..11.515 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=7.838..11.480 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.622..4.261 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.512..2.176 rows=98 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.209..1.821 rows=98 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.149..1.699 rows=98 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.186..0.667 rows=98 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.162..0.194 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.135..0.150 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.122..0.130 rows=2 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.105..0.105 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.034..0.034 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.014..0.014 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.007 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.006..0.031 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.014..0.019 rows=2 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.009..0.009 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.011..0.018 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.010 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.022..0.197 rows=49 loops=2)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.941..0.941 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.537 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.037..0.037 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.226..0.226 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.016..0.166 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=98)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.014..0.017 rows=1 loops=98)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.011..0.013 rows=1 loops=98)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.008..0.009 rows=1 loops=98)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.005 rows=1 loops=98)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=92)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=92)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.003..0.003 rows=1 loops=92)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=92)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 12.067 ms
(61 rows)

-- Test Case 2 - 3913743 rows limited to first 100
explain analyze select * from detection_extract_test_view
where spcode = '37018030'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4741.75..11153.44 rows=100 width=279) (actual time=2675.866..2680.180 rows=100 loops=1)
   ->  Hash Left Join  (cost=4741.75..5892981.17 rows=91836 width=279) (actual time=2675.865..2680.160 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 580842
         ->  Hash Left Join  (cost=2253.55..4336436.41 rows=18367253 width=239) (actual time=49.205..2218.944 rows=727838 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=1000.03..3698334.06 rows=17263859 width=193) (actual time=24.962..1709.672 rows=692857 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=24.809..1407.386 rows=692857 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=24.764..1095.388 rows=692857 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=24.007..770.419 rows=692857 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.036..156.400 rows=692857 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=23.947..23.947 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=7.495..19.802 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=7.474..17.329 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.623..9.108 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.001..1.043 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.595..2.595 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.193..1.629 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.351 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.173..0.173 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.060..0.126 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.014 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.044..0.044 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.017 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=4.827..4.827 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.554 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.010..0.010 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.007 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.745..0.745 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.432 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.098 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=24.157..24.157 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=14.289..21.891 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=5.239..10.428 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=3.175..6.525 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.711 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=3.140..3.140 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.006..1.917 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=2.040..2.040 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.006..0.932 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=9.031..9.031 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.504..7.412 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.009..0.876 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.470..3.470 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.545 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=45.813..45.813 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.009..28.430 rows=36587 loops=1)
 Total runtime: 2695.979 ms
(80 rows)

-- Test Case 3 - 17098775 rows limited to first 100
explain analyze select * from detection_extract_test_view
where timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                         QUERY PLAN                                                                                                         
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3.39..571.82 rows=100 width=279) (actual time=0.827..8.212 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=3.39..31977844.24 rows=5625584 width=279) (actual time=0.826..8.191 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=3.10..21831467.95 rows=5625584 width=239) (actual time=0.775..7.088 rows=100 loops=1)
               ->  Nested Loop  (cost=1.69..12376246.08 rows=5287633 width=193) (actual time=0.728..5.120 rows=100 loops=1)
                     ->  Nested Loop  (cost=1.55..11308727.81 rows=5372518 width=187) (actual time=0.724..4.848 rows=100 loops=1)
                           ->  Nested Loop  (cost=1.41..8537379.53 rows=16144362 width=168) (actual time=0.720..4.590 rows=100 loops=1)
                                 ->  Merge Join  (cost=1.13..3572860.21 rows=16144362 width=168) (actual time=0.704..4.141 rows=100 loops=1)
                                       Merge Cond: (receiver_deployment.id = valid_detection.receiver_deployment_id)
                                       ->  Nested Loop  (cost=0.56..188303.48 rows=5710 width=132) (actual time=0.685..1.824 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..186931.88 rows=5710 width=135) (actual time=0.680..1.806 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..184575.50 rows=5710 width=120) (actual time=0.673..1.789 rows=2 loops=1)
                                                         Join Filter: (installation.project_id = receiver_project.id)
                                                         Rows Removed by Join Filter: 86
                                                         ->  Nested Loop  (cost=0.28..178149.81 rows=5710 width=89) (actual time=0.661..1.685 rows=2 loops=1)
                                                               Join Filter: (installation_station.installation_id = installation.id)
                                                               Rows Removed by Join Filter: 112
                                                               ->  Nested Loop  (cost=0.28..168724.94 rows=5710 width=73) (actual time=0.654..1.591 rows=2 loops=1)
                                                                     Join Filter: (receiver_deployment.station_id = installation_station.id)
                                                                     Rows Removed by Join Filter: 2873
                                                                     ->  Index Scan using receiver_deployment_pkey on receiver_deployment  (cost=0.28..457.79 rows=5710 width=24) (actual time=0.009..0.011 rows=2 loops=1)
                                                                     ->  Materialize  (cost=0.00..55.46 rows=1964 width=57) (actual time=0.006..0.595 rows=1438 loops=2)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.005..0.496 rows=1964 loops=1)
                                                               ->  Materialize  (cost=0.00..3.65 rows=110 width=32) (actual time=0.002..0.041 rows=57 loops=2)
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.042 rows=110 loops=1)
                                                         ->  Materialize  (cost=0.00..2.12 rows=75 width=39) (actual time=0.002..0.045 rows=44 loops=2)
                                                               ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.014 rows=75 loops=1)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.002..0.007 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..3183595.42 rows=16144362 width=52) (actual time=0.015..2.265 rows=100 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 2460
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=100)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=99)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=99)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 8.617 ms
(59 rows)

-- Test Case 4 -  2716283 ^ 3913743 -> 1420919 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=65.010..66.436 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=65.008..66.408 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 115
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=23.110..24.247 rows=221 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.052..1.991 rows=219 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.906..1.742 rows=219 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.865..1.585 rows=219 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.109..0.713 rows=219 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.096..0.177 rows=5 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 61
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.089..0.137 rows=5 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.084..0.098 rows=5 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.074..0.074 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.020 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.020 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.017 rows=5 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=5)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.004 rows=13 loops=5)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.007 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.014..0.080 rows=44 loops=5)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.748..0.748 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.401 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.032..0.032 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.090 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=22.040..22.040 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.296..19.898 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.220..9.332 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.502..5.645 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.575 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.480..2.480 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.535 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.704..1.704 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.831 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.058..8.058 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.058..6.793 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.760 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.044..3.044 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.484 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.292..41.292 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..24.361 rows=36587 loops=1)
 Total runtime: 67.876 ms
(74 rows)

-- Test Case 5 - 2716283 ^ 17098775 -> 902906 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=2.457..5.739 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=2.456..5.713 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=2.399..4.656 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=2.359..2.680 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=2.211..2.470 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=2.170..2.373 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=1.395..1.524 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.105..0.142 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.102..0.130 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.077..0.084 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.069..0.069 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.057..0.057 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.039 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.010 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.013 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.007..0.008 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.311..0.334 rows=25 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.102..0.102 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.765..0.765 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.423 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.085 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 6.037 ms
(62 rows)

-- Test Case 6 - 3913743 ^ 17098775 -> 2233756 rows limited to first 100
explain analyze select * from detection_extract_test_view
where spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..108148.56 rows=100 width=279) (actual time=81.160..1271.953 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=930.07..30159347.10 rows=28128 width=279) (actual time=81.159..1271.924 rows=100 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 35784
         ->  Nested Loop Left Join  (cost=929.78..20152836.88 rows=5625584 width=239) (actual time=79.947..1138.888 rows=35884 loops=1)
               ->  Nested Loop  (cost=928.38..10697615.02 rows=5287633 width=193) (actual time=79.846..483.265 rows=35884 loops=1)
                     ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=79.837..385.152 rows=35884 loops=1)
                           ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=79.827..291.072 rows=35884 loops=1)
                                 ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=79.775..159.206 rows=35884 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=57.964..100.614 rows=35884 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 290836
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.776..21.776 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.231..18.198 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.202..15.769 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.253..8.600 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..0.973 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.239..2.239 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.169..1.406 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.260 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.155..0.155 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.056..0.116 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.014 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.043..0.043 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.022 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.935..3.935 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.004..2.176 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.018..0.018 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.006..0.008 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=35884)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=35884)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=35884)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.015..0.017 rows=1 loops=35884)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.012..0.014 rows=1 loops=35884)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.009..0.010 rows=1 loops=35884)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=35884)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=35884)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=35420)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=35420)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=35420)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=35420)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=35884)
               Index Cond: (animal.species_id = id)
 Total runtime: 1272.266 ms
(65 rows)

-- Test Case 7 - 2716283 ^ 3913743 ^ 17098775 -> 690003 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=65.172..66.104 rows=100 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=65.170..66.072 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 2
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.685..24.057 rows=102 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.875..2.160 rows=102 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.725..1.956 rows=102 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.684..1.862 rows=102 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.907..1.027 rows=102 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.053..0.085 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..0.071 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.041..0.048 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.033..0.033 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.006 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.010 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.012 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.204..0.224 rows=26 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.090..0.090 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.768..0.768 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.440 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.021 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.140..0.140 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.082 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.792..21.792 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.207..19.724 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.199..9.206 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.505..5.674 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.598 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.483..2.483 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.565 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.684..1.684 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.813 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=7.998..7.998 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.004..6.749 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.663 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.989..2.989 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.001..1.476 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.331..41.331 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.056 rows=36587 loops=1)
 Total runtime: 67.509 ms
(75 rows)

 
-- High selectivity filtering (small number of rows returned for each filter)
-- Test Case 8 - 5909 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=1.489..4.856 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=1.488..4.828 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.434..3.788 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.384..1.753 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.237..1.541 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.195..1.444 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.384..0.563 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.330..0.364 rows=3 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 31
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.323..0.341 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.316..0.323 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.290..0.290 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 872
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.115 rows=873 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.024..0.029 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.005 rows=11 loops=3)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.010 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.018..0.045 rows=33 loops=3)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.801..0.801 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.497 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.021 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.086 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.017..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.016 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.142 ms
(61 rows)

-- Test Case 9 - 2153 rows
set geqo_threshold to 12;
SET
explain analyze select * from detection_extract_test_view
where spcode = '37018003'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4741.75..11153.44 rows=100 width=279) (actual time=14561.958..14565.581 rows=100 loops=1)
   ->  Hash Left Join  (cost=4741.75..5892981.17 rows=91836 width=279) (actual time=14561.956..14565.556 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 4280220
         ->  Hash Left Join  (cost=2253.55..4336436.41 rows=18367253 width=239) (actual time=45.497..12964.879 rows=4283200 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=1000.03..3698334.06 rows=17263859 width=193) (actual time=22.266..10320.535 rows=4275822 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=22.119..8470.577 rows=4275822 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=22.076..6553.212 rows=4275822 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=21.280..4632.714 rows=4275822 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.003..889.677 rows=4275822 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.258..21.258 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.168..17.814 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.150..15.329 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.191..8.211 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.001..0.925 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.181..2.181 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.153..1.385 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.279 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.144..0.144 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.049..0.113 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.020 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.037..0.037 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.019 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.946..3.946 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.135 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.009..0.009 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.787..0.787 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.437 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.134..0.134 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.090 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=23.200..23.200 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=13.539..20.989 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.765..9.687 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.810..6.034 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.641 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.773..2.773 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.554 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.935..1.935 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.835 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.751..8.751 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.479..7.155 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.004..0.708 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.456..3.456 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.481 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.500..41.500 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.187 rows=36587 loops=1)
 Total runtime: 14567.368 ms
(80 rows)

-- Test Case 10 - 1065 rows
explain analyze select * from detection_extract_test_view
  where timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=398.97..1704.98 rows=100 width=279) (actual time=6.279..11.019 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=398.97..6772.29 rows=488 width=279) (actual time=6.278..10.998 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=398.68..5892.13 rows=488 width=239) (actual time=6.214..9.896 rows=100 loops=1)
               ->  Nested Loop  (cost=397.27..4950.72 rows=459 width=193) (actual time=6.154..7.872 rows=100 loops=1)
                     ->  Nested Loop  (cost=397.13..4858.12 rows=466 width=187) (actual time=6.148..7.594 rows=100 loops=1)
                           ->  Nested Loop  (cost=396.99..4617.80 rows=1400 width=168) (actual time=6.142..7.334 rows=100 loops=1)
                                 ->  Nested Loop  (cost=396.85..4384.47 rows=1400 width=171) (actual time=6.136..7.073 rows=100 loops=1)
                                       ->  Hash Join  (cost=396.57..3806.73 rows=1400 width=156) (actual time=6.119..6.618 rows=100 loops=1)
                                             Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                             ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.316..5.731 rows=100 loops=1)
                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                   ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.268..5.635 rows=100 loops=1)
                                                         Hash Cond: (installation_station.installation_id = installation.id)
                                                         ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.203..5.509 rows=100 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.064..4.298 rows=100 loops=1)
                                                                     Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                     ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.037..0.159 rows=100 loops=1)
                                                                           Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                     ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.009..4.009 rows=5710 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                           ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..2.556 rows=5710 loops=1)
                                                               ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.129..1.129 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                     ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.515 rows=1964 loops=1)
                                                         ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.056..0.056 rows=110 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.027 rows=110 loops=1)
                                                   ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.040..0.040 rows=75 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.016 rows=75 loops=1)
                                             ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.791..0.791 rows=1519 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                   ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.005..0.450 rows=1519 loops=1)
                                       ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=100)
                                             Index Cond: (id = receiver_deployment.receiver_id)
                                 ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=100)
                                       Index Cond: (id = receiver.model_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..2.04 rows=1 width=46) (actual time=0.017..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.68 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..1.24 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.90 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 11.329 ms
(60 rows)

-- Test Case 11 - 5909 ^ 2153 -> 609 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=67.721..71.008 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=67.719..70.984 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 1332
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=23.334..28.244 rows=1441 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.318..5.139 rows=1435 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.170..4.372 rows=1435 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.129..3.695 rows=1435 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.358..2.209 rows=1435 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.321..0.535 rows=13 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 181
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.314..0.459 rows=13 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.306..0.361 rows=13 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.294..0.306 rows=4 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.001..0.115 rows=898 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.010 rows=3 loops=4)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=13)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.003 rows=15 loops=13)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.003 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.014..0.078 rows=110 loops=13)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.762..0.762 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.454 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.091 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.997..21.997 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.257..19.854 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.217..9.322 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.526..5.708 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.617 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.504..2.504 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.556 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.680..1.680 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.835 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.031..8.031 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.035..6.724 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.703 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.021..3.021 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.502 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.327..41.327 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..23.994 rows=36587 loops=1)
 Total runtime: 72.459 ms
(74 rows)

-- Test Case 12 - 5909 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.563..3.910 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.562..3.896 rows=55 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3373.72 rows=6 width=239) (actual time=0.513..3.287 rows=55 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3371.58 rows=6 width=239) (actual time=0.505..3.093 rows=55 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3368.94 rows=6 width=215) (actual time=0.499..2.904 rows=55 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3366.85 rows=6 width=215) (actual time=0.493..2.715 rows=55 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3364.85 rows=6 width=215) (actual time=0.485..2.551 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.78..3361.41 rows=6 width=193) (actual time=0.476..2.282 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.471..2.134 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.468..1.980 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.463..1.795 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.455..1.515 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.437..1.267 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.024..0.728 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.250..0.250 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.059..0.214 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.050..0.084 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.065 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.017 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.006..0.011 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.007 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=55)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=55)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=55)
               Index Cond: (animal.species_id = id)
 Total runtime: 4.225 ms
(58 rows)

-- Test Case 13 -  2153 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                               QUERY PLAN                                                                                                                                
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4862.46..5820.38 rows=2 width=279) (actual time=33.161..38.569 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=4862.46..5820.38 rows=2 width=279) (actual time=33.159..38.548 rows=55 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 1010
         ->  Hash Right Join  (cost=4862.17..4952.37 rows=488 width=239) (actual time=33.090..34.654 rows=1065 loops=1)
               Hash Cond: (animal.id = animal_release.animal_id)
               ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.450 rows=4023 loops=1)
               ->  Hash  (cost=4856.07..4856.07 rows=488 width=239) (actual time=32.834..32.834 rows=1065 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 352kB
                     ->  Nested Loop Left Join  (cost=4528.01..4856.07 rows=488 width=239) (actual time=26.001..31.438 rows=1065 loops=1)
                           ->  Hash Right Join  (cost=4527.73..4641.32 rows=488 width=215) (actual time=25.989..27.814 rows=1065 loops=1)
                                 Hash Cond: (surgery.tag_id = tag.id)
                                 ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.511 rows=3923 loops=1)
                                 ->  Hash  (cost=4521.63..4521.63 rows=488 width=215) (actual time=25.838..25.838 rows=1065 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 327kB
                                       ->  Nested Loop Left Join  (cost=867.27..4521.63 rows=488 width=215) (actual time=13.067..24.335 rows=1065 loops=1)
                                             ->  Hash Left Join  (cost=866.99..4359.32 rows=488 width=215) (actual time=13.045..20.937 rows=1065 loops=1)
                                                   Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                                   ->  Hash Join  (cost=686.58..4161.98 rows=459 width=193) (actual time=10.268..17.192 rows=1065 loops=1)
                                                         Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                                         ->  Hash Join  (cost=675.68..4144.75 rows=466 width=187) (actual time=10.100..16.479 rows=1065 loops=1)
                                                               Hash Cond: (receiver.organisation_id = organisation.id)
                                                               ->  Hash Join  (cost=673.54..4132.70 rows=1400 width=168) (actual time=10.047..15.826 rows=1065 loops=1)
                                                                     Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                                     ->  Hash Join  (cost=614.36..4054.27 rows=1400 width=168) (actual time=9.272..14.438 rows=1065 loops=1)
                                                                           Hash Cond: (receiver.model_id = device_model.id)
                                                                           ->  Hash Join  (cost=613.00..4033.66 rows=1400 width=171) (actual time=9.254..13.872 rows=1065 loops=1)
                                                                                 Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                                 ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.281..9.125 rows=1065 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.228..8.490 rows=1065 loops=1)
                                                                                             Hash Cond: (installation_station.installation_id = installation.id)
                                                                                             ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.160..7.857 rows=1065 loops=1)
                                                                                                   Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                                   ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.039..6.071 rows=1065 loops=1)
                                                                                                         Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                                         ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.031..1.013 rows=1065 loops=1)
                                                                                                               Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                                                         ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=3.990..3.990 rows=5710 loops=1)
                                                                                                               Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.557 rows=5710 loops=1)
                                                                                                   ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.113..1.113 rows=1964 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                                         ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.516 rows=1964 loops=1)
                                                                                             ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.058..0.058 rows=110 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.025 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.039..0.039 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.015 rows=75 loops=1)
                                                                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.963..3.963 rows=7227 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                       ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.118 rows=7227 loops=1)
                                                                           ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.009..0.009 rows=16 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.005 rows=16 loops=1)
                                                                     ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.766..0.766 rows=1519 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                                           ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.413 rows=1519 loops=1)
                                                               ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                                     ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.020 rows=51 loops=1)
                                                         ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.159..0.159 rows=173 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                               ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.112 rows=173 loops=1)
                                                   ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.760..2.760 rows=5307 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                                         ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.005..1.413 rows=5307 loops=1)
                                             ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=1065)
                                                   Index Cond: (id = sensor.tag_id)
                                                   Heap Fetches: 0
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=1065)
                                 Index Cond: (surgery.release_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.002 rows=1 loops=1065)
               Index Cond: (animal.species_id = id)
 Total runtime: 38.894 ms
(76 rows)

-- Test Case 14 -  5909 ^ 2153 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3384.42 rows=1 width=279) (actual time=0.502..3.832 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3384.42 rows=1 width=279) (actual time=0.501..3.818 rows=55 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         ->  Nested Loop Left Join  (cost=29.18..3373.72 rows=6 width=239) (actual time=0.451..3.192 rows=55 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3371.58 rows=6 width=239) (actual time=0.445..3.003 rows=55 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3368.94 rows=6 width=215) (actual time=0.439..2.813 rows=55 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3366.85 rows=6 width=215) (actual time=0.433..2.606 rows=55 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3364.85 rows=6 width=215) (actual time=0.425..2.436 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.78..3361.41 rows=6 width=193) (actual time=0.416..2.173 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.412..2.027 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.408..1.869 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.402..1.689 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.395..1.388 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.388..1.140 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.025..0.639 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.248..0.248 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.058..0.217 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.050..0.085 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.066 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.014 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.006..0.011 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.002..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.004 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=55)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=55)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=55)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=55)
               Index Cond: (animal.species_id = id)
 Total runtime: 4.149 ms
(59 rows)

-- Mixed selectivity filtering
-- Test Case 15 - 5909 ^ 833188 -> 184 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=64.734..73.602 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=64.732..73.574 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         Rows Removed by Filter: 2155
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=23.224..30.412 rows=2267 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.339..6.887 rows=2248 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.192..5.764 rows=2248 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.152..4.727 rows=2248 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.354..2.843 rows=2248 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.317..0.595 rows=19 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 271
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.310..0.490 rows=19 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.304..0.372 rows=19 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.292..0.304 rows=5 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.020 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.006..0.006 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.122 rows=899 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.011 rows=4 loops=5)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=19)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=15 loops=19)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.007 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.009..0.062 rows=118 loops=19)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.789..0.789 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.465 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.090 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.868..21.868 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.209..19.804 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.225..9.350 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.495..5.643 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.579 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.474..2.474 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.535 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.716..1.716 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.836 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=7.975..7.975 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.985..6.655 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.677 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.972..2.972 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.481 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.306..41.306 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.006..24.139 rows=36587 loops=1)
 Total runtime: 75.087 ms
(74 rows)

-- Test Case 16 - 5909 ^ 17098775 -> 3889 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=1.475..4.876 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=1.474..4.852 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=1.430..3.776 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.400..1.725 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.253..1.518 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.210..1.413 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.414..0.538 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.059..0.082 rows=3 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.046..0.063 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.041..0.045 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.033..0.033 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.006 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.009 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.010 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=3)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.108..0.134 rows=33 loops=3)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 148
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.038..0.038 rows=210 loops=3)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.786..0.786 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.443 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.093 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.011..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.175 ms
(62 rows)

-- Test Case 17 - 2716283 ^ 464 -> 448 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3815.07..16880.96 rows=100 width=279) (actual time=9818.919..9819.816 rows=100 loops=1)
   ->  Hash Left Join  (cost=3815.07..163741.55 rows=1224 width=279) (actual time=9818.917..9819.794 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 2696635
         ->  Hash Left Join  (cost=1326.86..140177.74 rows=244897 width=239) (actual time=22.975..8522.811 rows=2716283 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.063..6660.733 rows=2710212 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.918..5483.476 rows=2710212 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.878..4327.183 rows=2710212 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.110..2997.125 rows=2710212 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.097..6.522 rows=282 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 4230
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.089..4.790 rows=282 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.084..2.146 rows=282 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.074..0.833 rows=45 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 1919
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.060 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.019 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.018 rows=110 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.354 rows=1964 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.020 rows=6 loops=45)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.007 rows=1 loops=282)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=282)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.015..5.640 rows=9611 loops=282)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.761..0.761 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.443 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.032..0.032 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.085 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.894..21.894 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.222..19.736 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.203..9.249 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.478..5.664 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.561 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.457..2.457 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.492 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.711..1.711 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.824 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.010..8.010 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=3.001..6.719 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.709 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.986..2.986 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.488 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.244..41.244 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..24.071 rows=36587 loops=1)
 Total runtime: 9822.077 ms
(74 rows)

-- Test Case 18 - 2716283 ^ 2005 -> 4 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2013-06-08 00:00:00+00' and '2013-06-08 01:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3896.81 rows=7 width=279) (actual time=1.994..2.571 rows=4 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3896.81 rows=7 width=279) (actual time=1.992..2.569 rows=4 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3884.18 rows=7 width=239) (actual time=1.945..2.490 rows=4 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3881.69 rows=7 width=239) (actual time=1.937..2.471 rows=4 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3878.61 rows=7 width=215) (actual time=1.930..2.452 rows=4 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3876.17 rows=7 width=215) (actual time=1.923..2.437 rows=4 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3873.84 rows=7 width=215) (actual time=1.917..2.419 rows=4 loops=1)
                                       ->  Nested Loop  (cost=27.78..3870.07 rows=7 width=193) (actual time=1.907..2.395 rows=4 loops=1)
                                             ->  Nested Loop  (cost=27.63..3868.68 rows=7 width=187) (actual time=1.902..2.380 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3864.90 rows=22 width=168) (actual time=1.898..2.368 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3856.39 rows=22 width=168) (actual time=1.890..2.349 rows=4 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 60
                                                               ->  Nested Loop  (cost=27.21..3849.91 rows=22 width=171) (actual time=1.883..2.316 rows=4 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3840.83 rows=22 width=156) (actual time=1.876..2.294 rows=4 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3808.21 rows=1613 width=52) (actual time=0.048..1.249 rows=1839 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-06-08 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-06-08 01:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.699..0.699 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.061..0.559 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.111 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.065 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.020 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.017 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.029 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.004 rows=1 loops=4)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=4)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.007 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.38 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=4)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.001 rows=1 loops=4)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.003 rows=1 loops=4)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.53 rows=1 width=22) (actual time=0.005..0.005 rows=1 loops=4)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=4)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=4)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.003..0.003 rows=1 loops=4)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=4)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=4)
               Index Cond: (animal.species_id = id)
 Total runtime: 2.915 ms
(58 rows)

-- Test Case 19 - 464 ^ 17098775 -> 6 rows
explain analyze select * from detection_extract_test_view
where spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..108148.56 rows=100 width=279) (actual time=289448.854..452005.160 rows=6 loops=1)
   ->  Nested Loop Left Join  (cost=930.07..30159347.10 rows=28128 width=279) (actual time=289448.852..452005.156 rows=6 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 17098769
         ->  Nested Loop Left Join  (cost=929.78..20152836.88 rows=5625584 width=239) (actual time=21.954..409852.830 rows=17098775 loops=1)
               ->  Nested Loop  (cost=928.38..10697615.02 rows=5287633 width=193) (actual time=21.893..181974.518 rows=16316319 loops=1)
                     ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=21.885..138497.123 rows=16316319 loops=1)
                           ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=21.877..95823.312 rows=16316319 loops=1)
                                 ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=21.840..37600.019 rows=16316319 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.031..21358.061 rows=16316319 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 36799631
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.789..21.789 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.248..18.210 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.228..15.821 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.265..8.542 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.001..1.021 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.255..2.255 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.156..1.428 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.261 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.147..0.147 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.049..0.107 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.015 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.020 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.949..3.949 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.194 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.012..0.012 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.005 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=16316319)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=16316319)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=16316319)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.011..0.013 rows=1 loops=16316319)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.009..0.011 rows=1 loops=16316319)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=16316319)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.005..0.006 rows=1 loops=16316319)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=16316319)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=11828011)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=11828011)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=12084573)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=12084573)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.001..0.002 rows=1 loops=17098775)
               Index Cond: (animal.species_id = id)
 Total runtime: 452005.461 ms
(65 rows)

-- Test Case 20 - 833188 ^ 5489 -> 210 rows
explain analyze select * from detection_extract_test_view
where spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                         QUERY PLAN                                                                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=1609.87..15898.41 rows=8 width=279) (actual time=23.468..69.312 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=1609.87..15898.41 rows=8 width=279) (actual time=23.466..69.280 rows=100 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         Rows Removed by Filter: 3368
         ->  Hash Left Join  (cost=1609.58..13075.53 rows=1587 width=239) (actual time=23.060..55.852 rows=3468 loops=1)
               Hash Cond: (animal_release.animal_id = animal.id)
               ->  Hash Left Join  (cost=1489.06..12927.24 rows=1587 width=239) (actual time=21.148..51.751 rows=3468 loops=1)
                     Hash Cond: (surgery.release_id = animal_release.id)
                     ->  Hash Left Join  (cost=1287.86..12698.27 rows=1587 width=215) (actual time=18.415..46.764 rows=3468 loops=1)
                           Hash Cond: (tag.id = surgery.tag_id)
                           ->  Hash Left Join  (cost=1142.59..12510.67 rows=1587 width=215) (actual time=16.415..42.530 rows=3357 loops=1)
                                 Hash Cond: (sensor.tag_id = tag.id)
                                 ->  Hash Left Join  (cost=866.99..12201.34 rows=1587 width=215) (actual time=13.122..36.779 rows=3357 loops=1)
                                       Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                       ->  Hash Join  (cost=686.58..11965.89 rows=1492 width=193) (actual time=10.273..31.081 rows=3143 loops=1)
                                             Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                             ->  Hash Join  (cost=675.68..11934.41 rows=1515 width=187) (actual time=10.124..29.156 rows=3143 loops=1)
                                                   Hash Cond: (receiver.organisation_id = organisation.id)
                                                   ->  Hash Join  (cost=673.54..11900.04 rows=4554 width=168) (actual time=10.082..27.373 rows=3143 loops=1)
                                                         Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                         ->  Hash Join  (cost=614.36..11778.24 rows=4554 width=168) (actual time=9.295..24.676 rows=3143 loops=1)
                                                               Hash Cond: (receiver.model_id = device_model.id)
                                                               ->  Hash Join  (cost=613.00..11714.26 rows=4554 width=171) (actual time=9.276..22.992 rows=3143 loops=1)
                                                                     Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                     ->  Hash Join  (cost=337.39..11341.88 rows=4554 width=156) (actual time=5.277..16.585 rows=3143 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Hash Join  (cost=334.70..11276.58 rows=4554 width=125) (actual time=5.223..14.707 rows=3143 loops=1)
                                                                                 Hash Cond: (installation_station.installation_id = installation.id)
                                                                                 ->  Hash Join  (cost=330.23..11209.49 rows=4554 width=109) (actual time=5.154..12.872 rows=3143 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Hash Join  (cost=260.04..11070.99 rows=4554 width=60) (actual time=4.034..9.645 rows=3143 loops=1)
                                                                                             Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                             ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.054..2.721 rows=3143 loops=1)
                                                                                                   Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                                                             ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=3.960..3.960 rows=5710 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                   ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.545 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.111..1.111 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                             ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.511 rows=1964 loops=1)
                                                                                 ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.058..0.058 rows=110 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.029 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.039..0.039 rows=75 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.018 rows=75 loops=1)
                                                                     ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.991..3.991 rows=7227 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                           ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.175 rows=7227 loops=1)
                                                               ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.009..0.009 rows=16 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.003 rows=16 loops=1)
                                                         ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.778..0.778 rows=1519 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                               ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.460 rows=1519 loops=1)
                                                   ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                         ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                                             ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                   ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.087 rows=173 loops=1)
                                       ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.836..2.836 rows=5307 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.005..1.487 rows=5307 loops=1)
                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.282..3.282 rows=7227 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                       ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.477 rows=7227 loops=1)
                           ->  Hash  (cost=96.23..96.23 rows=3923 width=16) (actual time=1.990..1.990 rows=3923 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 184kB
                                 ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.949 rows=3923 loops=1)
                     ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.723..2.723 rows=3920 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 241kB
                           ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.514 rows=3920 loops=1)
               ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.890..1.890 rows=4023 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 189kB
                     ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.818 rows=4023 loops=1)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=3468)
               Index Cond: (animal.species_id = id)
 Total runtime: 69.642 ms
(79 rows)

-- Test Case 21 - 5909 ^ 2153 ^ 17098775 -> 284 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=64.660..74.856 rows=100 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=64.659..74.828 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018003'::text)
         Rows Removed by Filter: 2228
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.092..31.582 rows=2340 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.378..8.154 rows=2324 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.229..6.975 rows=2324 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.189..5.936 rows=2324 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.377..4.063 rows=2324 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.051..0.549 rows=47 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.047..0.418 rows=47 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.172 rows=47 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.032..0.047 rows=11 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.006 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.013 rows=11 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.004..0.008 rows=4 loops=11)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=47)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=47)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.030..0.058 rows=49 loops=47)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 31
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.015..0.015 rows=85 loops=47)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.803..0.803 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.431 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.015 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.138..0.138 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.092 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.694..21.694 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.244..19.641 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.205..9.125 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.478..5.581 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.556 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.456..2.456 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.522 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.715..1.715 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.815 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.030..8.030 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.987..6.725 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.718 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.971..2.971 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.459 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.416..41.416 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..24.328 rows=36587 loops=1)
 Total runtime: 76.284 ms
(75 rows)

-- Test Case 22 - 5909 ^ 833188 ^ 5489 -> 13 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..10915.17 rows=1 width=279) (actual time=0.804..4.917 rows=13 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..10915.17 rows=1 width=279) (actual time=0.803..4.911 rows=13 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         ->  Nested Loop Left Join  (cost=29.18..10877.79 rows=21 width=239) (actual time=0.753..4.731 rows=13 loops=1)
               ->  Nested Loop  (cost=27.78..10840.41 rows=20 width=193) (actual time=0.718..4.462 rows=13 loops=1)
                     ->  Nested Loop  (cost=27.63..10836.44 rows=20 width=187) (actual time=0.712..4.421 rows=13 loops=1)
                           ->  Nested Loop  (cost=27.49..10825.97 rows=61 width=168) (actual time=0.709..4.386 rows=13 loops=1)
                                 ->  Nested Loop  (cost=27.21..10805.50 rows=61 width=168) (actual time=0.704..4.340 rows=13 loops=1)
                                       Join Filter: (receiver.model_id = device_model.id)
                                       Rows Removed by Join Filter: 195
                                       ->  Nested Loop  (cost=27.21..10789.66 rows=61 width=171) (actual time=0.697..4.261 rows=13 loops=1)
                                             ->  Hash Join  (cost=26.93..10764.48 rows=61 width=156) (actual time=0.690..4.195 rows=13 loops=1)
                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.034..3.071 rows=5041 loops=1)
                                                         Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                   ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.249..0.249 rows=64 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                         ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.057..0.219 rows=64 loops=1)
                                                               ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.050..0.090 rows=15 loops=1)
                                                                     ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.040..0.065 rows=1 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.018 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                       Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                       Rows Removed by Filter: 74
                                                                     ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.015 rows=15 loops=1)
                                                                           Index Cond: (installation_id = installation.id)
                                                               ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.002..0.005 rows=4 loops=15)
                                                                     Index Cond: (station_id = installation_station.id)
                                             ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=13)
                                                   Index Cond: (id = receiver_deployment.receiver_id)
                                       ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.003 rows=16 loops=13)
                                             ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.33 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=13)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=13)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.86 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=13)
                     ->  Nested Loop Left Join  (cost=1.12..1.50 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=13)
                           ->  Nested Loop Left Join  (cost=0.84..1.06 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=13)
                                 ->  Nested Loop Left Join  (cost=0.56..0.71 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=13)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.38 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=13)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=13)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=13)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=13)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.215 ms
(59 rows)

-- Test Case 23 - 5909 ^ 833188 ^ 17098775 -> 54 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=66.623..83.162 rows=54 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=66.621..83.141 rows=54 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018021'::text)
         Rows Removed by Filter: 3835
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.094..36.656 rows=3889 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.338..12.081 rows=3854 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.189..10.280 rows=3854 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.148..8.587 rows=3854 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.373..5.951 rows=3854 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.048..0.754 rows=64 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.044..0.570 rows=64 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.038..0.255 rows=64 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.031..0.092 rows=15 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.062 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.020 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.018 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.020 rows=15 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=4 loops=15)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=64)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=64)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.030..0.061 rows=60 loops=64)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 32
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.014..0.014 rows=92 loops=64)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.766..0.766 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.444 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.138..0.138 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.082 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.736..21.736 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.204..19.706 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.195..9.243 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.508..5.665 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.590 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.486..2.486 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.538 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.676..1.676 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.806 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=8.000..8.000 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.969..6.720 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.684 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.956..2.956 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.460 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.318..41.318 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.005..24.344 rows=36587 loops=1)
 Total runtime: 83.468 ms
(75 rows)

-- Test Case 24 - 2716283 ^ 464 ^ 3129 -> 2 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5333.88 rows=1 width=279) (actual time=1.481..5.975 rows=2 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..5333.88 rows=1 width=279) (actual time=1.480..5.974 rows=2 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 68
         ->  Nested Loop Left Join  (cost=29.18..5314.29 rows=11 width=239) (actual time=0.872..5.651 rows=70 loops=1)
               ->  Nested Loop  (cost=27.78..5294.74 rows=10 width=193) (actual time=0.835..4.289 rows=69 loops=1)
                     ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.829..4.104 rows=69 loops=1)
                           ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.826..3.913 rows=69 loops=1)
                                 ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.818..3.652 rows=69 loops=1)
                                       Join Filter: (receiver.model_id = device_model.id)
                                       Rows Removed by Join Filter: 1035
                                       ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.811..3.307 rows=69 loops=1)
                                             ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.806..3.037 rows=69 loops=1)
                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.050..1.725 rows=2743 loops=1)
                                                         Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                   ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.736..0.736 rows=282 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                         ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.590 rows=282 loops=1)
                                                               ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.129 rows=45 loops=1)
                                                                     ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.068 rows=1 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.017 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                       Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                       Rows Removed by Filter: 74
                                                                     ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.029 rows=45 loops=1)
                                                                           Index Cond: (installation_id = installation.id)
                                                               ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                     Index Cond: (station_id = installation_station.id)
                                             ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.002..0.003 rows=1 loops=69)
                                                   Index Cond: (id = receiver_deployment.receiver_id)
                                       ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                             ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=69)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=69)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.94 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=69)
                     ->  Nested Loop Left Join  (cost=1.12..1.59 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=69)
                           ->  Nested Loop Left Join  (cost=0.84..1.15 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=69)
                                 ->  Nested Loop Left Join  (cost=0.56..0.80 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=69)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=70)
               Index Cond: (animal.species_id = id)
 Total runtime: 6.268 ms
(60 rows)

-- Test Case 25 - 2716283 ^ 464 ^ 17098775 -> 4 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4127.15..36853.90 rows=100 width=279) (actual time=4876.615..4877.775 rows=4 loops=1)
   ->  Hash Left Join  (cost=4127.15..126852.46 rows=375 width=279) (actual time=4876.613..4877.771 rows=4 loops=1)
         Hash Cond: (animal.species_id = species.id)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37346004'::text)
         Rows Removed by Filter: 902902
         ->  Hash Left Join  (cost=1638.94..117659.78 rows=75008 width=239) (actual time=23.696..4352.120 rows=902906 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.874..3674.487 rows=902521 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.727..3280.971 rows=902521 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.686..2883.550 rows=902521 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.908..2433.660 rows=902521 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.050..5.872 rows=282 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.046..4.345 rows=282 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.040..1.611 rows=282 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.033..0.227 rows=45 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.064 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.020 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.020 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.098 rows=45 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.009..0.021 rows=6 loops=45)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.007 rows=1 loops=282)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.004 rows=1 loops=282)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=4.979..7.516 rows=3200 loops=282)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 6410
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=1.194..1.194 rows=9611 loops=282)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.770..0.770 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.458 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.032..0.032 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.080 rows=173 loops=1)
               ->  Hash  (cost=1187.18..1187.18 rows=5307 width=46) (actual time=21.803..21.803 rows=5488 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 386kB
                     ->  Hash Right Join  (cost=890.51..1187.18 rows=5307 width=46) (actual time=12.214..19.590 rows=5488 loops=1)
                           Hash Cond: (surgery.tag_id = tag.id)
                           ->  Hash Left Join  (cost=321.72..555.25 rows=3923 width=40) (actual time=4.209..9.174 rows=3923 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Left Join  (cost=201.20..366.08 rows=3923 width=40) (actual time=2.508..5.680 rows=3923 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.591 rows=3923 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.485..2.485 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.525 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.690..1.690 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..0.837 rows=4023 loops=1)
                           ->  Hash  (cost=502.45..502.45 rows=5307 width=22) (actual time=7.994..7.994 rows=5307 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                 ->  Hash Left Join  (cost=275.61..502.45 rows=5307 width=22) (actual time=2.983..6.756 rows=5307 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.701 rows=5307 loops=1)
                                       ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.969..2.969 rows=7227 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                             ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.001..1.452 rows=7227 loops=1)
         ->  Hash  (cost=1672.87..1672.87 rows=36587 width=56) (actual time=41.384..41.384 rows=36587 loops=1)
               Buckets: 2048  Batches: 4  Memory Usage: 824kB
               ->  Seq Scan on species  (cost=0.00..1672.87 rows=36587 width=56) (actual time=0.007..24.558 rows=36587 loops=1)
 Total runtime: 4878.070 ms
(75 rows)

-- Test Case 26 - 2716283 ^ 3913743 ^ 3129 -> 52 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5333.88 rows=1 width=279) (actual time=0.873..6.349 rows=52 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..5333.88 rows=1 width=279) (actual time=0.872..6.327 rows=52 loops=1)
         Filter: ((COALESCE(species.spcode, ''::character varying))::text = '37018030'::text)
         Rows Removed by Filter: 18
         ->  Nested Loop Left Join  (cost=29.18..5314.29 rows=11 width=239) (actual time=0.821..5.665 rows=70 loops=1)
               ->  Nested Loop  (cost=27.78..5294.74 rows=10 width=193) (actual time=0.785..4.261 rows=69 loops=1)
                     ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.781..4.068 rows=69 loops=1)
                           ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.777..3.883 rows=69 loops=1)
                                 ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.769..3.636 rows=69 loops=1)
                                       Join Filter: (receiver.model_id = device_model.id)
                                       Rows Removed by Join Filter: 1035
                                       ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.761..3.282 rows=69 loops=1)
                                             ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.756..2.987 rows=69 loops=1)
                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.035..1.697 rows=2743 loops=1)
                                                         Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                   ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.702..0.702 rows=282 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                         ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.564 rows=282 loops=1)
                                                               ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.123 rows=45 loops=1)
                                                                     ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.068 rows=1 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.005..0.022 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                       Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                       Rows Removed by Filter: 74
                                                                     ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.029 rows=45 loops=1)
                                                                           Index Cond: (installation_id = installation.id)
                                                               ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                     Index Cond: (station_id = installation_station.id)
                                             ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=69)
                                                   Index Cond: (id = receiver_deployment.receiver_id)
                                       ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                             ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=1)
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=69)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=69)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.94 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=69)
                     ->  Nested Loop Left Join  (cost=1.12..1.59 rows=1 width=46) (actual time=0.013..0.016 rows=1 loops=69)
                           ->  Nested Loop Left Join  (cost=0.84..1.15 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=69)
                                 ->  Nested Loop Left Join  (cost=0.56..0.80 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=69)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=69)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=70)
               Index Cond: (animal.species_id = id)
 Total runtime: 6.684 ms
(60 rows)

\q
