
set role to aatams;
set role to aatams;
SET
-- Low selectivity filtering (large number of rows returned for each filter)
-- Test Case 1 - 2716283 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=7.852..11.506 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=7.850..11.481 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.541..4.179 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.431..2.105 rows=98 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.209..1.829 rows=98 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.154..1.708 rows=98 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.187..0.661 rows=98 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.162..0.194 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.135..0.150 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.122..0.129 rows=2 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.105..0.105 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.032..0.032 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.013..0.013 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.005 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.006..0.029 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.014..0.020 rows=2 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.009..0.009 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.011..0.016 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.008 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.022..0.195 rows=49 loops=2)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.946..0.946 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.550 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.037..0.037 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.021 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.173..0.173 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.110 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=98)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=98)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.011..0.012 rows=1 loops=98)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.008..0.009 rows=1 loops=98)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.005 rows=1 loops=98)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=92)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=92)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.003..0.003 rows=1 loops=92)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=92)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 12.059 ms
(61 rows)

-- Test Case 2 - 3913743 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where spcode = '37018030'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3980.49..9691.20 rows=100 width=279) (actual time=1979.844..1983.511 rows=100 loops=1)
   ->  Hash Join  (cost=3980.49..4274849.11 rows=74787 width=279) (actual time=1979.842..1983.479 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=2213.87..4214207.64 rows=14952088 width=239) (actual time=48.330..1895.608 rows=389827 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=2202.98..4007705.43 rows=15192121 width=233) (actual time=48.135..1693.330 rows=389827 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=24.940..1339.109 rows=692857 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=24.881..1028.219 rows=692857 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=23.957..722.895 rows=692857 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.022..141.359 rows=692857 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=23.904..23.904 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=7.488..19.885 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=7.457..17.464 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.625..9.282 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..1.083 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.600..2.600 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.209..1.557 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.352 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.187..0.187 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.077..0.133 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.014 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.045..0.045 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.004..0.020 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=4.805..4.805 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.004..2.527 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.014..0.014 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.007 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.905..0.905 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.004..0.481 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.040..0.040 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.003..0.017 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=23.112..23.112 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=13.061..21.327 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=10.998..16.968 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.870..11.696 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.005..0.930 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.835..7.835 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.575..6.635 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.004..0.603 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.543..3.543 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.590 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=3.104..3.104 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.005..1.851 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=2.036..2.036 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.008..0.938 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.146..0.146 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.092 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=26.637..26.637 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=23.202..26.626 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 1984.262 ms
(80 rows)

-- Test Case 3 - 17098775 rows limited to first 100
explain analyze select * from detection_extract_test_view
where timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                         QUERY PLAN                                                                                                         
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3.39..571.82 rows=100 width=279) (actual time=0.824..8.080 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=3.39..31977844.24 rows=5625584 width=279) (actual time=0.822..8.049 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=3.10..21831467.95 rows=5625584 width=239) (actual time=0.771..6.978 rows=100 loops=1)
               ->  Nested Loop  (cost=1.69..12376246.08 rows=5287633 width=193) (actual time=0.727..5.052 rows=100 loops=1)
                     ->  Nested Loop  (cost=1.55..11308727.81 rows=5372518 width=187) (actual time=0.723..4.791 rows=100 loops=1)
                           ->  Nested Loop  (cost=1.41..8537379.53 rows=16144362 width=168) (actual time=0.718..4.516 rows=100 loops=1)
                                 ->  Merge Join  (cost=1.13..3572860.21 rows=16144362 width=168) (actual time=0.703..4.088 rows=100 loops=1)
                                       Merge Cond: (receiver_deployment.id = valid_detection.receiver_deployment_id)
                                       ->  Nested Loop  (cost=0.56..188303.48 rows=5710 width=132) (actual time=0.686..1.749 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..186931.88 rows=5710 width=135) (actual time=0.681..1.730 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..184575.50 rows=5710 width=120) (actual time=0.673..1.714 rows=2 loops=1)
                                                         Join Filter: (installation.project_id = receiver_project.id)
                                                         Rows Removed by Join Filter: 86
                                                         ->  Nested Loop  (cost=0.28..178149.81 rows=5710 width=89) (actual time=0.662..1.661 rows=2 loops=1)
                                                               Join Filter: (installation_station.installation_id = installation.id)
                                                               Rows Removed by Join Filter: 112
                                                               ->  Nested Loop  (cost=0.28..168724.94 rows=5710 width=73) (actual time=0.654..1.570 rows=2 loops=1)
                                                                     Join Filter: (receiver_deployment.station_id = installation_station.id)
                                                                     Rows Removed by Join Filter: 2873
                                                                     ->  Index Scan using receiver_deployment_pkey on receiver_deployment  (cost=0.28..457.79 rows=5710 width=24) (actual time=0.009..0.010 rows=2 loops=1)
                                                                     ->  Materialize  (cost=0.00..55.46 rows=1964 width=57) (actual time=0.005..0.577 rows=1438 loops=2)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.005..0.494 rows=1964 loops=1)
                                                               ->  Materialize  (cost=0.00..3.65 rows=110 width=32) (actual time=0.002..0.038 rows=57 loops=2)
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.032 rows=110 loops=1)
                                                         ->  Materialize  (cost=0.00..2.12 rows=75 width=39) (actual time=0.001..0.018 rows=44 loops=2)
                                                               ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.016 rows=75 loops=1)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.006 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..3183595.42 rows=16144362 width=52) (actual time=0.014..2.275 rows=100 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 2460
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=100)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.018 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.009..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=99)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=99)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 8.482 ms
(59 rows)

-- Test Case 4 -  2716283 ^ 3913743 -> 1420919 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=45.426..46.747 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=45.424..46.722 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.365..23.542 rows=210 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.197..23.266 rows=210 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.957..1.814 rows=219 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.916..1.685 rows=219 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.109..0.748 rows=219 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.097..0.180 rows=5 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 61
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.090..0.139 rows=5 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.084..0.098 rows=5 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.074..0.074 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.020 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.006 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.025 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.017 rows=5 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=5)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.005 rows=13 loops=5)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.014..0.083 rows=44 loops=5)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.788..0.788 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.442 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.017 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.224..21.224 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.267..19.446 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.567..15.627 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.096..10.679 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.757 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.077..7.077 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.098..6.005 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.543 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.081..3.081 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.572 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.462..2.462 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.526 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.681..1.681 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.794 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.148..0.148 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.090 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.473..22.473 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.601..22.464 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 47.047 ms
(74 rows)

-- Test Case 5 - 2716283 ^ 17098775 -> 902906 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=2.413..5.690 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=2.411..5.654 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=2.352..4.607 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=2.307..2.649 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=2.158..2.426 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=2.114..2.320 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=1.350..1.484 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.062..0.099 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.059..0.086 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..0.052 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.035..0.035 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.006 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.011 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.012 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.007..0.007 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.311..0.333 rows=25 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.100..0.100 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.749..0.749 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.001..0.420 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.134..0.134 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.093 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 6.015 ms
(62 rows)

-- Test Case 6 - 3913743 ^ 17098775 -> 2233756 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..121817.73 rows=100 width=279) (actual time=82.889..1207.055 rows=100 loops=1)
   ->  Nested Loop  (cost=930.07..27691456.56 rows=22906 width=279) (actual time=82.887..1207.024 rows=100 loops=1)
         ->  Nested Loop  (cost=929.78..19534084.41 rows=4579576 width=239) (actual time=81.700..1083.591 rows=35420 loops=1)
               ->  Nested Loop  (cost=929.50..17890110.09 rows=4579576 width=239) (actual time=81.687..969.919 rows=35420 loops=1)
                     ->  Nested Loop  (cost=929.22..15863411.32 rows=4579576 width=215) (actual time=81.674..853.838 rows=35420 loops=1)
                           ->  Nested Loop  (cost=928.94..14328742.07 rows=4579576 width=231) (actual time=81.659..753.166 rows=35420 loops=1)
                                 ->  Nested Loop  (cost=928.79..13404173.01 rows=4653095 width=225) (actual time=81.649..655.132 rows=35420 loops=1)
                                       ->  Nested Loop  (cost=928.51..11309131.09 rows=5715895 width=209) (actual time=81.628..534.855 rows=35420 loops=1)
                                             ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=81.606..383.505 rows=35884 loops=1)
                                                   ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=81.596..288.588 rows=35884 loops=1)
                                                         ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=81.550..159.766 rows=35884 loops=1)
                                                               Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                               ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=59.532..103.801 rows=35884 loops=1)
                                                                     Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                                                     Rows Removed by Filter: 290836
                                                               ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.984..21.984 rows=5710 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                                                     ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.214..18.093 rows=5710 loops=1)
                                                                           Hash Cond: (receiver.model_id = device_model.id)
                                                                           ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.184..15.515 rows=5710 loops=1)
                                                                                 Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                                 ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.264..8.344 rows=5710 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..0.927 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.240..2.240 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                                             ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.165..1.491 rows=1964 loops=1)
                                                                                                   Hash Cond: (installation_station.installation_id = installation.id)
                                                                                                   ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.290 rows=1964 loops=1)
                                                                                                   ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.152..0.152 rows=110 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                                         ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.056..0.112 rows=110 loops=1)
                                                                                                               Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.013 rows=110 loops=1)
                                                                                                               ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.042..0.042 rows=75 loops=1)
                                                                                                                     Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.004..0.018 rows=75 loops=1)
                                                                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.910..3.910 rows=7227 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                       ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.014..2.043 rows=7227 loops=1)
                                                                           ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.019..0.019 rows=16 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.006..0.010 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=35884)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=35884)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=35884)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=35420)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=35420)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=35420)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=35420)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=35420)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=35420)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
               Rows Removed by Filter: 1
 Total runtime: 1207.391 ms
(65 rows)

-- Test Case 7 - 2716283 ^ 3913743 ^ 17098775 -> 690003 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=45.812..46.718 rows=100 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=45.811..46.692 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=23.214..23.579 rows=102 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.902..2.196 rows=102 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.757..1.994 rows=102 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.716..1.913 rows=102 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.945..1.048 rows=102 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.075..0.107 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.071..0.094 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.064..0.072 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.047..0.047 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.023..0.023 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.009 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.016..0.020 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.207..0.225 rows=26 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.090..0.090 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.762..0.762 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.440 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.085 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.290..21.290 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.293..19.489 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.605..15.544 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.100..10.739 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.754 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.078..7.078 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.034..5.915 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.553 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.017..3.017 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.447 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.496..2.496 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.526 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.678..1.678 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.826 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.459..22.459 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.559..22.449 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 47.029 ms
(75 rows)

 
-- High selectivity filtering (small number of rows returned for each filter)
-- Test Case 8 - 5909 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=1.500..4.848 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=1.499..4.819 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.444..3.760 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.395..1.757 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.246..1.551 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.200..1.449 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.387..0.563 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.334..0.368 rows=3 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 31
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.327..0.344 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.320..0.327 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.294..0.294 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 872
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.006..0.006 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.001..0.113 rows=873 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.024..0.029 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.006 rows=11 loops=3)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.018..0.043 rows=33 loops=3)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.800..0.800 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.418 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.085 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.131 ms
(61 rows)

-- Test Case 9 - 2153 rows
set geqo_threshold to 12;
SET
explain analyze select * from species_detection_extract_test_view
where spcode = '37018003'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3980.49..9691.20 rows=100 width=279) (actual time=10501.692..10505.051 rows=100 loops=1)
   ->  Hash Join  (cost=3980.49..4274849.11 rows=74787 width=279) (actual time=10501.690..10505.019 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=2213.87..4214207.64 rows=14952088 width=239) (actual time=45.285..10310.992 rows=1073051 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=2202.98..4007705.43 rows=15192121 width=233) (actual time=45.116..9742.592 rows=1073051 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=22.928..8198.441 rows=4275822 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=22.878..6288.772 rows=4275822 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=22.060..4388.676 rows=4275822 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.004..859.819 rows=4275822 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=22.037..22.037 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.262..18.077 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.243..15.661 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.256..8.365 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..0.947 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.244..2.244 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.169..1.398 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.257 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.156..0.156 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.058..0.121 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.020 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.040..0.040 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.021 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.973..3.973 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.004..2.041 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.011..0.011 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.006 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.804..0.804 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.004..0.499 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.038..0.038 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.003..0.020 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=22.151..22.151 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=12.377..20.375 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=10.379..16.180 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.660..11.213 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.739 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.629..7.629 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.574..6.430 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.522 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.548..3.548 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.618 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.701..2.701 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.523 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.978..1.978 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.006..0.852 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.133..0.133 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.085 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.675..22.675 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.761..22.665 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 10505.351 ms
(80 rows)

-- Test Case 10 - 1065 rows
explain analyze select * from detection_extract_test_view
  where timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=398.97..1704.98 rows=100 width=279) (actual time=6.204..10.929 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=398.97..6772.29 rows=488 width=279) (actual time=6.203..10.899 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=398.68..5892.13 rows=488 width=239) (actual time=6.141..9.808 rows=100 loops=1)
               ->  Nested Loop  (cost=397.27..4950.72 rows=459 width=193) (actual time=6.085..7.815 rows=100 loops=1)
                     ->  Nested Loop  (cost=397.13..4858.12 rows=466 width=187) (actual time=6.078..7.545 rows=100 loops=1)
                           ->  Nested Loop  (cost=396.99..4617.80 rows=1400 width=168) (actual time=6.072..7.277 rows=100 loops=1)
                                 ->  Nested Loop  (cost=396.85..4384.47 rows=1400 width=171) (actual time=6.065..7.015 rows=100 loops=1)
                                       ->  Hash Join  (cost=396.57..3806.73 rows=1400 width=156) (actual time=6.049..6.550 rows=100 loops=1)
                                             Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                             ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.280..5.702 rows=100 loops=1)
                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                   ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.232..5.595 rows=100 loops=1)
                                                         Hash Cond: (installation_station.installation_id = installation.id)
                                                         ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.139..5.449 rows=100 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.029..4.265 rows=100 loops=1)
                                                                     Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                     ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.039..0.162 rows=100 loops=1)
                                                                           Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                     ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=3.974..3.974 rows=5710 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                           ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..2.551 rows=5710 loops=1)
                                                               ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.098..1.098 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                     ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.517 rows=1964 loops=1)
                                                         ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.085..0.085 rows=110 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.028 rows=110 loops=1)
                                                   ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.016 rows=75 loops=1)
                                             ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.757..0.757 rows=1519 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                   ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.006..0.418 rows=1519 loops=1)
                                       ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=100)
                                             Index Cond: (id = receiver_deployment.receiver_id)
                                 ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=100)
                                       Index Cond: (id = receiver.model_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..2.04 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.68 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..1.24 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.90 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 11.243 ms
(60 rows)

-- Test Case 11 - 5909 ^ 2153 -> 609 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=47.546..50.557 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=47.544..50.525 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.509..27.154 rows=1216 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.348..26.365 rows=1216 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.185..4.235 rows=1435 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.144..3.610 rows=1435 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.357..2.116 rows=1435 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.319..0.526 rows=13 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 181
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.311..0.450 rows=13 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.304..0.356 rows=13 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.293..0.305 rows=4 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.004 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.001..0.126 rows=898 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.010 rows=3 loops=4)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=13)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.003 rows=15 loops=13)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.004 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.012..0.075 rows=110 loops=13)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.778..0.778 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.411 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.016 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.147..21.147 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.218..19.296 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.513..15.437 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.023..10.677 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.757 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.003..7.003 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.168..6.008 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.537 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.152..3.152 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.594 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.481..2.481 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.526 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.695..1.695 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.809 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.143..0.143 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.095 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.507..22.507 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.607..22.499 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 50.917 ms
(74 rows)

-- Test Case 12 - 5909 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.517..3.868 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.516..3.857 rows=55 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3373.72 rows=6 width=239) (actual time=0.468..3.261 rows=55 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3371.58 rows=6 width=239) (actual time=0.461..3.069 rows=55 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3368.94 rows=6 width=215) (actual time=0.455..2.877 rows=55 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3366.85 rows=6 width=215) (actual time=0.448..2.686 rows=55 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3364.85 rows=6 width=215) (actual time=0.441..2.518 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.78..3361.41 rows=6 width=193) (actual time=0.431..2.253 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.427..2.097 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.424..1.947 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.418..1.761 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.411..1.481 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.403..1.227 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.024..0.731 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.248..0.248 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.057..0.209 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.050..0.087 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.065 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.017 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.006..0.013 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.005 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=55)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=55)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=55)
               Index Cond: (animal.species_id = id)
 Total runtime: 4.185 ms
(58 rows)

-- Test Case 13 -  2153 ^ 1065 -> 55 rows
explain analyze select * from species_detection_extract_test_view
where spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                            QUERY PLAN                                                                                                                             
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4360.58..5638.33 rows=2 width=279) (actual time=22.785..38.500 rows=55 loops=1)
   ->  Nested Loop  (cost=4360.58..5638.33 rows=2 width=279) (actual time=22.783..38.490 rows=55 loops=1)
         ->  Nested Loop  (cost=4360.29..4931.17 rows=397 width=239) (actual time=21.959..34.472 rows=1065 loops=1)
               ->  Nested Loop  (cost=4360.01..4788.65 rows=397 width=239) (actual time=21.948..31.019 rows=1065 loops=1)
                     ->  Nested Loop  (cost=4359.73..4612.96 rows=397 width=215) (actual time=21.937..27.508 rows=1065 loops=1)
                           ->  Hash Join  (cost=4359.45..4479.92 rows=397 width=231) (actual time=21.916..24.357 rows=1065 loops=1)
                                 Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                 ->  Hash Join  (cost=4348.55..4463.53 rows=404 width=225) (actual time=21.764..23.606 rows=1065 loops=1)
                                       Hash Cond: (surgery.tag_id = sensor.tag_id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.520 rows=3923 loops=1)
                                       ->  Hash  (cost=4342.35..4342.35 rows=496 width=209) (actual time=21.605..21.605 rows=1065 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 319kB
                                             ->  Hash Join  (cost=856.09..4342.35 rows=496 width=209) (actual time=13.366..20.210 rows=1065 loops=1)
                                                   Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                                   ->  Hash Join  (cost=675.68..4144.75 rows=466 width=187) (actual time=10.654..16.624 rows=1065 loops=1)
                                                         Hash Cond: (receiver.organisation_id = organisation.id)
                                                         ->  Hash Join  (cost=673.54..4132.70 rows=1400 width=168) (actual time=10.607..16.005 rows=1065 loops=1)
                                                               Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                               ->  Hash Join  (cost=614.36..4054.27 rows=1400 width=168) (actual time=9.791..14.608 rows=1065 loops=1)
                                                                     Hash Cond: (receiver.model_id = device_model.id)
                                                                     ->  Hash Join  (cost=613.00..4033.66 rows=1400 width=171) (actual time=9.769..14.010 rows=1065 loops=1)
                                                                           Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                           ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.766..9.274 rows=1065 loops=1)
                                                                                 Hash Cond: (installation.project_id = receiver_project.id)
                                                                                 ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.712..8.661 rows=1065 loops=1)
                                                                                       Hash Cond: (installation_station.installation_id = installation.id)
                                                                                       ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.643..8.066 rows=1065 loops=1)
                                                                                             Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                             ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.405..6.153 rows=1065 loops=1)
                                                                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.032..0.842 rows=1065 loops=1)
                                                                                                         Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                                                   ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.341..4.341 rows=5710 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                         ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.588 rows=5710 loops=1)
                                                                                             ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.221..1.221 rows=1964 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                                   ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.004..0.480 rows=1964 loops=1)
                                                                                       ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.057..0.057 rows=110 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                             ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.026 rows=110 loops=1)
                                                                                 ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.040..0.040 rows=75 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                       ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.018 rows=75 loops=1)
                                                                           ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.991..3.991 rows=7227 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                 ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.113 rows=7227 loops=1)
                                                                     ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.010..0.010 rows=16 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                           ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.004 rows=16 loops=1)
                                                               ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.805..0.805 rows=1519 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                                     ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.020..0.477 rows=1519 loops=1)
                                                         ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                               ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.021 rows=51 loops=1)
                                                   ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.696..2.696 rows=5307 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                                         ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..1.407 rows=5307 loops=1)
                                 ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                       ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.091 rows=173 loops=1)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=1065)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=1065)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=1065)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=1065)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
               Rows Removed by Filter: 1
 Total runtime: 38.831 ms
(74 rows)

-- Test Case 14 -  5909 ^ 2153 ^ 1065 -> 55 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3381.48 rows=1 width=279) (actual time=0.508..3.845 rows=55 loops=1)
   ->  Nested Loop  (cost=29.47..3381.48 rows=1 width=279) (actual time=0.507..3.829 rows=55 loops=1)
         ->  Nested Loop  (cost=29.18..3372.55 rows=5 width=239) (actual time=0.457..3.215 rows=55 loops=1)
               ->  Nested Loop  (cost=28.90..3370.75 rows=5 width=239) (actual time=0.451..3.024 rows=55 loops=1)
                     ->  Nested Loop  (cost=28.62..3368.54 rows=5 width=215) (actual time=0.444..2.836 rows=55 loops=1)
                           ->  Nested Loop  (cost=28.34..3366.87 rows=5 width=231) (actual time=0.436..2.666 rows=55 loops=1)
                                 ->  Nested Loop  (cost=28.19..3365.87 rows=5 width=225) (actual time=0.432..2.513 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.91..3363.67 rows=6 width=209) (actual time=0.426..2.321 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.417..2.060 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.413..1.908 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.407..1.721 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.400..1.428 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.393..1.178 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.025..0.674 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.249..0.249 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.058..0.208 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.051..0.086 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.065 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.019 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.016 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.57 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=55)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=55)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
 Total runtime: 4.158 ms
(59 rows)

-- Mixed selectivity filtering
-- Test Case 15 - 5909 ^ 833188 -> 184 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=45.487..53.257 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=45.485..53.229 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.710..29.678 rows=2018 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.552..28.523 rows=2018 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.219..5.632 rows=2248 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.180..4.654 rows=2248 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.357..2.629 rows=2248 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.319..0.601 rows=19 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 271
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.312..0.495 rows=19 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.306..0.373 rows=19 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.294..0.308 rows=5 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.006 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.120 rows=899 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.010 rows=4 loops=5)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=19)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=15 loops=19)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.009..0.058 rows=118 loops=19)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.813..0.813 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.462 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.317..21.317 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.359..19.566 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.686..15.685 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.170..10.775 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.743 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.151..7.151 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.146..6.068 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.556 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.130..3.130 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.612 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.506..2.506 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.564 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.664..1.664 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.776 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.142..0.142 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.098 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.594..22.594 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=20.327..22.586 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 53.550 ms
(74 rows)

-- Test Case 16 - 5909 ^ 17098775 -> 3889 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=1.460..4.768 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=1.459..4.734 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=1.416..3.690 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.388..1.707 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.243..1.498 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.202..1.405 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.428..0.556 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.051..0.083 rows=3 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.047..0.073 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.046 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.034 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.010 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.009 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.008..0.008 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=3)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.113..0.140 rows=33 loops=3)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 148
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.041..0.041 rows=210 loops=3)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.766..0.766 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.453 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.134..0.134 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.085 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.063 ms
(62 rows)

-- Test Case 17 - 2716283 ^ 464 -> 448 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=112.775..689.640 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=112.773..689.618 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.332..636.075 rows=178524 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.176..544.851 rows=178524 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.938..398.700 rows=178553 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.899..321.522 rows=178553 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.110..230.419 rows=178553 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.097..1.135 rows=44 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 646
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.090..0.872 rows=44 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.085..0.518 rows=44 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.075..0.332 rows=7 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 941
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.134 rows=948 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.019 rows=6 loops=7)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=44)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=44)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.015..3.218 rows=4058 loops=44)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.779..0.779 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.423 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.015 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.222..21.222 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.307..19.450 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.640..15.595 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.159..10.828 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.789 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.138..7.138 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.153..6.063 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.533 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.137..3.137 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.567 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.471..2.471 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.534 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.658..1.658 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.817 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.140..0.140 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.096 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.544..22.544 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=6.553..22.537 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 689.940 ms
(74 rows)

-- Test Case 18 - 2716283 ^ 2005 -> 4 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2013-06-08 00:00:00+00' and '2013-06-08 01:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3896.81 rows=7 width=279) (actual time=1.985..2.557 rows=4 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3896.81 rows=7 width=279) (actual time=1.983..2.554 rows=4 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3884.18 rows=7 width=239) (actual time=1.935..2.474 rows=4 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3881.69 rows=7 width=239) (actual time=1.929..2.458 rows=4 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3878.61 rows=7 width=215) (actual time=1.922..2.440 rows=4 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3876.17 rows=7 width=215) (actual time=1.915..2.422 rows=4 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3873.84 rows=7 width=215) (actual time=1.908..2.405 rows=4 loops=1)
                                       ->  Nested Loop  (cost=27.78..3870.07 rows=7 width=193) (actual time=1.898..2.379 rows=4 loops=1)
                                             ->  Nested Loop  (cost=27.63..3868.68 rows=7 width=187) (actual time=1.893..2.366 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3864.90 rows=22 width=168) (actual time=1.888..2.352 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3856.39 rows=22 width=168) (actual time=1.881..2.333 rows=4 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 60
                                                               ->  Nested Loop  (cost=27.21..3849.91 rows=22 width=171) (actual time=1.873..2.300 rows=4 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3840.83 rows=22 width=156) (actual time=1.867..2.279 rows=4 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3808.21 rows=1613 width=52) (actual time=0.047..1.240 rows=1839 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-06-08 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-06-08 01:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.695..0.695 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.562 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.116 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.067 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.016 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.034 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=4)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=4)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.38 rows=1 width=16) (actual time=0.004..0.004 rows=1 loops=4)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=4)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.53 rows=1 width=22) (actual time=0.005..0.005 rows=1 loops=4)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=4)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=4)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.003..0.004 rows=1 loops=4)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=4)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=4)
               Index Cond: (animal.species_id = id)
 Total runtime: 2.892 ms
(58 rows)

-- Test Case 19 - 464 ^ 17098775 -> 6 rows
explain analyze select * from species_detection_extract_test_view
where spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..121817.73 rows=100 width=279) (actual time=252896.830..386897.255 rows=6 loops=1)
   ->  Nested Loop  (cost=930.07..27691456.56 rows=22906 width=279) (actual time=252896.828..386897.249 rows=6 loops=1)
         ->  Nested Loop  (cost=929.78..19534084.41 rows=4579576 width=239) (actual time=22.162..353404.227 rows=9696014 loops=1)
               ->  Nested Loop  (cost=929.50..17890110.09 rows=4579576 width=239) (actual time=22.151..322248.348 rows=9696014 loops=1)
                     ->  Nested Loop  (cost=929.22..15863411.32 rows=4579576 width=215) (actual time=22.141..290123.667 rows=9696014 loops=1)
                           ->  Nested Loop  (cost=928.94..14328742.07 rows=4579576 width=231) (actual time=22.129..262157.681 rows=9696014 loops=1)
                                 ->  Nested Loop  (cost=928.79..13404173.01 rows=4653095 width=225) (actual time=22.121..235368.099 rows=9696014 loops=1)
                                       ->  Nested Loop  (cost=928.51..11309131.09 rows=5715895 width=209) (actual time=22.111..198410.325 rows=11828011 loops=1)
                                             ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=22.096..134854.057 rows=16316319 loops=1)
                                                   ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=22.088..92701.878 rows=16316319 loops=1)
                                                         ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=22.044..36711.134 rows=16316319 loops=1)
                                                               Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                               ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.032..21904.449 rows=16316319 loops=1)
                                                                     Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                                                     Rows Removed by Filter: 36799631
                                                               ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.992..21.992 rows=5710 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                                                     ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.204..18.011 rows=5710 loops=1)
                                                                           Hash Cond: (receiver.model_id = device_model.id)
                                                                           ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.182..15.498 rows=5710 loops=1)
                                                                                 Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                                 ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.250..8.305 rows=5710 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..0.863 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.239..2.239 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                                             ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.152..1.441 rows=1964 loops=1)
                                                                                                   Hash Cond: (installation_station.installation_id = installation.id)
                                                                                                   ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.290 rows=1964 loops=1)
                                                                                                   ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.143..0.143 rows=110 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                                         ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.048..0.110 rows=110 loops=1)
                                                                                                               Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.020 rows=110 loops=1)
                                                                                                               ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                                                     Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.018 rows=75 loops=1)
                                                                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.923..3.923 rows=7227 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                       ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.193 rows=7227 loops=1)
                                                                           ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.013..0.013 rows=16 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=16316319)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=16316319)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=16316319)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=11828011)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=9696014)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=9696014)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=9696014)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=9696014)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=9696014)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
               Rows Removed by Filter: 1
 Total runtime: 386897.581 ms
(65 rows)

-- Test Case 20 - 833188 ^ 5489 -> 210 rows
explain analyze select * from species_detection_extract_test_view
where spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                         QUERY PLAN                                                                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3100.88..14963.67 rows=6 width=279) (actual time=43.287..83.222 rows=100 loops=1)
   ->  Hash Join  (cost=3100.88..14963.67 rows=6 width=279) (actual time=43.286..83.194 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Nested Loop  (cost=1334.25..13191.97 rows=1292 width=239) (actual time=20.247..59.084 rows=2940 loops=1)
               ->  Hash Join  (cost=1333.97..12759.01 rows=1292 width=255) (actual time=20.224..49.840 rows=2940 loops=1)
                     Hash Cond: (animal_release.animal_id = animal.id)
                     ->  Hash Join  (cost=1213.45..12615.88 rows=1292 width=255) (actual time=18.490..46.093 rows=2940 loops=1)
                           Hash Cond: (surgery.release_id = animal_release.id)
                           ->  Hash Join  (cost=1012.25..12392.07 rows=1292 width=231) (actual time=16.025..41.390 rows=2940 loops=1)
                                 Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                 ->  Hash Join  (cost=1001.36..12363.35 rows=1312 width=225) (actual time=15.880..39.550 rows=2940 loops=1)
                                       Hash Cond: (sensor.tag_id = surgery.tag_id)
                                       ->  Hash Join  (cost=856.09..12170.71 rows=1612 width=209) (actual time=14.067..35.522 rows=2832 loops=1)
                                             Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                             ->  Hash Join  (cost=675.68..11934.41 rows=1515 width=187) (actual time=11.201..30.113 rows=3143 loops=1)
                                                   Hash Cond: (receiver.organisation_id = organisation.id)
                                                   ->  Hash Join  (cost=673.54..11900.04 rows=4554 width=168) (actual time=11.149..28.319 rows=3143 loops=1)
                                                         Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                         ->  Hash Join  (cost=614.36..11778.24 rows=4554 width=168) (actual time=10.307..25.602 rows=3143 loops=1)
                                                               Hash Cond: (receiver.model_id = device_model.id)
                                                               ->  Hash Join  (cost=613.00..11714.26 rows=4554 width=171) (actual time=10.281..23.801 rows=3143 loops=1)
                                                                     Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                     ->  Hash Join  (cost=337.39..11341.88 rows=4554 width=156) (actual time=5.889..17.062 rows=3143 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Hash Join  (cost=334.70..11276.58 rows=4554 width=125) (actual time=5.817..15.212 rows=3143 loops=1)
                                                                                 Hash Cond: (installation_station.installation_id = installation.id)
                                                                                 ->  Hash Join  (cost=330.23..11209.49 rows=4554 width=109) (actual time=5.726..13.552 rows=3143 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Hash Join  (cost=260.04..11070.99 rows=4554 width=60) (actual time=4.427..10.174 rows=3143 loops=1)
                                                                                             Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                             ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.052..2.843 rows=3143 loops=1)
                                                                                                   Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                                                             ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.348..4.348 rows=5710 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                   ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.589 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.281..1.281 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                             ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.004..0.500 rows=1964 loops=1)
                                                                                 ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.071..0.071 rows=110 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.022 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.049..0.049 rows=75 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.004..0.021 rows=75 loops=1)
                                                                     ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=4.371..4.371 rows=7227 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                           ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.235 rows=7227 loops=1)
                                                               ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.011..0.011 rows=16 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.006 rows=16 loops=1)
                                                         ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.830..0.830 rows=1519 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                               ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.004..0.423 rows=1519 loops=1)
                                                   ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.037..0.037 rows=51 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                         ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.004..0.024 rows=51 loops=1)
                                             ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.833..2.833 rows=5307 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                                   ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..1.397 rows=5307 loops=1)
                                       ->  Hash  (cost=96.23..96.23 rows=3923 width=16) (actual time=1.799..1.799 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 184kB
                                             ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.904 rows=3923 loops=1)
                                 ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.131..0.131 rows=173 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                       ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.002..0.086 rows=173 loops=1)
                           ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.451..2.451 rows=3920 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                 ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.506 rows=3920 loops=1)
                     ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.717..1.717 rows=4023 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 189kB
                           ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.006..0.819 rows=4023 loops=1)
               ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=2940)
                     Index Cond: (id = sensor.tag_id)
                     Heap Fetches: 0
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.652..22.652 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=20.369..22.631 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 83.544 ms
(80 rows)

-- Test Case 21 - 5909 ^ 2153 ^ 17098775 -> 284 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=45.063..54.475 rows=100 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=45.061..54.448 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=22.497..30.961 rows=2234 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.363..8.243 rows=2324 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.219..7.033 rows=2324 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.164..5.951 rows=2324 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.377..4.012 rows=2324 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.052..0.541 rows=47 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..0.405 rows=47 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..0.176 rows=47 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.035..0.050 rows=11 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.006 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.017 rows=11 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.004..0.008 rows=4 loops=11)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.004 rows=1 loops=47)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=47)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.030..0.057 rows=49 loops=47)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 31
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.015..0.015 rows=85 loops=47)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.778..0.778 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.463 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.134..0.134 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.095 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.099..21.099 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.254..19.294 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.561..15.376 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.055..10.606 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.763 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.036..7.036 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.050..5.983 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.535 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.033..3.033 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.523 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.492..2.492 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.528 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.681..1.681 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.786 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.448..22.448 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.549..22.440 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 54.777 ms
(75 rows)

-- Test Case 22 - 5909 ^ 833188 ^ 5489 -> 13 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..10905.01 rows=1 width=279) (actual time=0.823..4.866 rows=13 loops=1)
   ->  Nested Loop  (cost=29.47..10905.01 rows=1 width=279) (actual time=0.821..4.861 rows=13 loops=1)
         ->  Nested Loop  (cost=29.18..10874.70 rows=17 width=239) (actual time=0.772..4.680 rows=13 loops=1)
               ->  Nested Loop  (cost=28.90..10868.60 rows=17 width=239) (actual time=0.766..4.633 rows=13 loops=1)
                     ->  Nested Loop  (cost=28.62..10861.08 rows=17 width=215) (actual time=0.759..4.586 rows=13 loops=1)
                           ->  Nested Loop  (cost=28.34..10855.38 rows=17 width=231) (actual time=0.752..4.537 rows=13 loops=1)
                                 ->  Nested Loop  (cost=28.19..10852.00 rows=17 width=225) (actual time=0.748..4.506 rows=13 loops=1)
                                       ->  Nested Loop  (cost=27.91..10844.31 rows=21 width=209) (actual time=0.740..4.451 rows=13 loops=1)
                                             ->  Nested Loop  (cost=27.63..10836.44 rows=20 width=187) (actual time=0.730..4.387 rows=13 loops=1)
                                                   ->  Nested Loop  (cost=27.49..10825.97 rows=61 width=168) (actual time=0.727..4.350 rows=13 loops=1)
                                                         ->  Nested Loop  (cost=27.21..10805.50 rows=61 width=168) (actual time=0.720..4.300 rows=13 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 195
                                                               ->  Nested Loop  (cost=27.21..10789.66 rows=61 width=171) (actual time=0.714..4.223 rows=13 loops=1)
                                                                     ->  Hash Join  (cost=26.93..10764.48 rows=61 width=156) (actual time=0.706..4.160 rows=13 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.034..3.043 rows=5041 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.248..0.248 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.059..0.210 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.087 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.066 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.016 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.017 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=13)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.003 rows=16 loops=13)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.33 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=13)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.38 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=13)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=13)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=13)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=13)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=13)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=13)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
 Total runtime: 5.178 ms
(59 rows)

-- Test Case 23 - 5909 ^ 833188 ^ 17098775 -> 54 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=46.912..59.486 rows=54 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=46.911..59.472 rows=54 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=22.530..36.016 rows=3558 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.322..12.261 rows=3854 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.177..10.323 rows=3854 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.135..8.608 rows=3854 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.373..5.976 rows=3854 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.050..0.748 rows=64 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.046..0.565 rows=64 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.041..0.249 rows=64 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.033..0.095 rows=15 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.061 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.006..0.018 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.021 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.021 rows=15 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=4 loops=15)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=64)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=64)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.030..0.062 rows=60 loops=64)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 32
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.015..0.015 rows=92 loops=64)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.754..0.754 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.424 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.087 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.175..21.175 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.244..19.362 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.559..15.439 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.054..10.668 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.710 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.034..7.034 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.031..5.952 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.541 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.016..3.016 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.564 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.492..2.492 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.484 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.672..1.672 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.809 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.445..22.445 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=20.190..22.437 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 59.783 ms
(75 rows)

-- Test Case 24 - 2716283 ^ 464 ^ 3129 -> 2 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5329.65 rows=1 width=279) (actual time=1.426..5.851 rows=2 loops=1)
   ->  Nested Loop  (cost=29.47..5329.65 rows=1 width=279) (actual time=1.424..5.848 rows=2 loops=1)
         ->  Nested Loop  (cost=29.18..5313.59 rows=9 width=239) (actual time=0.830..5.523 rows=70 loops=1)
               ->  Nested Loop  (cost=28.90..5310.36 rows=9 width=239) (actual time=0.824..5.282 rows=70 loops=1)
                     ->  Nested Loop  (cost=28.62..5306.38 rows=9 width=215) (actual time=0.817..5.036 rows=70 loops=1)
                           ->  Nested Loop  (cost=28.34..5303.36 rows=9 width=231) (actual time=0.809..4.822 rows=70 loops=1)
                                 ->  Nested Loop  (cost=28.19..5301.57 rows=9 width=225) (actual time=0.805..4.629 rows=70 loops=1)
                                       ->  Nested Loop  (cost=27.91..5297.54 rows=11 width=209) (actual time=0.798..4.381 rows=70 loops=1)
                                             ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.789..4.049 rows=69 loops=1)
                                                   ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.785..3.856 rows=69 loops=1)
                                                         ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.777..3.617 rows=69 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 1035
                                                               ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.770..3.269 rows=69 loops=1)
                                                                     ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.764..3.005 rows=69 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.050..1.727 rows=2743 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.695..0.695 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.059..0.550 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.120 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.067 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.016 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.030 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.002..0.003 rows=1 loops=69)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.004 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=69)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=70)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=70)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
               Rows Removed by Filter: 1
 Total runtime: 6.163 ms
(60 rows)

-- Test Case 25 - 2716283 ^ 464 ^ 17098775 -> 4 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=1363.642..4478.399 rows=4 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=1363.640..4478.393 rows=4 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=23.042..4306.075 rows=896073 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.883..3673.622 rows=902521 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.739..3282.333 rows=902521 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.698..2886.286 rows=902521 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.909..2446.074 rows=902521 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.054..5.845 rows=282 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.050..4.348 rows=282 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..1.601 rows=282 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.036..0.238 rows=45 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.064 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.021 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.019 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.098 rows=45 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.021 rows=6 loops=45)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.007 rows=1 loops=282)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.004 rows=1 loops=282)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=5.036..7.592 rows=3200 loops=282)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 6410
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=1.248..1.248 rows=9611 loops=282)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.780..0.780 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.428 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.134..0.134 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.091 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.138..21.138 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.209..19.355 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.534..15.421 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.049..10.802 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.806 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.030..7.030 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.022..5.862 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.513 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.007..3.007 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.510 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.475..2.475 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.530 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.665..1.665 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.802 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.450..22.450 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=6.542..22.443 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 4478.686 ms
(75 rows)

-- Test Case 26 - 2716283 ^ 3913743 ^ 3129 -> 52 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5329.65 rows=1 width=279) (actual time=0.869..6.293 rows=52 loops=1)
   ->  Nested Loop  (cost=29.47..5329.65 rows=1 width=279) (actual time=0.868..6.275 rows=52 loops=1)
         ->  Nested Loop  (cost=29.18..5313.59 rows=9 width=239) (actual time=0.817..5.618 rows=70 loops=1)
               ->  Nested Loop  (cost=28.90..5310.36 rows=9 width=239) (actual time=0.811..5.372 rows=70 loops=1)
                     ->  Nested Loop  (cost=28.62..5306.38 rows=9 width=215) (actual time=0.805..5.122 rows=70 loops=1)
                           ->  Nested Loop  (cost=28.34..5303.36 rows=9 width=231) (actual time=0.798..4.908 rows=70 loops=1)
                                 ->  Nested Loop  (cost=28.19..5301.57 rows=9 width=225) (actual time=0.793..4.707 rows=70 loops=1)
                                       ->  Nested Loop  (cost=27.91..5297.54 rows=11 width=209) (actual time=0.786..4.447 rows=70 loops=1)
                                             ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.777..4.111 rows=69 loops=1)
                                                   ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.773..3.926 rows=69 loops=1)
                                                         ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.764..3.670 rows=69 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 1035
                                                               ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.757..3.311 rows=69 loops=1)
                                                                     ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.752..3.022 rows=69 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.035..1.735 rows=2743 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.698..0.698 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.061..0.544 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.053..0.118 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.043..0.068 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.020 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.033 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=69)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=69)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=70)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=70)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=70)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
               Rows Removed by Filter: 0
 Total runtime: 6.615 ms
(60 rows)

\q
