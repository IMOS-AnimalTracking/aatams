
set role to aatams;
set role to aatams;
SET
-- Low selectivity filtering (large number of rows returned for each filter)
-- Test Case 1 - 2716283 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=8.250..12.945 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=8.248..12.916 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=2.008..5.630 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.772..3.159 rows=98 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.510..2.831 rows=98 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.457..2.728 rows=98 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.297..1.461 rows=98 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.241..0.288 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.213..0.242 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.172..0.192 rows=2 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.135..0.135 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.034..0.034 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.014..0.014 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.005 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.018..0.068 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.035..0.053 rows=2 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.022..0.023 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.011..0.018 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.008 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.052..0.555 rows=49 loops=2)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=1.140..1.140 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.708 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.035..0.035 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.209..0.209 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.155 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.021..0.024 rows=1 loops=98)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.018..0.020 rows=1 loops=98)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.013..0.015 rows=1 loops=98)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=98)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.005..0.006 rows=1 loops=98)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=92)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=92)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.004..0.004 rows=1 loops=92)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=92)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 13.522 ms
(61 rows)

-- Test Case 2 - 3913743 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where spcode = '37018030'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3980.49..9691.20 rows=100 width=279) (actual time=12692.401..12776.084 rows=100 loops=1)
   ->  Hash Join  (cost=3980.49..4274849.11 rows=74787 width=279) (actual time=12692.400..12776.058 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=2213.87..4214207.64 rows=14952088 width=239) (actual time=52.502..12671.329 rows=449124 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=2202.98..4007705.43 rows=15192121 width=233) (actual time=52.305..12235.560 rows=2161070 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=26.808..10019.251 rows=5389186 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=26.748..7626.956 rows=5389186 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=25.883..5242.309 rows=5389186 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.022..1106.037 rows=5389186 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=25.829..25.829 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=8.733..21.756 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=8.700..19.304 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.826..9.969 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..2.655 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.802..2.802 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.211..1.773 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.561 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.190..0.190 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.077..0.139 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.018 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.048..0.048 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.004..0.022 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=5.844..5.844 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.005..3.418 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.015..0.015 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.005 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.846..0.846 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.004..0.439 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.040..0.040 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.003..0.019 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=25.009..25.009 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=14.340..23.257 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=12.036..18.700 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=8.204..12.400 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.018..1.472 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=8.150..8.150 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.673..6.952 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.017..1.191 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.629..3.629 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.642 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=3.809..3.809 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.018..2.567 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=2.276..2.276 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.005..1.163 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.149..0.149 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.088 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=32.752..32.752 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=28.556..32.743 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 12776.833 ms
(80 rows)

-- Test Case 3 - 17098775 rows limited to first 100
explain analyze select * from detection_extract_test_view
where timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                         QUERY PLAN                                                                                                         
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3.39..571.82 rows=100 width=279) (actual time=0.922..11.272 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=3.39..31977844.24 rows=5625584 width=279) (actual time=0.921..11.237 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=3.10..21831467.95 rows=5625584 width=239) (actual time=0.870..10.124 rows=100 loops=1)
               ->  Nested Loop  (cost=1.69..12376246.08 rows=5287633 width=193) (actual time=0.794..8.120 rows=100 loops=1)
                     ->  Nested Loop  (cost=1.55..11308727.81 rows=5372518 width=187) (actual time=0.789..7.840 rows=100 loops=1)
                           ->  Nested Loop  (cost=1.41..8537379.53 rows=16144362 width=168) (actual time=0.783..7.553 rows=100 loops=1)
                                 ->  Merge Join  (cost=1.13..3572860.21 rows=16144362 width=168) (actual time=0.743..7.082 rows=100 loops=1)
                                       Merge Cond: (receiver_deployment.id = valid_detection.receiver_deployment_id)
                                       ->  Nested Loop  (cost=0.56..188303.48 rows=5710 width=132) (actual time=0.726..1.867 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..186931.88 rows=5710 width=135) (actual time=0.720..1.841 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..184575.50 rows=5710 width=120) (actual time=0.713..1.816 rows=2 loops=1)
                                                         Join Filter: (installation.project_id = receiver_project.id)
                                                         Rows Removed by Join Filter: 86
                                                         ->  Nested Loop  (cost=0.28..178149.81 rows=5710 width=89) (actual time=0.701..1.758 rows=2 loops=1)
                                                               Join Filter: (installation_station.installation_id = installation.id)
                                                               Rows Removed by Join Filter: 112
                                                               ->  Nested Loop  (cost=0.28..168724.94 rows=5710 width=73) (actual time=0.693..1.679 rows=2 loops=1)
                                                                     Join Filter: (receiver_deployment.station_id = installation_station.id)
                                                                     Rows Removed by Join Filter: 2873
                                                                     ->  Index Scan using receiver_deployment_pkey on receiver_deployment  (cost=0.28..457.79 rows=5710 width=24) (actual time=0.008..0.009 rows=2 loops=1)
                                                                     ->  Materialize  (cost=0.00..55.46 rows=1964 width=57) (actual time=0.006..0.601 rows=1438 loops=2)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.005..0.523 rows=1964 loops=1)
                                                               ->  Materialize  (cost=0.00..3.65 rows=110 width=32) (actual time=0.002..0.030 rows=57 loops=2)
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.031 rows=110 loops=1)
                                                         ->  Materialize  (cost=0.00..2.12 rows=75 width=39) (actual time=0.002..0.020 rows=44 loops=2)
                                                               ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.021 rows=75 loops=1)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.008..0.009 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.002..0.009 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.008 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..3183595.42 rows=16144362 width=52) (actual time=0.013..5.147 rows=100 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 2460
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=100)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=99)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=99)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 11.688 ms
(59 rows)

-- Test Case 4 -  2716283 ^ 3913743 -> 1420919 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=45.576..47.527 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=45.575..47.493 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.547..24.305 rows=210 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.388..24.015 rows=210 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.919..2.371 rows=219 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.877..2.214 rows=219 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.115..1.319 rows=219 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.101..0.184 rows=5 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 61
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.094..0.145 rows=5 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.088..0.102 rows=5 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.077..0.077 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.023..0.023 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.005 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.023 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.018 rows=5 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.006 rows=1 loops=5)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.004 rows=13 loops=5)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.029..0.196 rows=44 loops=5)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.753..0.753 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.411 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.454..21.454 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.455..19.652 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.720..15.590 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.250..10.968 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.754 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.232..7.232 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.142..6.126 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.540 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.125..3.125 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.529 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.461..2.461 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.479 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.726..1.726 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.851 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.140..0.140 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.093 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.485..22.485 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.609..22.477 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 47.847 ms
(74 rows)

-- Test Case 5 - 2716283 ^ 17098775 -> 902906 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=4.542..7.849 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=4.540..7.822 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=4.454..6.732 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=4.396..4.747 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=4.239..4.535 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=4.195..4.429 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=3.420..3.585 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.094..0.185 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.089..0.165 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.044..0.056 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.036..0.036 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.023..0.023 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.010 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.014 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.025..0.025 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.004 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.806..0.836 rows=25 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.134..0.134 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.753..0.753 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.419 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.141..0.141 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.094 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 8.179 ms
(62 rows)

-- Test Case 6 - 3913743 ^ 17098775 -> 2233756 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..121817.73 rows=100 width=279) (actual time=29.010..33.738 rows=100 loops=1)
   ->  Nested Loop  (cost=930.07..27691456.56 rows=22906 width=279) (actual time=29.009..33.700 rows=100 loops=1)
         ->  Nested Loop  (cost=929.78..19534084.41 rows=4579576 width=239) (actual time=22.156..31.814 rows=325 loops=1)
               ->  Nested Loop  (cost=929.50..17890110.09 rows=4579576 width=239) (actual time=22.147..30.752 rows=325 loops=1)
                     ->  Nested Loop  (cost=929.22..15863411.32 rows=4579576 width=215) (actual time=22.137..29.622 rows=325 loops=1)
                           ->  Nested Loop  (cost=928.94..14328742.07 rows=4579576 width=231) (actual time=22.126..28.674 rows=325 loops=1)
                                 ->  Nested Loop  (cost=928.79..13404173.01 rows=4653095 width=225) (actual time=22.117..27.747 rows=325 loops=1)
                                       ->  Nested Loop  (cost=928.51..11309131.09 rows=5715895 width=209) (actual time=22.106..26.645 rows=325 loops=1)
                                             ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=22.050..25.155 rows=325 loops=1)
                                                   ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=22.042..24.311 rows=325 loops=1)
                                                         ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=22.018..23.019 rows=325 loops=1)
                                                               Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                               ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.019..0.724 rows=325 loops=1)
                                                                     Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                                                     Rows Removed by Filter: 1154
                                                               ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.978..21.978 rows=5710 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                                                     ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.228..17.997 rows=5710 loops=1)
                                                                           Hash Cond: (receiver.model_id = device_model.id)
                                                                           ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.206..15.529 rows=5710 loops=1)
                                                                                 Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                                 ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.201..8.285 rows=5710 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.001..0.892 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.191..2.191 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                                             ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.153..1.423 rows=1964 loops=1)
                                                                                                   Hash Cond: (installation_station.installation_id = installation.id)
                                                                                                   ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.291 rows=1964 loops=1)
                                                                                                   ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.143..0.143 rows=110 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                                         ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.048..0.106 rows=110 loops=1)
                                                                                                               Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.001..0.009 rows=110 loops=1)
                                                                                                               ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                                                     Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.016 rows=75 loops=1)
                                                                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.993..3.993 rows=7227 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                       ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.198 rows=7227 loops=1)
                                                                           ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.013..0.013 rows=16 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.005 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=325)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=325)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=325)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=325)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=325)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=325)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=325)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=325)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=325)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
               Rows Removed by Filter: 1
 Total runtime: 34.072 ms
(65 rows)

-- Test Case 7 - 2716283 ^ 3913743 ^ 17098775 -> 690003 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=45.813..46.731 rows=100 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=45.811..46.708 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=23.153..23.540 rows=102 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.914..2.207 rows=102 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.755..1.988 rows=102 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.714..1.898 rows=102 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.926..1.052 rows=102 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.055..0.086 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.051..0.074 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..0.050 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.036..0.036 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.023..0.023 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.011 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.011 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.208..0.230 rows=26 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.090..0.090 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.778..0.778 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.429 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.149..0.149 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.103 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.217..21.217 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.262..19.471 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.578..15.529 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.078..10.873 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.828 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.058..7.058 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.031..5.936 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.550 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.014..3.014 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.491 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.491..2.491 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.552 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.676..1.676 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.807 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.521..22.521 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.617..22.512 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 47.040 ms
(75 rows)

 
-- High selectivity filtering (small number of rows returned for each filter)
-- Test Case 8 - 5909 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=1.654..5.185 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=1.653..5.160 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.563..4.063 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.464..1.934 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.313..1.725 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.271..1.628 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.466..0.732 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.363..0.398 rows=3 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 31
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.355..0.373 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.347..0.352 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.295..0.295 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 872
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.123 rows=873 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.050..0.054 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.002..0.005 rows=11 loops=3)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.004 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.046..0.091 rows=33 loops=3)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.790..0.790 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.451 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.032..0.032 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.018 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.087 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.018..0.020 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.011..0.013 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.008..0.009 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.005 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.474 ms
(61 rows)

-- Test Case 9 - 2153 rows
set geqo_threshold to 12;
SET
explain analyze select * from species_detection_extract_test_view
where spcode = '37018003'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3980.49..9691.20 rows=100 width=279) (actual time=66604.495..66638.176 rows=100 loops=1)
   ->  Hash Join  (cost=3980.49..4274849.11 rows=74787 width=279) (actual time=66604.493..66638.147 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=2213.87..4214207.64 rows=14952088 width=239) (actual time=44.944..64445.087 rows=13949088 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=2202.98..4007705.43 rows=15192121 width=233) (actual time=44.783..57210.716 rows=13949119 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=22.527..45104.590 rows=23441777 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=22.473..34440.257 rows=23441777 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=21.710..23858.742 rows=23441777 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.004..4879.564 rows=23441777 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.688..21.688 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.208..17.821 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.187..15.480 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.189..8.251 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..0.883 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.176..2.176 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.166..1.486 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.273 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.155..0.155 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.057..0.118 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.018 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.040..0.040 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.020 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.984..3.984 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.005..2.103 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.011..0.011 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.006 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.750..0.750 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.004..0.433 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.037..0.037 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.003..0.024 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=22.223..22.223 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=12.351..20.480 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=10.396..16.270 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.702..11.284 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.773 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.667..7.667 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.613..6.515 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.573 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.588..3.588 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.613 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.675..2.675 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.004..1.528 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.935..1.935 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.006..0.818 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.130..0.130 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.004..0.089 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.458..22.458 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.554..22.449 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 66638.483 ms
(80 rows)

-- Test Case 10 - 1065 rows
explain analyze select * from detection_extract_test_view
  where timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=398.97..1704.98 rows=100 width=279) (actual time=6.274..11.249 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=398.97..6772.29 rows=488 width=279) (actual time=6.273..11.222 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=398.68..5892.13 rows=488 width=239) (actual time=6.209..10.052 rows=100 loops=1)
               ->  Nested Loop  (cost=397.27..4950.72 rows=459 width=193) (actual time=6.121..7.983 rows=100 loops=1)
                     ->  Nested Loop  (cost=397.13..4858.12 rows=466 width=187) (actual time=6.113..7.716 rows=100 loops=1)
                           ->  Nested Loop  (cost=396.99..4617.80 rows=1400 width=168) (actual time=6.107..7.452 rows=100 loops=1)
                                 ->  Nested Loop  (cost=396.85..4384.47 rows=1400 width=171) (actual time=6.101..7.187 rows=100 loops=1)
                                       ->  Hash Join  (cost=396.57..3806.73 rows=1400 width=156) (actual time=6.083..6.702 rows=100 loops=1)
                                             Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                             ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.319..5.865 rows=100 loops=1)
                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                   ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.271..5.754 rows=100 loops=1)
                                                         Hash Cond: (installation_station.installation_id = installation.id)
                                                         ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.192..5.628 rows=100 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.090..4.437 rows=100 loops=1)
                                                                     Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                     ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.082..0.314 rows=100 loops=1)
                                                                           Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                     ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=3.991..3.991 rows=5710 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                           ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..2.535 rows=5710 loops=1)
                                                               ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.090..1.090 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                     ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.520 rows=1964 loops=1)
                                                         ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.070..0.070 rows=110 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.021 rows=110 loops=1)
                                                   ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.039..0.039 rows=75 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.020 rows=75 loops=1)
                                             ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.752..0.752 rows=1519 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                   ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.006..0.428 rows=1519 loops=1)
                                       ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=100)
                                             Index Cond: (id = receiver_deployment.receiver_id)
                                 ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=100)
                                       Index Cond: (id = receiver.model_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..2.04 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.68 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..1.24 rows=1 width=22) (actual time=0.011..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.90 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 11.569 ms
(60 rows)

-- Test Case 11 - 5909 ^ 2153 -> 609 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=48.109..51.512 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=48.107..51.482 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.525..28.101 rows=1216 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.372..27.315 rows=1216 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.200..5.267 rows=1435 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.158..4.559 rows=1435 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.362..3.031 rows=1435 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.324..0.568 rows=13 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 181
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.317..0.494 rows=13 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.310..0.368 rows=13 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.297..0.309 rows=4 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.121 rows=898 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.010 rows=3 loops=4)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.007..0.008 rows=1 loops=13)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=15 loops=13)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.021..0.143 rows=110 loops=13)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.787..0.787 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.477 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.155..21.155 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.185..19.364 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.486..15.390 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.004..10.797 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.785 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=6.983..6.983 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.059..5.990 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.514 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.043..3.043 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.530 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.472..2.472 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.522 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.690..1.690 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.779 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.087 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.501..22.501 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.619..22.491 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 51.806 ms
(74 rows)

-- Test Case 12 - 5909 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.585..4.163 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.585..4.144 rows=55 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3373.72 rows=6 width=239) (actual time=0.535..3.554 rows=55 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3371.58 rows=6 width=239) (actual time=0.529..3.360 rows=55 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3368.94 rows=6 width=215) (actual time=0.522..3.174 rows=55 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3366.85 rows=6 width=215) (actual time=0.516..2.986 rows=55 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3364.85 rows=6 width=215) (actual time=0.507..2.817 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.78..3361.41 rows=6 width=193) (actual time=0.497..2.558 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.493..2.403 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.490..2.257 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.484..2.069 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.477..1.789 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.469..1.535 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.045..1.007 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.251..0.251 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.059..0.215 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.089 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.068 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.016 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.012 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=55)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=55)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=55)
               Index Cond: (animal.species_id = id)
 Total runtime: 4.497 ms
(58 rows)

-- Test Case 13 -  2153 ^ 1065 -> 55 rows
explain analyze select * from species_detection_extract_test_view
where spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                            QUERY PLAN                                                                                                                             
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4360.58..5638.33 rows=2 width=279) (actual time=22.571..38.321 rows=55 loops=1)
   ->  Nested Loop  (cost=4360.58..5638.33 rows=2 width=279) (actual time=22.569..38.309 rows=55 loops=1)
         ->  Nested Loop  (cost=4360.29..4931.17 rows=397 width=239) (actual time=21.756..34.289 rows=1065 loops=1)
               ->  Nested Loop  (cost=4360.01..4788.65 rows=397 width=239) (actual time=21.747..30.864 rows=1065 loops=1)
                     ->  Nested Loop  (cost=4359.73..4612.96 rows=397 width=215) (actual time=21.735..27.299 rows=1065 loops=1)
                           ->  Hash Join  (cost=4359.45..4479.92 rows=397 width=231) (actual time=21.714..24.148 rows=1065 loops=1)
                                 Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                 ->  Hash Join  (cost=4348.55..4463.53 rows=404 width=225) (actual time=21.560..23.404 rows=1065 loops=1)
                                       Hash Cond: (surgery.tag_id = sensor.tag_id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.496 rows=3923 loops=1)
                                       ->  Hash  (cost=4342.35..4342.35 rows=496 width=209) (actual time=21.402..21.402 rows=1065 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 319kB
                                             ->  Hash Join  (cost=856.09..4342.35 rows=496 width=209) (actual time=13.339..20.190 rows=1065 loops=1)
                                                   Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                                   ->  Hash Join  (cost=675.68..4144.75 rows=466 width=187) (actual time=10.616..16.536 rows=1065 loops=1)
                                                         Hash Cond: (receiver.organisation_id = organisation.id)
                                                         ->  Hash Join  (cost=673.54..4132.70 rows=1400 width=168) (actual time=10.570..15.978 rows=1065 loops=1)
                                                               Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                               ->  Hash Join  (cost=614.36..4054.27 rows=1400 width=168) (actual time=9.773..14.574 rows=1065 loops=1)
                                                                     Hash Cond: (receiver.model_id = device_model.id)
                                                                     ->  Hash Join  (cost=613.00..4033.66 rows=1400 width=171) (actual time=9.750..14.017 rows=1065 loops=1)
                                                                           Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                           ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.742..9.275 rows=1065 loops=1)
                                                                                 Hash Cond: (installation.project_id = receiver_project.id)
                                                                                 ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.686..8.656 rows=1065 loops=1)
                                                                                       Hash Cond: (installation_station.installation_id = installation.id)
                                                                                       ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.616..8.031 rows=1065 loops=1)
                                                                                             Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                             ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.372..6.139 rows=1065 loops=1)
                                                                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.032..0.851 rows=1065 loops=1)
                                                                                                         Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                                                   ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.308..4.308 rows=5710 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                         ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.576 rows=5710 loops=1)
                                                                                             ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.228..1.228 rows=1964 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                                   ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.486 rows=1964 loops=1)
                                                                                       ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.058..0.058 rows=110 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                             ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.031 rows=110 loops=1)
                                                                                 ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.040..0.040 rows=75 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                       ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.019 rows=75 loops=1)
                                                                           ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.996..3.996 rows=7227 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                 ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.098 rows=7227 loops=1)
                                                                     ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.010..0.010 rows=16 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                           ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.005 rows=16 loops=1)
                                                               ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.786..0.786 rows=1519 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                                     ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.469 rows=1519 loops=1)
                                                         ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.035..0.035 rows=51 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                               ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.014 rows=51 loops=1)
                                                   ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.707..2.707 rows=5307 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                                         ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..1.396 rows=5307 loops=1)
                                 ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.138..0.138 rows=173 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                       ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.094 rows=173 loops=1)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=1065)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=1065)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=1065)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=1065)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
               Rows Removed by Filter: 1
 Total runtime: 38.650 ms
(74 rows)

-- Test Case 14 -  5909 ^ 2153 ^ 1065 -> 55 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3381.48 rows=1 width=279) (actual time=0.512..3.812 rows=55 loops=1)
   ->  Nested Loop  (cost=29.47..3381.48 rows=1 width=279) (actual time=0.511..3.800 rows=55 loops=1)
         ->  Nested Loop  (cost=29.18..3372.55 rows=5 width=239) (actual time=0.462..3.184 rows=55 loops=1)
               ->  Nested Loop  (cost=28.90..3370.75 rows=5 width=239) (actual time=0.457..2.996 rows=55 loops=1)
                     ->  Nested Loop  (cost=28.62..3368.54 rows=5 width=215) (actual time=0.450..2.808 rows=55 loops=1)
                           ->  Nested Loop  (cost=28.34..3366.87 rows=5 width=231) (actual time=0.443..2.642 rows=55 loops=1)
                                 ->  Nested Loop  (cost=28.19..3365.87 rows=5 width=225) (actual time=0.438..2.488 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.91..3363.67 rows=6 width=209) (actual time=0.431..2.296 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.421..2.043 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.417..1.890 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.410..1.691 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.403..1.408 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.395..1.161 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.025..0.634 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.252..0.252 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.219 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.053..0.093 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.043..0.069 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.017 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.014 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.008 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.57 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=55)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=55)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=55)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
 Total runtime: 4.144 ms
(59 rows)

-- Mixed selectivity filtering
-- Test Case 15 - 5909 ^ 833188 -> 184 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=45.376..53.273 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=45.374..53.234 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.637..29.725 rows=2018 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.486..28.558 rows=2018 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.205..5.802 rows=2248 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.164..4.804 rows=2248 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.361..2.822 rows=2248 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.322..0.596 rows=19 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 271
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.315..0.494 rows=19 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.308..0.379 rows=19 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.295..0.309 rows=5 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.006 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.120 rows=899 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.010 rows=4 loops=5)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=19)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=15 loops=19)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.010..0.067 rows=118 loops=19)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.794..0.794 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.438 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.019 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.265..21.265 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.369..19.457 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.640..15.538 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.156..10.799 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.783 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.137..7.137 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.082..6.002 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.484 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.066..3.066 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.536 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.473..2.473 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.534 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.719..1.719 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.816 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.085 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.542..22.542 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=20.295..22.533 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 53.567 ms
(74 rows)

-- Test Case 16 - 5909 ^ 17098775 -> 3889 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=1.574..4.861 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=1.573..4.835 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=1.527..3.797 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.470..1.790 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.318..1.573 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.277..1.481 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.514..0.637 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.051..0.075 rows=3 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..0.067 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.046 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.035..0.035 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.023..0.023 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.009 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.010 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.009 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=3)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.144..0.173 rows=33 loops=3)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 148
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.061..0.061 rows=210 loops=3)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.755..0.755 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.436 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.022 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.139..0.139 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.093 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.161 ms
(62 rows)

-- Test Case 17 - 2716283 ^ 464 -> 448 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=156.724..890.724 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=156.722..890.698 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.315..836.552 rows=178524 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.161..743.578 rows=178524 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.923..599.725 rows=178553 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.882..518.644 rows=178553 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.114..422.557 rows=178553 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.100..1.418 rows=44 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 646
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.092..1.123 rows=44 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.086..0.599 rows=44 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.075..0.342 rows=7 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 941
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.137 rows=948 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.011..0.026 rows=6 loops=7)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.007..0.008 rows=1 loops=44)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.003 rows=16 loops=44)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.009 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.031..7.618 rows=4058 loops=44)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.759..0.759 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.440 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.018 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.223..21.223 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.374..19.473 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.684..15.619 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.190..10.811 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.722 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.170..7.170 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.103..6.032 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.001..0.509 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.087..3.087 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.541 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.485..2.485 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.533 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.682..1.682 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.810 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.092 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.527..22.527 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=6.553..22.520 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 891.039 ms
(74 rows)

-- Test Case 18 - 2716283 ^ 2005 -> 4 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2013-06-08 00:00:00+00' and '2013-06-08 01:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3896.81 rows=7 width=279) (actual time=2.781..3.515 rows=4 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3896.81 rows=7 width=279) (actual time=2.779..3.511 rows=4 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3884.18 rows=7 width=239) (actual time=2.723..3.423 rows=4 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3881.69 rows=7 width=239) (actual time=2.694..3.382 rows=4 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3878.61 rows=7 width=215) (actual time=2.685..3.363 rows=4 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3876.17 rows=7 width=215) (actual time=2.678..3.343 rows=4 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3873.84 rows=7 width=215) (actual time=2.670..3.325 rows=4 loops=1)
                                       ->  Nested Loop  (cost=27.78..3870.07 rows=7 width=193) (actual time=2.658..3.297 rows=4 loops=1)
                                             ->  Nested Loop  (cost=27.63..3868.68 rows=7 width=187) (actual time=2.652..3.282 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3864.90 rows=22 width=168) (actual time=2.646..3.269 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3856.39 rows=22 width=168) (actual time=2.625..3.236 rows=4 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 60
                                                               ->  Nested Loop  (cost=27.21..3849.91 rows=22 width=171) (actual time=2.615..3.198 rows=4 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3840.83 rows=22 width=156) (actual time=2.604..3.175 rows=4 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3808.21 rows=1613 width=52) (actual time=0.094..2.119 rows=1839 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-06-08 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-06-08 01:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.699..0.699 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.547 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.118 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.066 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.015 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.037 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.004 rows=1 loops=4)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.002..0.005 rows=16 loops=4)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.38 rows=1 width=16) (actual time=0.006..0.007 rows=1 loops=4)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.003 rows=1 loops=4)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.003 rows=1 loops=4)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.53 rows=1 width=22) (actual time=0.005..0.005 rows=1 loops=4)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.003..0.003 rows=1 loops=4)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.004 rows=1 loops=4)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.003..0.003 rows=1 loops=4)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.008..0.009 rows=1 loops=4)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=4)
               Index Cond: (animal.species_id = id)
 Total runtime: 3.832 ms
(58 rows)

-- Test Case 19 - 464 ^ 17098775 -> 6 rows
explain analyze select * from species_detection_extract_test_view
where spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..121817.73 rows=100 width=279) (actual time=320498.631..387230.829 rows=6 loops=1)
   ->  Nested Loop  (cost=930.07..27691456.56 rows=22906 width=279) (actual time=320498.629..387230.823 rows=6 loops=1)
         ->  Nested Loop  (cost=929.78..19534084.41 rows=4579576 width=239) (actual time=22.093..353348.945 rows=9696014 loops=1)
               ->  Nested Loop  (cost=929.50..17890110.09 rows=4579576 width=239) (actual time=22.085..321882.954 rows=9696014 loops=1)
                     ->  Nested Loop  (cost=929.22..15863411.32 rows=4579576 width=215) (actual time=22.074..289463.502 rows=9696014 loops=1)
                           ->  Nested Loop  (cost=928.94..14328742.07 rows=4579576 width=231) (actual time=22.063..261785.508 rows=9696014 loops=1)
                                 ->  Nested Loop  (cost=928.79..13404173.01 rows=4653095 width=225) (actual time=22.054..234955.267 rows=9696014 loops=1)
                                       ->  Nested Loop  (cost=928.51..11309131.09 rows=5715895 width=209) (actual time=22.042..198055.268 rows=11828011 loops=1)
                                             ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=22.027..134899.997 rows=16316319 loops=1)
                                                   ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=22.020..93256.827 rows=16316319 loops=1)
                                                         ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=21.993..36323.371 rows=16316319 loops=1)
                                                               Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                               ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.011..21419.379 rows=16316319 loops=1)
                                                                     Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                                                     Rows Removed by Filter: 36799631
                                                               ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=21.961..21.961 rows=5710 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                                                     ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.210..18.022 rows=5710 loops=1)
                                                                           Hash Cond: (receiver.model_id = device_model.id)
                                                                           ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.187..15.570 rows=5710 loops=1)
                                                                                 Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                                 ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.198..8.276 rows=5710 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..0.916 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.189..2.189 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                                             ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.153..1.354 rows=1964 loops=1)
                                                                                                   Hash Cond: (installation_station.installation_id = installation.id)
                                                                                                   ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.283 rows=1964 loops=1)
                                                                                                   ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.144..0.144 rows=110 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                                         ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.048..0.113 rows=110 loops=1)
                                                                                                               Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.016 rows=110 loops=1)
                                                                                                               ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                                                     Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.018 rows=75 loops=1)
                                                                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.975..3.975 rows=7227 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                       ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.181 rows=7227 loops=1)
                                                                           ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.014..0.014 rows=16 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=16316319)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=16316319)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=16316319)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=11828011)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=9696014)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=9696014)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=9696014)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=9696014)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=9696014)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
               Rows Removed by Filter: 1
 Total runtime: 387231.153 ms
(65 rows)

-- Test Case 20 - 833188 ^ 5489 -> 210 rows
explain analyze select * from species_detection_extract_test_view
where spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                         QUERY PLAN                                                                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3100.88..14963.67 rows=6 width=279) (actual time=43.549..84.849 rows=100 loops=1)
   ->  Hash Join  (cost=3100.88..14963.67 rows=6 width=279) (actual time=43.547..84.822 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Nested Loop  (cost=1334.25..13191.97 rows=1292 width=239) (actual time=20.405..60.788 rows=2940 loops=1)
               ->  Hash Join  (cost=1333.97..12759.01 rows=1292 width=255) (actual time=20.382..51.512 rows=2940 loops=1)
                     Hash Cond: (animal_release.animal_id = animal.id)
                     ->  Hash Join  (cost=1213.45..12615.88 rows=1292 width=255) (actual time=18.685..47.689 rows=2940 loops=1)
                           Hash Cond: (surgery.release_id = animal_release.id)
                           ->  Hash Join  (cost=1012.25..12392.07 rows=1292 width=231) (actual time=16.155..42.877 rows=2940 loops=1)
                                 Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                 ->  Hash Join  (cost=1001.36..12363.35 rows=1312 width=225) (actual time=16.009..41.015 rows=2940 loops=1)
                                       Hash Cond: (sensor.tag_id = surgery.tag_id)
                                       ->  Hash Join  (cost=856.09..12170.71 rows=1612 width=209) (actual time=14.189..37.086 rows=2832 loops=1)
                                             Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                             ->  Hash Join  (cost=675.68..11934.41 rows=1515 width=187) (actual time=11.317..31.543 rows=3143 loops=1)
                                                   Hash Cond: (receiver.organisation_id = organisation.id)
                                                   ->  Hash Join  (cost=673.54..11900.04 rows=4554 width=168) (actual time=11.263..29.773 rows=3143 loops=1)
                                                         Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                         ->  Hash Join  (cost=614.36..11778.24 rows=4554 width=168) (actual time=10.445..27.048 rows=3143 loops=1)
                                                               Hash Cond: (receiver.model_id = device_model.id)
                                                               ->  Hash Join  (cost=613.00..11714.26 rows=4554 width=171) (actual time=10.422..25.293 rows=3143 loops=1)
                                                                     Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                     ->  Hash Join  (cost=337.39..11341.88 rows=4554 width=156) (actual time=5.967..18.439 rows=3143 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Hash Join  (cost=334.70..11276.58 rows=4554 width=125) (actual time=5.895..16.690 rows=3143 loops=1)
                                                                                 Hash Cond: (installation_station.installation_id = installation.id)
                                                                                 ->  Hash Join  (cost=330.23..11209.49 rows=4554 width=109) (actual time=5.812..14.944 rows=3143 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Hash Join  (cost=260.04..11070.99 rows=4554 width=60) (actual time=4.495..11.571 rows=3143 loops=1)
                                                                                             Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                             ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.120..4.157 rows=3143 loops=1)
                                                                                                   Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                                                             ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.349..4.349 rows=5710 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                   ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.584 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.297..1.297 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                             ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.518 rows=1964 loops=1)
                                                                                 ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.064..0.064 rows=110 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.027 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.045..0.045 rows=75 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.004..0.019 rows=75 loops=1)
                                                                     ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=4.434..4.434 rows=7227 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                           ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.004..2.199 rows=7227 loops=1)
                                                               ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.011..0.011 rows=16 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.005 rows=16 loops=1)
                                                         ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.805..0.805 rows=1519 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                               ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.004..0.406 rows=1519 loops=1)
                                                   ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.037..0.037 rows=51 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                         ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.003..0.019 rows=51 loops=1)
                                             ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.816..2.816 rows=5307 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                                   ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..1.346 rows=5307 loops=1)
                                       ->  Hash  (cost=96.23..96.23 rows=3923 width=16) (actual time=1.807..1.807 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 184kB
                                             ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.928 rows=3923 loops=1)
                                 ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.130..0.130 rows=173 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                       ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.003..0.082 rows=173 loops=1)
                           ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.517..2.517 rows=3920 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                 ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.574 rows=3920 loops=1)
                     ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.680..1.680 rows=4023 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 189kB
                           ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.007..0.809 rows=4023 loops=1)
               ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=2940)
                     Index Cond: (id = sensor.tag_id)
                     Heap Fetches: 0
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.608..22.608 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=20.323..22.601 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 85.176 ms
(80 rows)

-- Test Case 21 - 5909 ^ 2153 ^ 17098775 -> 284 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=45.151..54.838 rows=100 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=45.149..54.814 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=22.496..31.209 rows=2234 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.325..8.457 rows=2324 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.177..7.264 rows=2324 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.137..6.238 rows=2324 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.374..4.375 rows=2324 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.052..0.551 rows=47 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..0.413 rows=47 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..0.174 rows=47 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.035..0.050 rows=11 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.009 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.019 rows=11 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.004..0.008 rows=4 loops=11)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.004 rows=1 loops=47)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=47)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.037..0.064 rows=49 loops=47)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 31
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.017..0.017 rows=85 loops=47)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.754..0.754 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.422 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.032..0.032 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.016 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.088 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.137..21.137 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.344..19.299 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.625..15.456 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.127..10.655 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.750 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.109..7.109 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.055..5.942 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.507 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.038..3.038 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.518 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.484..2.484 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.543 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.707..1.707 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.821 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.546..22.546 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.639..22.537 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 55.146 ms
(75 rows)

-- Test Case 22 - 5909 ^ 833188 ^ 5489 -> 13 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..10905.01 rows=1 width=279) (actual time=0.799..5.492 rows=13 loops=1)
   ->  Nested Loop  (cost=29.47..10905.01 rows=1 width=279) (actual time=0.797..5.488 rows=13 loops=1)
         ->  Nested Loop  (cost=29.18..10874.70 rows=17 width=239) (actual time=0.746..5.310 rows=13 loops=1)
               ->  Nested Loop  (cost=28.90..10868.60 rows=17 width=239) (actual time=0.739..5.263 rows=13 loops=1)
                     ->  Nested Loop  (cost=28.62..10861.08 rows=17 width=215) (actual time=0.733..5.214 rows=13 loops=1)
                           ->  Nested Loop  (cost=28.34..10855.38 rows=17 width=231) (actual time=0.726..5.167 rows=13 loops=1)
                                 ->  Nested Loop  (cost=28.19..10852.00 rows=17 width=225) (actual time=0.722..5.130 rows=13 loops=1)
                                       ->  Nested Loop  (cost=27.91..10844.31 rows=21 width=209) (actual time=0.715..5.081 rows=13 loops=1)
                                             ->  Nested Loop  (cost=27.63..10836.44 rows=20 width=187) (actual time=0.705..5.013 rows=13 loops=1)
                                                   ->  Nested Loop  (cost=27.49..10825.97 rows=61 width=168) (actual time=0.701..4.979 rows=13 loops=1)
                                                         ->  Nested Loop  (cost=27.21..10805.50 rows=61 width=168) (actual time=0.694..4.927 rows=13 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 195
                                                               ->  Nested Loop  (cost=27.21..10789.66 rows=61 width=171) (actual time=0.687..4.852 rows=13 loops=1)
                                                                     ->  Hash Join  (cost=26.93..10764.48 rows=61 width=156) (actual time=0.679..4.793 rows=13 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.034..3.583 rows=5041 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.246..0.246 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.058..0.208 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.051..0.089 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.067 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.018 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.015 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=13)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=13)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.33 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=13)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.38 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=13)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=13)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=13)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=13)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=13)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
 Total runtime: 5.814 ms
(59 rows)

-- Test Case 23 - 5909 ^ 833188 ^ 17098775 -> 54 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=47.001..59.477 rows=54 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=47.000..59.460 rows=54 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=22.563..35.879 rows=3558 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.358..12.193 rows=3854 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.212..10.295 rows=3854 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.171..8.689 rows=3854 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.402..6.031 rows=3854 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.066..0.775 rows=64 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.062..0.582 rows=64 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.057..0.271 rows=64 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.050..0.107 rows=15 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.037..0.077 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.022..0.034 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.019 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.022 rows=15 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=4 loops=15)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=64)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=64)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.031..0.062 rows=60 loops=64)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 32
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.015..0.015 rows=92 loops=64)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.761..0.761 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.387 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.020 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.081 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.169..21.169 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.291..19.378 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.590..15.484 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.061..10.688 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.711 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.042..7.042 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=2.986..5.886 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.544 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.969..2.969 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.470 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.514..2.514 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.574 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.691..1.691 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.807 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.506..22.506 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=20.253..22.499 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 59.773 ms
(75 rows)

-- Test Case 24 - 2716283 ^ 464 ^ 3129 -> 2 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5329.65 rows=1 width=279) (actual time=1.989..7.388 rows=2 loops=1)
   ->  Nested Loop  (cost=29.47..5329.65 rows=1 width=279) (actual time=1.988..7.385 rows=2 loops=1)
         ->  Nested Loop  (cost=29.18..5313.59 rows=9 width=239) (actual time=0.959..7.060 rows=70 loops=1)
               ->  Nested Loop  (cost=28.90..5310.36 rows=9 width=239) (actual time=0.953..6.820 rows=70 loops=1)
                     ->  Nested Loop  (cost=28.62..5306.38 rows=9 width=215) (actual time=0.947..6.570 rows=70 loops=1)
                           ->  Nested Loop  (cost=28.34..5303.36 rows=9 width=231) (actual time=0.940..6.357 rows=70 loops=1)
                                 ->  Nested Loop  (cost=28.19..5301.57 rows=9 width=225) (actual time=0.936..6.165 rows=70 loops=1)
                                       ->  Nested Loop  (cost=27.91..5297.54 rows=11 width=209) (actual time=0.928..5.905 rows=70 loops=1)
                                             ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.919..5.573 rows=69 loops=1)
                                                   ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.914..5.377 rows=69 loops=1)
                                                         ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.906..5.141 rows=69 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 1035
                                                               ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.897..4.791 rows=69 loops=1)
                                                                     ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.890..4.503 rows=69 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.102..3.164 rows=2743 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.727..0.727 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.061..0.567 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.053..0.120 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.043..0.069 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.005..0.018 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.031 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=69)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=69)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=70)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=70)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=70)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
               Rows Removed by Filter: 1
 Total runtime: 7.704 ms
(60 rows)

-- Test Case 25 - 2716283 ^ 464 ^ 17098775 -> 4 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=1658.589..4864.612 rows=4 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=1658.587..4864.608 rows=4 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=23.127..4676.108 rows=896073 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.899..4041.047 rows=902521 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.752..3652.774 rows=902521 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.710..3259.830 rows=902521 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.914..2825.642 rows=902521 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.054..6.428 rows=282 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.050..4.795 rows=282 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..1.742 rows=282 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.244 rows=45 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.063 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.021 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.017 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.113 rows=45 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.010..0.022 rows=6 loops=45)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.007..0.008 rows=1 loops=282)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.004 rows=1 loops=282)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=6.089..8.895 rows=3200 loops=282)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 6410
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=1.470..1.470 rows=9611 loops=282)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.788..0.788 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.464 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.137..0.137 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.086 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.206..21.206 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.387..19.426 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.693..15.565 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.172..10.809 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.756 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.152..7.152 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.101..5.967 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.511 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.084..3.084 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.479 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.510..2.510 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.563 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.686..1.686 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.795 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.517..22.517 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=6.542..22.511 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 4864.901 ms
(75 rows)

-- Test Case 26 - 2716283 ^ 3913743 ^ 3129 -> 52 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5329.65 rows=1 width=279) (actual time=0.868..6.251 rows=52 loops=1)
   ->  Nested Loop  (cost=29.47..5329.65 rows=1 width=279) (actual time=0.866..6.235 rows=52 loops=1)
         ->  Nested Loop  (cost=29.18..5313.59 rows=9 width=239) (actual time=0.814..5.573 rows=70 loops=1)
               ->  Nested Loop  (cost=28.90..5310.36 rows=9 width=239) (actual time=0.807..5.332 rows=70 loops=1)
                     ->  Nested Loop  (cost=28.62..5306.38 rows=9 width=215) (actual time=0.800..5.070 rows=70 loops=1)
                           ->  Nested Loop  (cost=28.34..5303.36 rows=9 width=231) (actual time=0.793..4.870 rows=70 loops=1)
                                 ->  Nested Loop  (cost=28.19..5301.57 rows=9 width=225) (actual time=0.790..4.661 rows=70 loops=1)
                                       ->  Nested Loop  (cost=27.91..5297.54 rows=11 width=209) (actual time=0.782..4.420 rows=70 loops=1)
                                             ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.772..4.079 rows=69 loops=1)
                                                   ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.769..3.886 rows=69 loops=1)
                                                         ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.760..3.628 rows=69 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 1035
                                                               ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.753..3.276 rows=69 loops=1)
                                                                     ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.747..2.979 rows=69 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.036..1.703 rows=2743 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.692..0.692 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.061..0.567 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.053..0.117 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.043..0.069 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.005..0.020 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.009..0.030 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=69)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.008 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=69)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=70)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=70)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
               Rows Removed by Filter: 0
 Total runtime: 6.578 ms
(60 rows)

\q
