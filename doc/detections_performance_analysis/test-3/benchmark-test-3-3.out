
set role to aatams;
set role to aatams;
SET
-- Low selectivity filtering (large number of rows returned for each filter)
-- Test Case 1 - 2716283 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=7.851..11.528 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=7.849..11.501 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.578..4.231 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.469..2.164 rows=98 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.252..1.889 rows=98 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.186..1.763 rows=98 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.188..0.685 rows=98 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.161..0.193 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.134..0.149 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.121..0.128 rows=2 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.105..0.105 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.033..0.033 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.013..0.013 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.007..0.033 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.014..0.020 rows=2 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.007..0.008 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.010..0.015 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.023..0.211 rows=49 loops=2)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.977..0.977 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.549 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.038..0.038 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.003..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.171..0.171 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.107 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.017..0.020 rows=1 loops=98)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.014..0.016 rows=1 loops=98)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.011..0.012 rows=1 loops=98)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.008..0.009 rows=1 loops=98)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.005 rows=1 loops=98)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=92)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=92)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=92)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=92)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 12.092 ms
(61 rows)

-- Test Case 2 - 3913743 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where spcode = '37018030'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3980.49..9691.20 rows=100 width=279) (actual time=2546.159..2555.879 rows=100 loops=1)
   ->  Hash Join  (cost=3980.49..4274849.11 rows=74787 width=279) (actual time=2546.157..2555.847 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=2213.87..4214207.64 rows=14952088 width=239) (actual time=48.290..2509.146 rows=118446 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=2202.98..4007705.43 rows=15192121 width=233) (actual time=48.076..2444.335 rows=118446 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=24.833..2106.837 rows=1087082 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=24.774..1623.622 rows=1087082 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=23.889..1152.427 rows=1087082 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.023..230.659 rows=1087082 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=23.836..23.836 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=7.482..19.827 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=7.451..17.425 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.598..9.231 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..1.038 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.574..2.574 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.210..1.601 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.309 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.188..0.188 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.073..0.130 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.016 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.045..0.045 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.004..0.018 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=4.828..4.828 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.004..2.521 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.014..0.014 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.006 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.867..0.867 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.004..0.450 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.039..0.039 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.004..0.022 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=23.164..23.164 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=13.086..21.387 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=11.013..17.147 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.890..11.692 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.005..0.860 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.856..7.856 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.569..6.654 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.004..0.653 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.536..3.536 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.628 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=3.099..3.099 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.005..1.899 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=2.041..2.041 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.008..0.930 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.165..0.165 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.109 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=26.619..26.619 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=23.194..26.610 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 2556.614 ms
(80 rows)

-- Test Case 3 - 17098775 rows limited to first 100
explain analyze select * from detection_extract_test_view
where timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                         QUERY PLAN                                                                                                         
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3.39..571.82 rows=100 width=279) (actual time=0.823..8.049 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=3.39..31977844.24 rows=5625584 width=279) (actual time=0.822..8.029 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=3.10..21831467.95 rows=5625584 width=239) (actual time=0.771..6.961 rows=100 loops=1)
               ->  Nested Loop  (cost=1.69..12376246.08 rows=5287633 width=193) (actual time=0.727..5.024 rows=100 loops=1)
                     ->  Nested Loop  (cost=1.55..11308727.81 rows=5372518 width=187) (actual time=0.723..4.769 rows=100 loops=1)
                           ->  Nested Loop  (cost=1.41..8537379.53 rows=16144362 width=168) (actual time=0.719..4.491 rows=100 loops=1)
                                 ->  Merge Join  (cost=1.13..3572860.21 rows=16144362 width=168) (actual time=0.704..4.055 rows=100 loops=1)
                                       Merge Cond: (receiver_deployment.id = valid_detection.receiver_deployment_id)
                                       ->  Nested Loop  (cost=0.56..188303.48 rows=5710 width=132) (actual time=0.686..1.736 rows=2 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 16
                                             ->  Nested Loop  (cost=0.56..186931.88 rows=5710 width=135) (actual time=0.680..1.718 rows=2 loops=1)
                                                   ->  Nested Loop  (cost=0.28..184575.50 rows=5710 width=120) (actual time=0.673..1.701 rows=2 loops=1)
                                                         Join Filter: (installation.project_id = receiver_project.id)
                                                         Rows Removed by Join Filter: 86
                                                         ->  Nested Loop  (cost=0.28..178149.81 rows=5710 width=89) (actual time=0.662..1.650 rows=2 loops=1)
                                                               Join Filter: (installation_station.installation_id = installation.id)
                                                               Rows Removed by Join Filter: 112
                                                               ->  Nested Loop  (cost=0.28..168724.94 rows=5710 width=73) (actual time=0.654..1.574 rows=2 loops=1)
                                                                     Join Filter: (receiver_deployment.station_id = installation_station.id)
                                                                     Rows Removed by Join Filter: 2873
                                                                     ->  Index Scan using receiver_deployment_pkey on receiver_deployment  (cost=0.28..457.79 rows=5710 width=24) (actual time=0.009..0.010 rows=2 loops=1)
                                                                     ->  Materialize  (cost=0.00..55.46 rows=1964 width=57) (actual time=0.006..0.580 rows=1438 loops=2)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.005..0.476 rows=1964 loops=1)
                                                               ->  Materialize  (cost=0.00..3.65 rows=110 width=32) (actual time=0.002..0.029 rows=57 loops=2)
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.030 rows=110 loops=1)
                                                         ->  Materialize  (cost=0.00..2.12 rows=75 width=39) (actual time=0.002..0.017 rows=44 loops=2)
                                                               ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.014 rows=75 loops=1)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=2)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.002..0.006 rows=9 loops=2)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..3183595.42 rows=16144362 width=52) (actual time=0.014..2.264 rows=100 loops=1)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 2460
                                 ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=100)
                                       Index Cond: (id = valid_detection.receiver_download_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.015..0.018 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.012..0.014 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.009..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.006..0.007 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=99)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=99)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=99)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 8.450 ms
(59 rows)

-- Test Case 4 -  2716283 ^ 3913743 -> 1420919 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=45.427..46.744 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=45.426..46.719 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.371..23.512 rows=210 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.184..23.197 rows=210 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.938..1.776 rows=219 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.897..1.618 rows=219 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.111..0.715 rows=219 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.099..0.180 rows=5 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 61
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.092..0.140 rows=5 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.086..0.100 rows=5 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.075..0.075 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 158
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.020 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.021 rows=159 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.009..0.018 rows=5 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.006 rows=1 loops=5)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.003 rows=13 loops=5)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.014..0.083 rows=44 loops=5)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.776..0.776 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.439 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.021 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.230..21.230 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.295..19.436 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.612..15.616 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.133..10.824 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.726 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.114..7.114 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.135..6.063 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.543 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.117..3.117 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.555 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.470..2.470 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.519 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.674..1.674 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.778 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.167..0.167 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.110 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.506..22.506 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.597..22.497 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 47.062 ms
(74 rows)

-- Test Case 5 - 2716283 ^ 17098775 -> 902906 rows limited to first 100
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=2.405..5.690 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=2.404..5.655 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=2.344..4.624 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=2.299..2.623 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=2.150..2.413 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=2.106..2.309 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=1.339..1.470 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.062..0.099 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.058..0.085 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..0.051 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.035..0.035 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.007 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.012..0.012 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.010 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.007..0.008 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.003 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.308..0.332 rows=25 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.100..0.100 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.754..0.754 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.427 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.083 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.981 ms
(62 rows)

-- Test Case 6 - 3913743 ^ 17098775 -> 2233756 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..121817.73 rows=100 width=279) (actual time=41.140..319.013 rows=100 loops=1)
   ->  Nested Loop  (cost=930.07..27691456.56 rows=22906 width=279) (actual time=41.138..318.980 rows=100 loops=1)
         ->  Nested Loop  (cost=929.78..19534084.41 rows=4579576 width=239) (actual time=22.233..285.623 rows=9528 loops=1)
               ->  Nested Loop  (cost=929.50..17890110.09 rows=4579576 width=239) (actual time=22.221..255.290 rows=9528 loops=1)
                     ->  Nested Loop  (cost=929.22..15863411.32 rows=4579576 width=215) (actual time=22.208..223.577 rows=9528 loops=1)
                           ->  Nested Loop  (cost=928.94..14328742.07 rows=4579576 width=231) (actual time=22.193..196.522 rows=9528 loops=1)
                                 ->  Nested Loop  (cost=928.79..13404173.01 rows=4653095 width=225) (actual time=22.184..170.401 rows=9528 loops=1)
                                       ->  Nested Loop  (cost=928.51..11309131.09 rows=5715895 width=209) (actual time=22.168..138.575 rows=9528 loops=1)
                                             ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=22.146..98.684 rows=9528 loops=1)
                                                   ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=22.136..73.176 rows=9528 loops=1)
                                                         ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=22.091..38.612 rows=9528 loops=1)
                                                               Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                               ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.010..7.475 rows=9528 loops=1)
                                                                     Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                                               ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=22.060..22.060 rows=5710 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                                                     ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.210..18.142 rows=5710 loops=1)
                                                                           Hash Cond: (receiver.model_id = device_model.id)
                                                                           ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.189..15.545 rows=5710 loops=1)
                                                                                 Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                                 ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.260..8.320 rows=5710 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..0.914 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.250..2.250 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                                             ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.152..1.500 rows=1964 loops=1)
                                                                                                   Hash Cond: (installation_station.installation_id = installation.id)
                                                                                                   ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.294 rows=1964 loops=1)
                                                                                                   ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.143..0.143 rows=110 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                                         ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.049..0.107 rows=110 loops=1)
                                                                                                               Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.001..0.015 rows=110 loops=1)
                                                                                                               ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                                                     Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.018 rows=75 loops=1)
                                                                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.917..3.917 rows=7227 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                       ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.002..2.178 rows=7227 loops=1)
                                                                           ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.012..0.012 rows=16 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.004 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=9528)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=9528)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=9528)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=9528)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=9528)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=9528)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=9528)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=9528)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=9528)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
               Rows Removed by Filter: 1
 Total runtime: 319.351 ms
(64 rows)

-- Test Case 7 - 2716283 ^ 3913743 ^ 17098775 -> 690003 rows limited to first 100
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=45.743..46.662 rows=100 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=45.740..46.642 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=23.152..23.548 rows=102 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.873..2.171 rows=102 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.727..1.969 rows=102 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.686..1.852 rows=102 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.927..1.047 rows=102 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.054..0.088 rows=4 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.050..0.074 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..0.049 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.035..0.035 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.005 rows=27 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.010 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.007..0.011 rows=4 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=4)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.208..0.225 rows=26 loops=4)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 118
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.090..0.090 rows=802 loops=4)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.748..0.748 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.415 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.019 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.088 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.259..21.259 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.269..19.476 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.585..15.502 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.094..10.776 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.768 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.075..7.075 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.035..5.936 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.555 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.018..3.018 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.483 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.480..2.480 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.580 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.676..1.676 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.791 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.450..22.450 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.551..22.442 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 46.997 ms
(75 rows)

 
-- High selectivity filtering (small number of rows returned for each filter)
-- Test Case 8 - 5909 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=75.04..476.71 rows=100 width=279) (actual time=1.514..4.851 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=75.04..983740.11 rows=244897 width=279) (actual time=1.513..4.814 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=74.75..542040.70 rows=244897 width=239) (actual time=1.443..3.760 rows=100 loops=1)
               ->  Hash Join  (cost=73.35..130432.90 rows=230185 width=193) (actual time=1.395..1.761 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.246..1.544 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.200..1.446 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.386..0.562 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.334..0.368 rows=3 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 31
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.327..0.345 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.319..0.324 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.292..0.292 rows=1 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 872
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.113 rows=873 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.025..0.029 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.002..0.005 rows=11 loops=3)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.018..0.044 rows=33 loops=3)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.802..0.802 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.405 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.015 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.136..0.136 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.089 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.140 ms
(61 rows)

-- Test Case 9 - 2153 rows
set geqo_threshold to 12;
SET
explain analyze select * from species_detection_extract_test_view
where spcode = '37018003'
limit 100;
                                                                                                     QUERY PLAN                                                                                                      
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3980.49..9691.20 rows=100 width=279) (actual time=2831.775..49058.889 rows=100 loops=1)
   ->  Hash Join  (cost=3980.49..4274849.11 rows=74787 width=279) (actual time=2831.773..49058.856 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=2213.87..4214207.64 rows=14952088 width=239) (actual time=45.264..47327.061 rows=10943793 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=2202.98..4007705.43 rows=15192121 width=233) (actual time=45.098..41620.379 rows=10943793 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=989.14..3459905.83 rows=17541004 width=187) (actual time=22.858..32867.223 rows=17075069 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=986.99..3086829.12 rows=52710540 width=168) (actual time=22.808..25209.289 rows=17075069 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Hash Join  (cost=927.81..2362000.01 rows=52710540 width=168) (actual time=22.033..17624.246 rows=17075069 loops=1)
                                       Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                       ->  Seq Scan on valid_detection  (cost=0.00..1306861.40 rows=52710540 width=52) (actual time=0.004..3442.370 rows=17075069 loops=1)
                                       ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=22.010..22.010 rows=5710 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                             ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.270..18.053 rows=5710 loops=1)
                                                   Hash Cond: (receiver.model_id = device_model.id)
                                                   ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.250..15.642 rows=5710 loops=1)
                                                         Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                         ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.258..8.411 rows=5710 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..1.028 rows=5710 loops=1)
                                                               ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.246..2.246 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                     ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.166..1.406 rows=1964 loops=1)
                                                                           Hash Cond: (installation_station.installation_id = installation.id)
                                                                           ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.269 rows=1964 loops=1)
                                                                           ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.154..0.154 rows=110 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                 ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.056..0.121 rows=110 loops=1)
                                                                                       Hash Cond: (installation.project_id = receiver_project.id)
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.016 rows=110 loops=1)
                                                                                       ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                             ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.019 rows=75 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.977..3.977 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                               ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.207 rows=7227 loops=1)
                                                   ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.011..0.011 rows=16 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                         ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.006 rows=16 loops=1)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.761..0.761 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.004..0.416 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.037..0.037 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.003..0.018 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=22.204..22.204 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=12.377..20.391 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=10.375..16.178 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.645..11.256 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.722 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.614..7.614 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.548..6.500 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.534 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.522..3.522 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.004..1.593 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.711..2.711 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.004..1.534 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.983..1.983 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.006..0.838 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.101 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.676..22.676 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.750..22.669 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 49059.196 ms
(80 rows)

-- Test Case 10 - 1065 rows
explain analyze select * from detection_extract_test_view
  where timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=398.97..1704.98 rows=100 width=279) (actual time=6.245..10.942 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=398.97..6772.29 rows=488 width=279) (actual time=6.243..10.906 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=398.68..5892.13 rows=488 width=239) (actual time=6.181..9.832 rows=100 loops=1)
               ->  Nested Loop  (cost=397.27..4950.72 rows=459 width=193) (actual time=6.103..7.831 rows=100 loops=1)
                     ->  Nested Loop  (cost=397.13..4858.12 rows=466 width=187) (actual time=6.096..7.552 rows=100 loops=1)
                           ->  Nested Loop  (cost=396.99..4617.80 rows=1400 width=168) (actual time=6.090..7.287 rows=100 loops=1)
                                 ->  Nested Loop  (cost=396.85..4384.47 rows=1400 width=171) (actual time=6.083..7.017 rows=100 loops=1)
                                       ->  Hash Join  (cost=396.57..3806.73 rows=1400 width=156) (actual time=6.066..6.549 rows=100 loops=1)
                                             Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                             ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.298..5.703 rows=100 loops=1)
                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                   ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.251..5.598 rows=100 loops=1)
                                                         Hash Cond: (installation_station.installation_id = installation.id)
                                                         ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.169..5.462 rows=100 loops=1)
                                                               Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                               ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.078..4.307 rows=100 loops=1)
                                                                     Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                     ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.040..0.157 rows=100 loops=1)
                                                                           Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                     ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.006..4.006 rows=5710 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                           ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.003..2.555 rows=5710 loops=1)
                                                               ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.079..1.079 rows=1964 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                     ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.491 rows=1964 loops=1)
                                                         ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.073..0.073 rows=110 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.025 rows=110 loops=1)
                                                   ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.016 rows=75 loops=1)
                                             ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.756..0.756 rows=1519 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                   ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.006..0.420 rows=1519 loops=1)
                                       ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=100)
                                             Index Cond: (id = receiver_deployment.receiver_id)
                                 ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=100)
                                       Index Cond: (id = receiver.model_id)
                           ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=100)
                                 Index Cond: (id = receiver.organisation_id)
                     ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=100)
                           Index Cond: (id = receiver_download_file.requesting_user_id)
               ->  Nested Loop Left Join  (cost=1.41..2.04 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.68 rows=1 width=46) (actual time=0.013..0.015 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..1.24 rows=1 width=22) (actual time=0.010..0.011 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.90 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 11.259 ms
(60 rows)

-- Test Case 11 - 5909 ^ 2153 -> 609 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=47.519..50.492 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=47.518..50.460 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.501..27.143 rows=1216 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.342..26.348 rows=1216 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.220..4.321 rows=1435 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.178..3.653 rows=1435 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.357..2.071 rows=1435 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.319..0.546 rows=13 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 181
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.311..0.469 rows=13 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.304..0.367 rows=13 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.293..0.304 rows=4 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.122 rows=898 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.013 rows=3 loops=4)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.006 rows=1 loops=13)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=15 loops=13)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.007 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.012..0.069 rows=110 loops=13)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.812..0.812 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.454 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.024 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.105..21.105 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.140..19.316 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.441..15.379 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=6.978..10.654 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.788 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=6.958..6.958 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.118..6.041 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.550 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.101..3.101 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.518 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.453..2.453 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.496 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.690..1.690 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.802 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.140..0.140 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.097 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.498..22.498 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.612..22.490 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 50.787 ms
(74 rows)

-- Test Case 12 - 5909 ^ 1065 -> 55 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.502..3.807 rows=55 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3384.54 rows=6 width=279) (actual time=0.501..3.795 rows=55 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3373.72 rows=6 width=239) (actual time=0.452..3.195 rows=55 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3371.58 rows=6 width=239) (actual time=0.446..2.989 rows=55 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3368.94 rows=6 width=215) (actual time=0.439..2.798 rows=55 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3366.85 rows=6 width=215) (actual time=0.433..2.607 rows=55 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3364.85 rows=6 width=215) (actual time=0.426..2.442 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.78..3361.41 rows=6 width=193) (actual time=0.415..2.178 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.412..2.033 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.408..1.877 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.402..1.690 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.395..1.409 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.388..1.161 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.026..0.679 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.247..0.247 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.058..0.211 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.051..0.088 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.065 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.015 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.016 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=55)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.56 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=55)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=55)
               Index Cond: (animal.species_id = id)
 Total runtime: 4.120 ms
(58 rows)

-- Test Case 13 -  2153 ^ 1065 -> 55 rows
explain analyze select * from species_detection_extract_test_view
where spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                            QUERY PLAN                                                                                                                             
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=4360.58..5638.33 rows=2 width=279) (actual time=22.773..38.489 rows=55 loops=1)
   ->  Nested Loop  (cost=4360.58..5638.33 rows=2 width=279) (actual time=22.772..38.469 rows=55 loops=1)
         ->  Nested Loop  (cost=4360.29..4931.17 rows=397 width=239) (actual time=21.948..34.471 rows=1065 loops=1)
               ->  Nested Loop  (cost=4360.01..4788.65 rows=397 width=239) (actual time=21.937..31.034 rows=1065 loops=1)
                     ->  Nested Loop  (cost=4359.73..4612.96 rows=397 width=215) (actual time=21.926..27.497 rows=1065 loops=1)
                           ->  Hash Join  (cost=4359.45..4479.92 rows=397 width=231) (actual time=21.905..24.350 rows=1065 loops=1)
                                 Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                 ->  Hash Join  (cost=4348.55..4463.53 rows=404 width=225) (actual time=21.741..23.603 rows=1065 loops=1)
                                       Hash Cond: (surgery.tag_id = sensor.tag_id)
                                       ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.503 rows=3923 loops=1)
                                       ->  Hash  (cost=4342.35..4342.35 rows=496 width=209) (actual time=21.581..21.581 rows=1065 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 319kB
                                             ->  Hash Join  (cost=856.09..4342.35 rows=496 width=209) (actual time=13.354..20.221 rows=1065 loops=1)
                                                   Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                                   ->  Hash Join  (cost=675.68..4144.75 rows=466 width=187) (actual time=10.623..16.577 rows=1065 loops=1)
                                                         Hash Cond: (receiver.organisation_id = organisation.id)
                                                         ->  Hash Join  (cost=673.54..4132.70 rows=1400 width=168) (actual time=10.576..15.949 rows=1065 loops=1)
                                                               Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                               ->  Hash Join  (cost=614.36..4054.27 rows=1400 width=168) (actual time=9.797..14.576 rows=1065 loops=1)
                                                                     Hash Cond: (receiver.model_id = device_model.id)
                                                                     ->  Hash Join  (cost=613.00..4033.66 rows=1400 width=171) (actual time=9.776..14.003 rows=1065 loops=1)
                                                                           Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                           ->  Hash Join  (cost=337.39..3728.30 rows=1400 width=156) (actual time=5.800..9.286 rows=1065 loops=1)
                                                                                 Hash Cond: (installation.project_id = receiver_project.id)
                                                                                 ->  Hash Join  (cost=334.70..3706.36 rows=1400 width=125) (actual time=5.743..8.683 rows=1065 loops=1)
                                                                                       Hash Cond: (installation_station.installation_id = installation.id)
                                                                                       ->  Hash Join  (cost=330.23..3682.64 rows=1400 width=109) (actual time=5.674..8.070 rows=1065 loops=1)
                                                                                             Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                             ->  Hash Join  (cost=260.04..3591.45 rows=1400 width=60) (actual time=4.409..6.153 rows=1065 loops=1)
                                                                                                   Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                                   ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.032..0.852 rows=1065 loops=1)
                                                                                                         Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                                                   ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.346..4.346 rows=5710 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                         ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.586 rows=5710 loops=1)
                                                                                             ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.249..1.249 rows=1964 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                                   ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.004..0.494 rows=1964 loops=1)
                                                                                       ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.058..0.058 rows=110 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                             ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.025 rows=110 loops=1)
                                                                                 ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.040..0.040 rows=75 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                       ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.003..0.015 rows=75 loops=1)
                                                                           ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.965..3.965 rows=7227 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                 ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.106 rows=7227 loops=1)
                                                                     ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.010..0.010 rows=16 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                           ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.006 rows=16 loops=1)
                                                               ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.765..0.765 rows=1519 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                                     ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.404 rows=1519 loops=1)
                                                         ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.035..0.035 rows=51 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                               ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.018 rows=51 loops=1)
                                                   ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.715..2.715 rows=5307 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                                         ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..1.387 rows=5307 loops=1)
                                 ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.149..0.149 rows=173 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                       ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.098 rows=173 loops=1)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=1065)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=1065)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=1065)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=1065)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
               Rows Removed by Filter: 1
 Total runtime: 38.812 ms
(74 rows)

-- Test Case 14 -  5909 ^ 2153 ^ 1065 -> 55 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2014-07-30 12:00:00+00' and '2014-07-30 18:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3381.48 rows=1 width=279) (actual time=0.509..3.845 rows=55 loops=1)
   ->  Nested Loop  (cost=29.47..3381.48 rows=1 width=279) (actual time=0.507..3.828 rows=55 loops=1)
         ->  Nested Loop  (cost=29.18..3372.55 rows=5 width=239) (actual time=0.457..3.190 rows=55 loops=1)
               ->  Nested Loop  (cost=28.90..3370.75 rows=5 width=239) (actual time=0.452..2.998 rows=55 loops=1)
                     ->  Nested Loop  (cost=28.62..3368.54 rows=5 width=215) (actual time=0.445..2.821 rows=55 loops=1)
                           ->  Nested Loop  (cost=28.34..3366.87 rows=5 width=231) (actual time=0.438..2.638 rows=55 loops=1)
                                 ->  Nested Loop  (cost=28.19..3365.87 rows=5 width=225) (actual time=0.433..2.485 rows=55 loops=1)
                                       ->  Nested Loop  (cost=27.91..3363.67 rows=6 width=209) (actual time=0.427..2.292 rows=55 loops=1)
                                             ->  Nested Loop  (cost=27.63..3360.22 rows=6 width=187) (actual time=0.418..2.041 rows=55 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3356.96 rows=19 width=168) (actual time=0.415..1.896 rows=55 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3349.38 rows=19 width=168) (actual time=0.409..1.703 rows=55 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 825
                                                               ->  Nested Loop  (cost=27.21..3343.62 rows=19 width=171) (actual time=0.401..1.404 rows=55 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3335.78 rows=19 width=156) (actual time=0.394..1.165 rows=55 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3303.97 rows=1400 width=52) (actual time=0.024..0.655 rows=1065 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2014-07-30 12:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2014-07-30 18:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.252..0.252 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.061..0.217 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.089 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.043..0.067 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.015 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.006..0.012 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=55)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.003 rows=16 loops=55)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.39 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=55)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.57 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=55)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=55)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=55)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=55)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=55)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=55)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
 Total runtime: 4.161 ms
(59 rows)

-- Mixed selectivity filtering
-- Test Case 15 - 5909 ^ 833188 -> 184 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=45.227..52.988 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=45.226..52.963 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.555..29.507 rows=2018 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.396..28.367 rows=2018 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=1.200..5.576 rows=2248 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=1.159..4.588 rows=2248 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.357..2.663 rows=2248 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.319..0.597 rows=19 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 271
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.312..0.492 rows=19 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.305..0.377 rows=19 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.292..0.304 rows=5 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 894
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.020..0.020 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.127 rows=899 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.005..0.009 rows=4 loops=5)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.005 rows=1 loops=19)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.003 rows=15 loops=19)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.009..0.058 rows=118 loops=19)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.793..0.793 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.452 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.014 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.180..21.180 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.296..19.388 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.589..15.482 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.141..10.750 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.756 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.124..7.124 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.138..6.016 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.532 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.120..3.120 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.584 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.437..2.437 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.003..1.487 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.698..1.698 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.788 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.142..0.142 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.096 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.488..22.488 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=20.258..22.480 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 53.285 ms
(74 rows)

-- Test Case 16 - 5909 ^ 17098775 -> 3889 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                             QUERY PLAN                                                                                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=387.12..886.77 rows=100 width=279) (actual time=1.417..4.744 rows=100 loops=1)
   ->  Nested Loop Left Join  (cost=387.12..375160.94 rows=75008 width=279) (actual time=1.416..4.718 rows=100 loops=1)
         ->  Nested Loop Left Join  (cost=386.83..239875.54 rows=75008 width=239) (actual time=1.374..3.676 rows=100 loops=1)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.345..1.661 rows=100 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.201..1.455 rows=100 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.160..1.355 rows=100 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.403..0.528 rows=100 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.051..0.074 rows=3 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.047..0.065 rows=3 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.047 rows=3 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.034 rows=1 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.008 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.006 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.011 rows=1 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.006..0.009 rows=3 loops=1)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.005 rows=1 loops=3)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.002 rows=1 loops=3)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.107..0.134 rows=33 loops=3)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 148
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.037..0.037 rows=210 loops=3)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.748..0.748 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.429 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.133..0.133 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.089 rows=173 loops=1)
               ->  Nested Loop Left Join  (cost=1.41..1.78 rows=1 width=46) (actual time=0.016..0.019 rows=1 loops=100)
                     ->  Nested Loop Left Join  (cost=1.12..1.42 rows=1 width=46) (actual time=0.013..0.016 rows=1 loops=100)
                           ->  Nested Loop Left Join  (cost=0.84..0.98 rows=1 width=22) (actual time=0.010..0.012 rows=1 loops=100)
                                 ->  Nested Loop Left Join  (cost=0.56..0.63 rows=1 width=22) (actual time=0.007..0.008 rows=1 loops=100)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.004..0.004 rows=1 loops=100)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                       ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=100)
                                             Index Cond: (id = sensor.tag_id)
                                             Heap Fetches: 0
                                 ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                                       Index Cond: (tag.id = tag_id)
                           ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=100)
                                 Index Cond: (surgery.release_id = id)
                     ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=100)
                           Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.003 rows=1 loops=100)
               Index Cond: (animal.species_id = id)
 Total runtime: 5.042 ms
(62 rows)

-- Test Case 17 - 2716283 ^ 464 -> 448 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
limit 100;
                                                                                                             QUERY PLAN                                                                                                             
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3053.81..16896.00 rows=100 width=279) (actual time=109.708..678.122 rows=100 loops=1)
   ->  Hash Join  (cost=3053.81..141060.48 rows=997 width=279) (actual time=109.706..678.083 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1287.19..138508.86 rows=199361 width=239) (actual time=22.362..625.388 rows=178524 loops=1)
               Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
               ->  Hash Join  (cost=1276.29..135744.75 rows=202561 width=233) (actual time=22.204..534.769 rows=178524 loops=1)
                     Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                     ->  Hash Join  (cost=62.46..127243.10 rows=233880 width=187) (actual time=0.977..388.397 rows=178553 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=60.31..122266.63 rows=702807 width=168) (actual time=0.936..310.897 rows=178553 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=1.13..112543.86 rows=702807 width=168) (actual time=0.112..220.229 rows=178553 loops=1)
                                       ->  Nested Loop  (cost=0.56..145.19 rows=76 width=132) (actual time=0.098..1.131 rows=44 loops=1)
                                             Join Filter: (receiver.model_id = device_model.id)
                                             Rows Removed by Join Filter: 646
                                             ->  Nested Loop  (cost=0.56..125.75 rows=76 width=135) (actual time=0.090..0.873 rows=44 loops=1)
                                                   ->  Nested Loop  (cost=0.28..94.39 rows=76 width=120) (actual time=0.085..0.514 rows=44 loops=1)
                                                         ->  Nested Loop  (cost=0.00..76.60 rows=26 width=104) (actual time=0.075..0.331 rows=7 loops=1)
                                                               Join Filter: (installation.id = installation_station.installation_id)
                                                               Rows Removed by Join Filter: 941
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.021 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 26
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.009 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 8
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.004 rows=27 loops=1)
                                                               ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.002..0.140 rows=948 loops=1)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.018 rows=6 loops=7)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.005..0.006 rows=1 loops=44)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=44)
                                                   ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                       ->  Index Scan using valid_detection_receiver_deployment_index on valid_detection  (cost=0.56..1202.23 rows=27670 width=52) (actual time=0.014..2.990 rows=4058 loops=44)
                                             Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.815..0.815 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.471 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                     ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.212..21.212 rows=4302 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 332kB
                           ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.284..19.312 rows=4302 loops=1)
                                 Hash Cond: (animal_release.animal_id = animal.id)
                                 ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.616..15.492 rows=4302 loops=1)
                                       Hash Cond: (surgery.release_id = animal_release.id)
                                       ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.141..10.829 rows=4302 loops=1)
                                             Hash Cond: (sensor.tag_id = tag.id)
                                             ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.742 rows=5307 loops=1)
                                             ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.120..7.120 rows=3923 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                                   ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.129..6.041 rows=3923 loops=1)
                                                         Hash Cond: (surgery.tag_id = tag.id)
                                                         ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.585 rows=3923 loops=1)
                                                         ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.112..3.112 rows=7227 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                               ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.003..1.554 rows=7227 loops=1)
                                       ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.466..2.466 rows=3920 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                             ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.543 rows=3920 loops=1)
                                 ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.658..1.658 rows=4023 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                       ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.780 rows=4023 loops=1)
               ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.141..0.141 rows=173 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 10kB
                     ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.095 rows=173 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.470..22.470 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=6.533..22.465 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 678.420 ms
(74 rows)

-- Test Case 18 - 2716283 ^ 2005 -> 4 rows
explain analyze select * from detection_extract_test_view
where project = 'AATAMS Heron Island'
  and timestamp between '2013-06-08 00:00:00+00' and '2013-06-08 01:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..3896.81 rows=7 width=279) (actual time=1.903..2.458 rows=4 loops=1)
   ->  Nested Loop Left Join  (cost=29.47..3896.81 rows=7 width=279) (actual time=1.902..2.453 rows=4 loops=1)
         ->  Nested Loop Left Join  (cost=29.18..3884.18 rows=7 width=239) (actual time=1.853..2.372 rows=4 loops=1)
               ->  Nested Loop Left Join  (cost=28.90..3881.69 rows=7 width=239) (actual time=1.846..2.358 rows=4 loops=1)
                     ->  Nested Loop Left Join  (cost=28.62..3878.61 rows=7 width=215) (actual time=1.839..2.338 rows=4 loops=1)
                           ->  Nested Loop Left Join  (cost=28.34..3876.17 rows=7 width=215) (actual time=1.833..2.322 rows=4 loops=1)
                                 ->  Nested Loop Left Join  (cost=28.06..3873.84 rows=7 width=215) (actual time=1.826..2.304 rows=4 loops=1)
                                       ->  Nested Loop  (cost=27.78..3870.07 rows=7 width=193) (actual time=1.816..2.280 rows=4 loops=1)
                                             ->  Nested Loop  (cost=27.63..3868.68 rows=7 width=187) (actual time=1.811..2.265 rows=4 loops=1)
                                                   ->  Nested Loop  (cost=27.49..3864.90 rows=22 width=168) (actual time=1.807..2.253 rows=4 loops=1)
                                                         ->  Nested Loop  (cost=27.21..3856.39 rows=22 width=168) (actual time=1.797..2.232 rows=4 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 60
                                                               ->  Nested Loop  (cost=27.21..3849.91 rows=22 width=171) (actual time=1.789..2.199 rows=4 loops=1)
                                                                     ->  Hash Join  (cost=26.93..3840.83 rows=22 width=156) (actual time=1.783..2.175 rows=4 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..3808.21 rows=1613 width=52) (actual time=0.045..1.130 rows=1839 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-06-08 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-06-08 01:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.694..0.694 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.556 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.116 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.066 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.018 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.027 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.004 rows=1 loops=4)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.001..0.004 rows=16 loops=4)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.004 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.38 rows=1 width=16) (actual time=0.004..0.004 rows=1 loops=4)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=4)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.002..0.002 rows=1 loops=4)
                                                   Index Cond: (id = receiver_download_file.requesting_user_id)
                                       ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.53 rows=1 width=22) (actual time=0.005..0.005 rows=1 loops=4)
                                             Index Cond: ((valid_detection.transmitter_id)::text = (transmitter_id)::text)
                                 ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.32 rows=1 width=8) (actual time=0.003..0.004 rows=1 loops=4)
                                       Index Cond: (id = sensor.tag_id)
                                       Heap Fetches: 0
                           ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.34 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=4)
                                 Index Cond: (tag.id = tag_id)
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.003..0.004 rows=1 loops=4)
                           Index Cond: (surgery.release_id = id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=4)
                     Index Cond: (animal_release.animal_id = id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.002..0.004 rows=1 loops=4)
               Index Cond: (animal.species_id = id)
 Total runtime: 2.765 ms
(58 rows)

-- Test Case 19 - 464 ^ 17098775 -> 6 rows
explain analyze select * from species_detection_extract_test_view
where spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                                 QUERY PLAN                                                                                                                  
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=930.07..121817.73 rows=100 width=279) (actual time=75173.472..386844.799 rows=6 loops=1)
   ->  Nested Loop  (cost=930.07..27691456.56 rows=22906 width=279) (actual time=75173.470..386844.791 rows=6 loops=1)
         ->  Nested Loop  (cost=929.78..19534084.41 rows=4579576 width=239) (actual time=22.235..353367.725 rows=9696014 loops=1)
               ->  Nested Loop  (cost=929.50..17890110.09 rows=4579576 width=239) (actual time=22.223..322197.802 rows=9696014 loops=1)
                     ->  Nested Loop  (cost=929.22..15863411.32 rows=4579576 width=215) (actual time=22.213..290074.393 rows=9696014 loops=1)
                           ->  Nested Loop  (cost=928.94..14328742.07 rows=4579576 width=231) (actual time=22.201..262104.631 rows=9696014 loops=1)
                                 ->  Nested Loop  (cost=928.79..13404173.01 rows=4653095 width=225) (actual time=22.193..235322.255 rows=9696014 loops=1)
                                       ->  Nested Loop  (cost=928.51..11309131.09 rows=5715895 width=209) (actual time=22.183..198361.517 rows=11828011 loops=1)
                                             ->  Nested Loop  (cost=928.23..9630096.75 rows=5372518 width=187) (actual time=22.169..134819.781 rows=16316319 loops=1)
                                                   ->  Nested Loop  (cost=928.09..6858748.47 rows=16144362 width=168) (actual time=22.160..92646.210 rows=16316319 loops=1)
                                                         ->  Hash Join  (cost=927.81..1894229.15 rows=16144362 width=168) (actual time=22.135..36684.434 rows=16316319 loops=1)
                                                               Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                               ->  Seq Scan on valid_detection  (cost=0.00..1570414.10 rows=16144362 width=52) (actual time=0.011..21875.228 rows=16316319 loops=1)
                                                                     Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                                                     Rows Removed by Filter: 36799631
                                                               ->  Hash  (cost=856.44..856.44 rows=5710 width=132) (actual time=22.104..22.104 rows=5710 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 969kB
                                                                     ->  Hash Join  (cost=382.84..856.44 rows=5710 width=132) (actual time=6.168..18.087 rows=5710 loops=1)
                                                                           Hash Cond: (receiver.model_id = device_model.id)
                                                                           ->  Hash Join  (cost=381.48..776.56 rows=5710 width=135) (actual time=6.148..15.484 rows=5710 loops=1)
                                                                                 Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                                 ->  Hash Join  (cost=105.87..379.62 rows=5710 width=120) (actual time=2.214..8.235 rows=5710 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.002..0.850 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=81.32..81.32 rows=1964 width=104) (actual time=2.204..2.204 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 280kB
                                                                                             ->  Hash Join  (cost=8.68..81.32 rows=1964 width=104) (actual time=0.153..1.503 rows=1964 loops=1)
                                                                                                   Hash Cond: (installation_station.installation_id = installation.id)
                                                                                                   ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.003..0.292 rows=1964 loops=1)
                                                                                                   ->  Hash  (cost=7.30..7.30 rows=110 width=63) (actual time=0.144..0.144 rows=110 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 12kB
                                                                                                         ->  Hash Join  (cost=2.69..7.30 rows=110 width=63) (actual time=0.048..0.104 rows=110 loops=1)
                                                                                                               Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                               ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.013 rows=110 loops=1)
                                                                                                               ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.038..0.038 rows=75 loops=1)
                                                                                                                     Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.002..0.015 rows=75 loops=1)
                                                                                 ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=3.922..3.922 rows=7227 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                                       ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.144 rows=7227 loops=1)
                                                                           ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.013..0.013 rows=16 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                 ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.003..0.004 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.30 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=16316319)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.001..0.002 rows=1 loops=16316319)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.30 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=16316319)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=11828011)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=9696014)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=9696014)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=9696014)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.002 rows=1 loops=9696014)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=9696014)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
               Rows Removed by Filter: 1
 Total runtime: 386845.123 ms
(65 rows)

-- Test Case 20 - 833188 ^ 5489 -> 210 rows
explain analyze select * from species_detection_extract_test_view
where spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                         QUERY PLAN                                                                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3100.88..14963.67 rows=6 width=279) (actual time=43.204..83.166 rows=100 loops=1)
   ->  Hash Join  (cost=3100.88..14963.67 rows=6 width=279) (actual time=43.203..83.134 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Nested Loop  (cost=1334.25..13191.97 rows=1292 width=239) (actual time=20.243..59.143 rows=2940 loops=1)
               ->  Hash Join  (cost=1333.97..12759.01 rows=1292 width=255) (actual time=20.218..49.906 rows=2940 loops=1)
                     Hash Cond: (animal_release.animal_id = animal.id)
                     ->  Hash Join  (cost=1213.45..12615.88 rows=1292 width=255) (actual time=18.514..46.169 rows=2940 loops=1)
                           Hash Cond: (surgery.release_id = animal_release.id)
                           ->  Hash Join  (cost=1012.25..12392.07 rows=1292 width=231) (actual time=16.011..41.376 rows=2940 loops=1)
                                 Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                                 ->  Hash Join  (cost=1001.36..12363.35 rows=1312 width=225) (actual time=15.863..39.504 rows=2940 loops=1)
                                       Hash Cond: (sensor.tag_id = surgery.tag_id)
                                       ->  Hash Join  (cost=856.09..12170.71 rows=1612 width=209) (actual time=14.088..35.577 rows=2832 loops=1)
                                             Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
                                             ->  Hash Join  (cost=675.68..11934.41 rows=1515 width=187) (actual time=11.186..30.121 rows=3143 loops=1)
                                                   Hash Cond: (receiver.organisation_id = organisation.id)
                                                   ->  Hash Join  (cost=673.54..11900.04 rows=4554 width=168) (actual time=11.133..28.379 rows=3143 loops=1)
                                                         Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                                         ->  Hash Join  (cost=614.36..11778.24 rows=4554 width=168) (actual time=10.323..25.617 rows=3143 loops=1)
                                                               Hash Cond: (receiver.model_id = device_model.id)
                                                               ->  Hash Join  (cost=613.00..11714.26 rows=4554 width=171) (actual time=10.300..23.853 rows=3143 loops=1)
                                                                     Hash Cond: (receiver_deployment.receiver_id = receiver.id)
                                                                     ->  Hash Join  (cost=337.39..11341.88 rows=4554 width=156) (actual time=5.908..17.060 rows=3143 loops=1)
                                                                           Hash Cond: (installation.project_id = receiver_project.id)
                                                                           ->  Hash Join  (cost=334.70..11276.58 rows=4554 width=125) (actual time=5.835..15.264 rows=3143 loops=1)
                                                                                 Hash Cond: (installation_station.installation_id = installation.id)
                                                                                 ->  Hash Join  (cost=330.23..11209.49 rows=4554 width=109) (actual time=5.749..13.545 rows=3143 loops=1)
                                                                                       Hash Cond: (receiver_deployment.station_id = installation_station.id)
                                                                                       ->  Hash Join  (cost=260.04..11070.99 rows=4554 width=60) (actual time=4.406..10.208 rows=3143 loops=1)
                                                                                             Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                                             ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.051..2.837 rows=3143 loops=1)
                                                                                                   Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                                                             ->  Hash  (cost=188.10..188.10 rows=5710 width=24) (actual time=4.327..4.327 rows=5710 loops=1)
                                                                                                   Buckets: 1024  Batches: 1  Memory Usage: 313kB
                                                                                                   ->  Seq Scan on receiver_deployment  (cost=0.00..188.10 rows=5710 width=24) (actual time=0.004..2.585 rows=5710 loops=1)
                                                                                       ->  Hash  (cost=45.64..45.64 rows=1964 width=57) (actual time=1.317..1.317 rows=1964 loops=1)
                                                                                             Buckets: 1024  Batches: 1  Memory Usage: 179kB
                                                                                             ->  Seq Scan on installation_station  (cost=0.00..45.64 rows=1964 width=57) (actual time=0.004..0.534 rows=1964 loops=1)
                                                                                 ->  Hash  (cost=3.10..3.10 rows=110 width=32) (actual time=0.067..0.067 rows=110 loops=1)
                                                                                       Buckets: 1024  Batches: 1  Memory Usage: 8kB
                                                                                       ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.032 rows=110 loops=1)
                                                                           ->  Hash  (cost=1.75..1.75 rows=75 width=39) (actual time=0.050..0.050 rows=75 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 6kB
                                                                                 ->  Seq Scan on project receiver_project  (cost=0.00..1.75 rows=75 width=39) (actual time=0.004..0.020 rows=75 loops=1)
                                                                     ->  Hash  (cost=185.27..185.27 rows=7227 width=31) (actual time=4.374..4.374 rows=7227 loops=1)
                                                                           Buckets: 1024  Batches: 1  Memory Usage: 415kB
                                                                           ->  Seq Scan on device receiver  (cost=0.00..185.27 rows=7227 width=31) (actual time=0.003..2.059 rows=7227 loops=1)
                                                               ->  Hash  (cost=1.16..1.16 rows=16 width=13) (actual time=0.012..0.012 rows=16 loops=1)
                                                                     Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.008 rows=16 loops=1)
                                                         ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.796..0.796 rows=1519 loops=1)
                                                               Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                                               ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.003..0.426 rows=1519 loops=1)
                                                   ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.037..0.037 rows=51 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                                         ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.003..0.020 rows=51 loops=1)
                                             ->  Hash  (cost=114.07..114.07 rows=5307 width=22) (actual time=2.870..2.870 rows=5307 loops=1)
                                                   Buckets: 1024  Batches: 1  Memory Usage: 291kB
                                                   ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.004..1.357 rows=5307 loops=1)
                                       ->  Hash  (cost=96.23..96.23 rows=3923 width=16) (actual time=1.762..1.762 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 184kB
                                             ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.003..0.890 rows=3923 loops=1)
                                 ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.131..0.131 rows=173 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                       ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.002..0.082 rows=173 loops=1)
                           ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.491..2.491 rows=3920 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                 ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.540 rows=3920 loops=1)
                     ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.687..1.687 rows=4023 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 189kB
                           ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.006..0.815 rows=4023 loops=1)
               ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=2940)
                     Index Cond: (id = sensor.tag_id)
                     Heap Fetches: 0
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.557..22.557 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=20.309..22.536 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 83.491 ms
(80 rows)

-- Test Case 21 - 5909 ^ 2153 ^ 17098775 -> 284 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018003'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=45.105..54.510 rows=100 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=45.104..54.481 rows=100 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=22.544..30.997 rows=2234 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.340..8.186 rows=2324 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.194..7.016 rows=2324 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.151..5.921 rows=2324 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.379..4.043 rows=2324 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.052..0.568 rows=47 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..0.434 rows=47 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.043..0.173 rows=47 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.035..0.050 rows=11 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.022 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 27
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.007..0.007 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 7
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.005 rows=28 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.020 rows=11 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.008 rows=4 loops=11)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.004..0.004 rows=1 loops=47)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=47)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.030..0.058 rows=49 loops=47)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 31
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.015..0.015 rows=85 loops=47)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.763..0.763 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.411 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.035..0.035 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.002..0.016 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.088 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.170..21.170 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.264..19.326 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.541..15.390 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.072..10.609 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.715 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.054..7.054 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.060..5.968 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.554 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=3.042..3.042 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.515 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.456..2.456 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.512 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.711..1.711 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.809 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.436..22.436 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=19.575..22.428 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018003'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 54.818 ms
(75 rows)

-- Test Case 22 - 5909 ^ 833188 ^ 5489 -> 13 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2013-09-24 00:00:00+00' and '2013-09-24 04:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..10905.01 rows=1 width=279) (actual time=0.802..4.839 rows=13 loops=1)
   ->  Nested Loop  (cost=29.47..10905.01 rows=1 width=279) (actual time=0.801..4.834 rows=13 loops=1)
         ->  Nested Loop  (cost=29.18..10874.70 rows=17 width=239) (actual time=0.749..4.652 rows=13 loops=1)
               ->  Nested Loop  (cost=28.90..10868.60 rows=17 width=239) (actual time=0.743..4.604 rows=13 loops=1)
                     ->  Nested Loop  (cost=28.62..10861.08 rows=17 width=215) (actual time=0.737..4.556 rows=13 loops=1)
                           ->  Nested Loop  (cost=28.34..10855.38 rows=17 width=231) (actual time=0.730..4.510 rows=13 loops=1)
                                 ->  Nested Loop  (cost=28.19..10852.00 rows=17 width=225) (actual time=0.725..4.475 rows=13 loops=1)
                                       ->  Nested Loop  (cost=27.91..10844.31 rows=21 width=209) (actual time=0.717..4.423 rows=13 loops=1)
                                             ->  Nested Loop  (cost=27.63..10836.44 rows=20 width=187) (actual time=0.707..4.358 rows=13 loops=1)
                                                   ->  Nested Loop  (cost=27.49..10825.97 rows=61 width=168) (actual time=0.703..4.321 rows=13 loops=1)
                                                         ->  Nested Loop  (cost=27.21..10805.50 rows=61 width=168) (actual time=0.697..4.271 rows=13 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 195
                                                               ->  Nested Loop  (cost=27.21..10789.66 rows=61 width=171) (actual time=0.690..4.191 rows=13 loops=1)
                                                                     ->  Hash Join  (cost=26.93..10764.48 rows=61 width=156) (actual time=0.682..4.131 rows=13 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..10720.43 rows=4554 width=52) (actual time=0.034..3.014 rows=5041 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-09-24 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-24 04:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.249..0.249 rows=64 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 10kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.059..0.209 rows=64 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.051..0.086 rows=15 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.067 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.016 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.021..0.021 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.018 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.007..0.011 rows=15 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.006 rows=4 loops=15)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=13)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.003 rows=16 loops=13)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.006 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.33 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=13)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=13)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.38 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=13)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=13)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.003 rows=1 loops=13)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.002 rows=1 loops=13)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=13)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.004 rows=1 loops=13)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
 Total runtime: 5.160 ms
(59 rows)

-- Test Case 23 - 5909 ^ 833188 ^ 17098775 -> 54 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Coffs Harbour line'
  and spcode = '37018021'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=46.963..59.494 rows=54 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=46.961..59.471 rows=54 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=22.569..36.019 rows=3558 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.359..12.268 rows=3854 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.214..10.402 rows=3854 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.173..8.677 rows=3854 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.395..5.967 rows=3854 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.051..0.753 rows=64 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.047..0.573 rows=64 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.042..0.255 rows=64 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.034..0.096 rows=15 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.022..0.063 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.020 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Coffs Harbour line'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.020 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.011..0.027 rows=15 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=4 loops=15)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.004 rows=1 loops=64)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.001..0.002 rows=1 loops=64)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=0.030..0.062 rows=60 loops=64)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 32
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=0.015..0.015 rows=92 loops=64)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.769..0.769 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.437 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.033..0.033 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.134..0.134 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.005..0.093 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.175..21.175 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.220..19.323 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.527..15.387 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.019..10.686 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.003..0.725 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.000..7.000 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=2.994..5.874 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.517 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.978..2.978 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.472 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.494..2.494 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.529 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.680..1.680 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.003..0.795 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.431..22.431 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=20.192..22.423 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37018021'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 59.785 ms
(75 rows)

-- Test Case 24 - 2716283 ^ 464 ^ 3129 -> 2 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5329.65 rows=1 width=279) (actual time=1.467..5.879 rows=2 loops=1)
   ->  Nested Loop  (cost=29.47..5329.65 rows=1 width=279) (actual time=1.466..5.877 rows=2 loops=1)
         ->  Nested Loop  (cost=29.18..5313.59 rows=9 width=239) (actual time=0.870..5.555 rows=70 loops=1)
               ->  Nested Loop  (cost=28.90..5310.36 rows=9 width=239) (actual time=0.863..5.310 rows=70 loops=1)
                     ->  Nested Loop  (cost=28.62..5306.38 rows=9 width=215) (actual time=0.856..5.066 rows=70 loops=1)
                           ->  Nested Loop  (cost=28.34..5303.36 rows=9 width=231) (actual time=0.849..4.856 rows=70 loops=1)
                                 ->  Nested Loop  (cost=28.19..5301.57 rows=9 width=225) (actual time=0.845..4.666 rows=70 loops=1)
                                       ->  Nested Loop  (cost=27.91..5297.54 rows=11 width=209) (actual time=0.838..4.406 rows=70 loops=1)
                                             ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.828..4.082 rows=69 loops=1)
                                                   ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.824..3.885 rows=69 loops=1)
                                                         ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.815..3.644 rows=69 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 1035
                                                               ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.809..3.303 rows=69 loops=1)
                                                                     ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.803..3.028 rows=69 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.049..1.699 rows=2743 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.735..0.735 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.060..0.597 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.121 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.042..0.068 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.003..0.016 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.034 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.002..0.003 rows=1 loops=69)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.001..0.005 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=69)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.003 rows=1 loops=69)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=70)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=0 loops=70)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
               Rows Removed by Filter: 1
 Total runtime: 6.190 ms
(60 rows)

-- Test Case 25 - 2716283 ^ 464 ^ 17098775 -> 4 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37346004'
  and timestamp between '2012-03-01' and '2013-09-01'
limit 100;
                                                                                                              QUERY PLAN                                                                                                              
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=3365.89..41351.92 rows=100 width=279) (actual time=1361.463..4475.428 rows=4 loops=1)
   ->  Hash Join  (cost=3365.89..119223.26 rows=305 width=279) (actual time=1361.461..4475.423 rows=4 loops=1)
         Hash Cond: (animal.species_id = species.id)
         ->  Hash Join  (cost=1599.27..117216.22 rows=61061 width=239) (actual time=23.069..4302.666 rows=896073 loops=1)
               Hash Cond: ((valid_detection.transmitter_id)::text = (sensor.transmitter_id)::text)
               ->  Hash Join  (cost=385.43..113805.51 rows=70502 width=193) (actual time=1.854..3669.979 rows=902521 loops=1)
                     Hash Cond: (receiver_download_file.requesting_user_id = sec_user.id)
                     ->  Hash Join  (cost=374.54..112820.97 rows=71634 width=187) (actual time=1.709..3281.842 rows=902521 loops=1)
                           Hash Cond: (receiver.organisation_id = organisation.id)
                           ->  Hash Join  (cost=372.39..111295.26 rows=215258 width=168) (actual time=1.667..2883.973 rows=902521 loops=1)
                                 Hash Cond: (valid_detection.receiver_download_id = receiver_download_file.id)
                                 ->  Nested Loop  (cost=313.21..108276.29 rows=215258 width=168) (actual time=0.911..2443.658 rows=902521 loops=1)
                                       ->  Nested Loop  (cost=0.98..70.39 rows=76 width=132) (actual time=0.052..5.874 rows=282 loops=1)
                                             ->  Nested Loop  (cost=0.84..57.72 rows=76 width=135) (actual time=0.048..4.374 rows=282 loops=1)
                                                   ->  Nested Loop  (cost=0.56..26.36 rows=76 width=120) (actual time=0.041..1.623 rows=282 loops=1)
                                                         ->  Nested Loop  (cost=0.28..8.57 rows=26 width=104) (actual time=0.033..0.237 rows=45 loops=1)
                                                               ->  Nested Loop  (cost=0.00..6.41 rows=1 width=63) (actual time=0.021..0.064 rows=1 loops=1)
                                                                     Join Filter: (installation.project_id = receiver_project.id)
                                                                     Rows Removed by Join Filter: 109
                                                                     ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.008..0.021 rows=1 loops=1)
                                                                           Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                           Rows Removed by Filter: 74
                                                                     ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.002..0.017 rows=110 loops=1)
                                                               ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.010..0.099 rows=45 loops=1)
                                                                     Index Cond: (installation_id = installation.id)
                                                         ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.008..0.020 rows=6 loops=45)
                                                               Index Cond: (station_id = installation_station.id)
                                                   ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.006..0.007 rows=1 loops=282)
                                                         Index Cond: (id = receiver_deployment.receiver_id)
                                             ->  Index Scan using device_model_pkey on device_model  (cost=0.14..0.16 rows=1 width=13) (actual time=0.002..0.004 rows=1 loops=282)
                                                   Index Cond: (id = receiver.model_id)
                                       ->  Bitmap Heap Scan on valid_detection  (cost=312.23..1339.01 rows=8475 width=52) (actual time=5.027..7.587 rows=3200 loops=282)
                                             Recheck Cond: (receiver_deployment_id = receiver_deployment.id)
                                             Filter: (("timestamp" >= '2012-03-01 00:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-09-01 00:00:00+00'::timestamp with time zone))
                                             Rows Removed by Filter: 6410
                                             ->  Bitmap Index Scan on valid_detection_receiver_deployment_index  (cost=0.00..310.12 rows=27670 width=0) (actual time=1.246..1.246 rows=9611 loops=282)
                                                   Index Cond: (receiver_deployment_id = receiver_deployment.id)
                                 ->  Hash  (cost=40.19..40.19 rows=1519 width=16) (actual time=0.747..0.747 rows=1519 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 72kB
                                       ->  Seq Scan on receiver_download_file  (cost=0.00..40.19 rows=1519 width=16) (actual time=0.002..0.432 rows=1519 loops=1)
                           ->  Hash  (cost=1.51..1.51 rows=51 width=35) (actual time=0.034..0.034 rows=51 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 4kB
                                 ->  Seq Scan on organisation  (cost=0.00..1.51 rows=51 width=35) (actual time=0.001..0.017 rows=51 loops=1)
                     ->  Hash  (cost=8.73..8.73 rows=173 width=22) (actual time=0.135..0.135 rows=173 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 10kB
                           ->  Seq Scan on sec_user  (cost=0.00..8.73 rows=173 width=22) (actual time=0.006..0.086 rows=173 loops=1)
               ->  Hash  (cost=1159.84..1159.84 rows=4320 width=46) (actual time=21.195..21.195 rows=4302 loops=1)
                     Buckets: 1024  Batches: 1  Memory Usage: 332kB
                     ->  Hash Join  (cost=825.96..1159.84 rows=4320 width=46) (actual time=11.221..19.448 rows=4302 loops=1)
                           Hash Cond: (animal_release.animal_id = animal.id)
                           ->  Hash Join  (cost=705.44..963.72 rows=4320 width=46) (actual time=9.511..15.486 rows=4302 loops=1)
                                 Hash Cond: (surgery.release_id = animal_release.id)
                                 ->  Hash Join  (cost=504.24..686.92 rows=4320 width=22) (actual time=7.046..10.705 rows=4302 loops=1)
                                       Hash Cond: (sensor.tag_id = tag.id)
                                       ->  Seq Scan on sensor  (cost=0.00..114.07 rows=5307 width=22) (actual time=0.002..0.811 rows=5307 loops=1)
                                       ->  Hash  (cost=455.20..455.20 rows=3923 width=24) (actual time=7.027..7.027 rows=3923 loops=1)
                                             Buckets: 1024  Batches: 1  Memory Usage: 215kB
                                             ->  Hash Join  (cost=275.61..455.20 rows=3923 width=24) (actual time=3.010..5.855 rows=3923 loops=1)
                                                   Hash Cond: (surgery.tag_id = tag.id)
                                                   ->  Seq Scan on surgery  (cost=0.00..96.23 rows=3923 width=16) (actual time=0.002..0.558 rows=3923 loops=1)
                                                   ->  Hash  (cost=185.27..185.27 rows=7227 width=8) (actual time=2.994..2.994 rows=7227 loops=1)
                                                         Buckets: 1024  Batches: 1  Memory Usage: 283kB
                                                         ->  Seq Scan on device tag  (cost=0.00..185.27 rows=7227 width=8) (actual time=0.002..1.499 rows=7227 loops=1)
                                 ->  Hash  (cost=152.20..152.20 rows=3920 width=32) (actual time=2.454..2.454 rows=3920 loops=1)
                                       Buckets: 1024  Batches: 1  Memory Usage: 241kB
                                       ->  Seq Scan on animal_release  (cost=0.00..152.20 rows=3920 width=32) (actual time=0.002..1.535 rows=3920 loops=1)
                           ->  Hash  (cost=70.23..70.23 rows=4023 width=16) (actual time=1.701..1.701 rows=4023 loops=1)
                                 Buckets: 1024  Batches: 1  Memory Usage: 189kB
                                 ->  Seq Scan on animal  (cost=0.00..70.23 rows=4023 width=16) (actual time=0.004..0.806 rows=4023 loops=1)
         ->  Hash  (cost=1764.34..1764.34 rows=183 width=56) (actual time=22.408..22.408 rows=1 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 1kB
               ->  Seq Scan on species  (cost=0.00..1764.34 rows=183 width=56) (actual time=6.504..22.402 rows=1 loops=1)
                     Filter: ((COALESCE(spcode, ''::character varying))::text = '37346004'::text)
                     Rows Removed by Filter: 36586
 Total runtime: 4475.725 ms
(75 rows)

-- Test Case 26 - 2716283 ^ 3913743 ^ 3129 -> 52 rows
explain analyze select * from species_detection_extract_test_view
where project = 'AATAMS Heron Island'
  and spcode = '37018030'
  and timestamp between '2013-04-02 05:00:00+00' and '2013-04-02 07:00:00+00'
limit 100;
                                                                                                                             QUERY PLAN                                                                                                                             
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit  (cost=29.47..5329.65 rows=1 width=279) (actual time=0.871..6.300 rows=52 loops=1)
   ->  Nested Loop  (cost=29.47..5329.65 rows=1 width=279) (actual time=0.870..6.286 rows=52 loops=1)
         ->  Nested Loop  (cost=29.18..5313.59 rows=9 width=239) (actual time=0.818..5.612 rows=70 loops=1)
               ->  Nested Loop  (cost=28.90..5310.36 rows=9 width=239) (actual time=0.812..5.372 rows=70 loops=1)
                     ->  Nested Loop  (cost=28.62..5306.38 rows=9 width=215) (actual time=0.805..5.126 rows=70 loops=1)
                           ->  Nested Loop  (cost=28.34..5303.36 rows=9 width=231) (actual time=0.798..4.873 rows=70 loops=1)
                                 ->  Nested Loop  (cost=28.19..5301.57 rows=9 width=225) (actual time=0.793..4.679 rows=70 loops=1)
                                       ->  Nested Loop  (cost=27.91..5297.54 rows=11 width=209) (actual time=0.786..4.431 rows=70 loops=1)
                                             ->  Nested Loop  (cost=27.63..5292.75 rows=10 width=187) (actual time=0.776..4.092 rows=69 loops=1)
                                                   ->  Nested Loop  (cost=27.49..5287.60 rows=30 width=168) (actual time=0.773..3.911 rows=69 loops=1)
                                                         ->  Nested Loop  (cost=27.21..5276.64 rows=30 width=168) (actual time=0.765..3.655 rows=69 loops=1)
                                                               Join Filter: (receiver.model_id = device_model.id)
                                                               Rows Removed by Join Filter: 1035
                                                               ->  Nested Loop  (cost=27.21..5268.24 rows=30 width=171) (actual time=0.758..3.294 rows=69 loops=1)
                                                                     ->  Hash Join  (cost=26.93..5255.86 rows=30 width=156) (actual time=0.752..3.008 rows=69 loops=1)
                                                                           Hash Cond: (valid_detection.receiver_deployment_id = receiver_deployment.id)
                                                                           ->  Index Scan using valid_timestamp_index on valid_detection  (cost=0.56..5220.91 rows=2213 width=52) (actual time=0.036..1.723 rows=2743 loops=1)
                                                                                 Index Cond: (("timestamp" >= '2013-04-02 05:00:00+00'::timestamp with time zone) AND ("timestamp" <= '2013-04-02 07:00:00+00'::timestamp with time zone))
                                                                           ->  Hash  (cost=25.42..25.42 rows=76 width=120) (actual time=0.698..0.698 rows=282 loops=1)
                                                                                 Buckets: 1024  Batches: 1  Memory Usage: 38kB
                                                                                 ->  Nested Loop  (cost=2.51..25.42 rows=76 width=120) (actual time=0.059..0.556 rows=282 loops=1)
                                                                                       ->  Nested Loop  (cost=2.23..7.63 rows=26 width=104) (actual time=0.052..0.117 rows=45 loops=1)
                                                                                             ->  Hash Join  (cost=1.95..5.47 rows=1 width=63) (actual time=0.041..0.066 rows=1 loops=1)
                                                                                                   Hash Cond: (installation.project_id = receiver_project.id)
                                                                                                   ->  Seq Scan on installation  (cost=0.00..3.10 rows=110 width=32) (actual time=0.004..0.016 rows=110 loops=1)
                                                                                                   ->  Hash  (cost=1.94..1.94 rows=1 width=39) (actual time=0.022..0.022 rows=1 loops=1)
                                                                                                         Buckets: 1024  Batches: 1  Memory Usage: 1kB
                                                                                                         ->  Seq Scan on project receiver_project  (cost=0.00..1.94 rows=1 width=39) (actual time=0.009..0.019 rows=1 loops=1)
                                                                                                               Filter: ((name)::text = 'AATAMS Heron Island'::text)
                                                                                                               Rows Removed by Filter: 74
                                                                                             ->  Index Scan using installation_station_installation_id_index on installation_station  (cost=0.28..1.97 rows=19 width=57) (actual time=0.008..0.034 rows=45 loops=1)
                                                                                                   Index Cond: (installation_id = installation.id)
                                                                                       ->  Index Scan using receiver_deployment_installation_station_id_index on receiver_deployment  (cost=0.28..0.65 rows=3 width=24) (actual time=0.003..0.007 rows=6 loops=45)
                                                                                             Index Cond: (station_id = installation_station.id)
                                                                     ->  Index Scan using device_pkey on device receiver  (cost=0.28..0.40 rows=1 width=31) (actual time=0.003..0.003 rows=1 loops=69)
                                                                           Index Cond: (id = receiver_deployment.receiver_id)
                                                               ->  Materialize  (cost=0.00..1.24 rows=16 width=13) (actual time=0.000..0.002 rows=16 loops=69)
                                                                     ->  Seq Scan on device_model  (cost=0.00..1.16 rows=16 width=13) (actual time=0.002..0.008 rows=16 loops=1)
                                                         ->  Index Scan using receiver_download_file_pkey on receiver_download_file  (cost=0.28..0.36 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=69)
                                                               Index Cond: (id = valid_detection.receiver_download_id)
                                                   ->  Index Scan using organisation_pkey on organisation  (cost=0.14..0.16 rows=1 width=35) (actual time=0.002..0.002 rows=1 loops=69)
                                                         Index Cond: (id = receiver.organisation_id)
                                             ->  Index Scan using transmitter_id_index on sensor  (cost=0.28..0.47 rows=1 width=22) (actual time=0.003..0.004 rows=1 loops=69)
                                                   Index Cond: ((transmitter_id)::text = (valid_detection.transmitter_id)::text)
                                       ->  Index Scan using tag_id_index on surgery  (cost=0.28..0.36 rows=1 width=16) (actual time=0.003..0.003 rows=1 loops=70)
                                             Index Cond: (tag_id = sensor.tag_id)
                                 ->  Index Scan using sec_user_pkey on sec_user  (cost=0.14..0.19 rows=1 width=22) (actual time=0.001..0.002 rows=1 loops=70)
                                       Index Cond: (id = receiver_download_file.requesting_user_id)
                           ->  Index Only Scan using device_pkey on device tag  (cost=0.28..0.33 rows=1 width=8) (actual time=0.002..0.002 rows=1 loops=70)
                                 Index Cond: (id = sensor.tag_id)
                                 Heap Fetches: 0
                     ->  Index Scan using animal_release_pkey on animal_release  (cost=0.28..0.43 rows=1 width=32) (actual time=0.002..0.003 rows=1 loops=70)
                           Index Cond: (id = surgery.release_id)
               ->  Index Scan using animal_pkey on animal  (cost=0.28..0.35 rows=1 width=16) (actual time=0.002..0.003 rows=1 loops=70)
                     Index Cond: (id = animal_release.animal_id)
         ->  Index Scan using species_pkey on species  (cost=0.29..1.77 rows=1 width=56) (actual time=0.003..0.003 rows=1 loops=70)
               Index Cond: (id = animal.species_id)
               Filter: ((COALESCE(spcode, ''::character varying))::text = '37018030'::text)
               Rows Removed by Filter: 0
 Total runtime: 6.619 ms
(60 rows)

\q
